<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV ReWriter Pro - Sistema Completo de IA para Rewriting de Curr√≠culos</title>
    <style>
    /* ===== VARI√ÅVEIS GLOBAIS COM BORDAS MAIS ARREDONDADAS ===== */
    :root {
        --primary: #5574ad;
        --secondary: #6d94d6;
        --success: #00b894;
        --warning: #fdcb6e;
        --danger: #ff6b6b;
        --info: #0984e3;
        --purple: #6c5ce7;

        /* Gradientes */
        --gradient-primary: linear-gradient(135deg, #4b71b7 0%, #2a5298 100%);
        --gradient-dark: linear-gradient(135deg, #13327b 0%, #7db38b 100%);
        --gradient-card: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        --gradient-rewrite: linear-gradient(135deg, #8a2be2 0%, #9370db 100%);

        /* BORDAS - MAIS ARREDONDADAS */
        --radius-sm: 12px;
        --radius-md: 18px;
        --radius-lg: 24px;
        --radius-xl: 32px;
        --radius-full: 9999px;

        /* Espa√ßamentos */
        --space-xs: 0.5rem;
        --space-sm: 0.75rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;

        /* Tipografia */
        --font-body: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        --font-size-base: 16px;
    }

    /* ===== RESET ===== */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    html {
        font-size: var(--font-size-base);
        -webkit-text-size-adjust: 100%;
    }

    body {
        background: var(--gradient-dark);
        color: #333;
        min-height: 100vh;
        line-height: 1.5;
        font-family: var(--font-body);
        -webkit-font-smoothing: antialiased;
        overflow-x: hidden;
    }

    .container {
        width: 100%;
        padding: var(--space-sm);
        margin: 0 auto;
    }

    /* ===== HEADER COMPACTO ===== */
    header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: rgba(19, 50, 123, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: var(--space-xs) var(--space-sm);
        margin-bottom: var(--space-sm);
        width: 100%;
    }

    header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--gradient-rewrite);
    }

    .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-xs);
        max-width: 1600px;
        margin: 0 auto;
    }

    h1 {
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 140px;
    }

    h1 i {
        font-size: 1rem;
        margin-right: 4px;
        opacity: 0.9;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: rgba(138, 43, 226, 0.15);
        border: 1px solid rgba(138, 43, 226, 0.2);
        border-radius: var(--radius-full);
        color: #a29bfe;
        font-size: 0.7rem;
        font-weight: 500;
        white-space: nowrap;
    }

    .status-badge .pulse-dot {
        width: 6px;
        height: 6px;
        background: #00b894;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    .stats-grid {
        display: flex;
        align-items: center;
        gap: var(--space-xs);
        margin: 0;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
        padding: 2px 0;
        flex: 1;
    }

    .stats-grid::-webkit-scrollbar {
        display: none;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        padding: 4px 10px;
        border-radius: 20px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.05);
        min-width: 70px;
        flex-shrink: 0;
        transition: all 0.2s ease;
    }

    .stat-card:active {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(0.95);
    }

    .stat-value {
        font-size: 1rem;
        font-weight: 700;
        color: white;
        line-height: 1.2;
        margin: 0;
    }

    .stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.6rem;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        font-weight: 500;
        white-space: nowrap;
    }

    .stat-card .progress-bar {
        display: none;
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .header-actions .icon-btn {
        width: 36px;
        height: 36px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: none;
        font-size: 0.9rem;
    }

    .header-actions .icon-btn:active {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(0.95);
    }

    .subtitle {
        display: none;
    }

    /* ===== SISTEMA DE ABAS ===== */
    .tabs-system {
        background: white;
        border-radius: var(--radius-lg);
        overflow: hidden;
        margin-bottom: var(--space-lg);
    }

    .tabs-header {
        display: flex;
        flex-direction: row;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
        background: var(--gradient-card);
        position: sticky;
        top: 0;
        z-index: 10;
        box-shadow: var(--shadow-sm);
    }

    .tabs-header::-webkit-scrollbar {
        display: none;
    }

    .tab-btn {
        padding: var(--space-sm) var(--space-md);
        border: none;
        background: none;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        color: #64748b;
        border-bottom: 2px solid transparent;
        white-space: nowrap;
        min-width: auto;
        min-height: 48px;
    }

    .tab-btn.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
        background: white;
    }

    .tab-btn .badge {
        background: var(--primary);
        color: white;
        padding: 2px 6px;
        border-radius: var(--radius-full);
        font-size: 0.7rem;
        min-width: 20px;
    }

    .tab-btn.completed::after {
        content: '‚úì';
        position: absolute;
        top: 5px;
        right: 5px;
        background: var(--success);
        color: white;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .tab-content {
        display: none;
        padding: var(--space-md);
        animation: fadeIn 0.4s ease;
    }

    .tab-content.active {
        display: block;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ===== LAYOUT ===== */
    .tab-grid {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }

    /* ===== CARDS ===== */
    .card {
        background: var(--gradient-card);
        border-radius: var(--radius-lg);
        padding: var(--space-md);
        box-shadow: var(--shadow-sm);
        border: 1px solid #e2e8f0;
    }

    .card-header {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
        margin-bottom: var(--space-md);
        padding-bottom: var(--space-sm);
        border-bottom: 2px solid #f1f5f9;
    }

    .card-title {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--primary);
        font-size: 1.1rem;
        font-weight: 600;
    }

    /* ===== CONTROLES ===== */
    .controls {
        display: flex;
        gap: var(--space-xs);
        flex-wrap: wrap;
    }

    .btn, .icon-btn {
        min-height: 48px;
        min-width: 48px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: none;
        border-radius: var(--radius-md);
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        padding: var(--space-sm) var(--space-md);
        -webkit-tap-highlight-color: transparent;
    }

    .btn-primary {
        background: var(--gradient-primary);
        color: white;
        width: 100%;
        margin: var(--space-xs) 0;
    }

    .btn-rewrite {
        background: var(--gradient-rewrite);
        color: white;
        width: 100%;
    }

    .btn-outline-primary {
        background: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
    }

    .btn-outline-danger {
        background: transparent;
        border: 1px solid var(--danger);
        color: var(--danger);
    }

    .icon-btn {
        width: 48px;
        height: 48px;
        padding: 0;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        color: var(--primary);
        flex-shrink: 0;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 0.8rem;
        min-height: 36px;
    }

    /* ===== FORMUL√ÅRIOS ===== */
    .form-group {
        margin-bottom: var(--space-md);
    }

    .form-label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #475569;
        font-size: 0.9rem;
    }

    .form-control {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e2e8f0;
        border-radius: var(--radius-md);
        font-size: 1rem;
        background: white;
        min-height: 52px;
        font-family: var(--font-body);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
    }

    textarea.form-control {
        min-height: 120px;
        resize: vertical;
    }

    .form-control-sm {
        padding: 8px 12px;
        font-size: 0.9rem;
        border: 1px solid #e2e8f0;
        border-radius: var(--radius-sm);
        width: 100%;
        margin-top: 4px;
    }

    /* ===== PERSONAS ===== */
    .personas-selector {
        margin-bottom: var(--space-md);
        padding: var(--space-md);
        background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
        border-radius: var(--radius-lg);
        border: 2px solid #e9d5ff;
    }

    .personas-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-xs);
    }

    .persona-btn {
        padding: var(--space-sm);
        border: 2px solid #e2e8f0;
        border-radius: var(--radius-md);
        background: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        font-size: 0.75rem;
        font-weight: 600;
        color: #475569;
        min-height: 90px;
        min-width: 0;
        text-align: center;
    }

    .persona-btn i {
        font-size: 1.3rem;
        margin-bottom: 2px;
    }

    .persona-btn small {
        font-size: 0.65rem;
        opacity: 0.7;
    }

    .persona-btn:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
    }

    .persona-btn.active {
        border-color: var(--purple);
        background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
        color: var(--purple);
    }

    .persona-description {
        margin-top: var(--space-sm);
        padding: var(--space-sm);
        background: white;
        border-radius: var(--radius-md);
        border-left: 4px solid var(--purple);
        font-size: 0.85rem;
        color: #6b21a8;
    }

    /* ===== TAGS ===== */
    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin: var(--space-xs) 0;
    }

    .tag {
        padding: 8px 14px;
        border-radius: var(--radius-full);
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        min-height: 40px;
    }

    .tag-primary {
        background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
        color: #0369a1;
        border: 1px solid #7dd3fc;
    }

    .tag-success {
        background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
        color: #166534;
        border: 1px solid #86efac;
    }

    /* ===== AN√ÅLISE ===== */
    .analysis-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-sm);
        margin: var(--space-md) 0;
    }

    .analysis-item {
        background: white;
        padding: var(--space-sm);
        border-radius: var(--radius-md);
        border-left: 4px solid var(--primary);
        box-shadow: var(--shadow-sm);
    }

    .analysis-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        color: #64748b;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
        font-weight: 600;
    }

    .analysis-value {
        font-size: 1rem;
        font-weight: 700;
        color: #1e293b;
    }

    /* ===== SCORE ===== */
    .score-display {
        text-align: center;
        padding: var(--space-md);
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: var(--radius-lg);
        margin: var(--space-md) 0;
    }

    .score-value {
        font-size: 2.5rem;
        font-weight: 900;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1;
        margin: 10px 0;
    }

    /* ===== AI MESSAGE ===== */
    .ai-message {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border-radius: var(--radius-md);
        padding: var(--space-md);
        margin: var(--space-sm) 0;
        border-left: 4px solid var(--info);
        font-size: 0.9rem;
    }

    /* ===== REWRITING METRICS ===== */
    .rewrite-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-xs);
        margin: var(--space-md) 0;
    }

    .metric-card {
        background: white;
        padding: var(--space-sm);
        border-radius: var(--radius-md);
        text-align: center;
        border: 1px solid #e2e8f0;
    }

    .metric-value {
        font-size: 1.3rem;
        font-weight: 700;
        margin: 4px 0;
    }

    .metric-label {
        color: #64748b;
        font-size: 0.65rem;
        text-transform: uppercase;
        font-weight: 600;
    }

    /* ===== CV COMPARISON ===== */
    .cv-comparison {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
        margin: var(--space-md) 0;
    }

    .cv-section {
        background: white;
        border-radius: var(--radius-lg);
        padding: var(--space-sm);
        border: 2px solid #e2e8f0;
        max-height: 300px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    .cv-rewritten {
        border-color: var(--success);
    }

    .cv-header {
        padding: var(--space-sm);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-md);
        text-align: center;
        font-weight: 600;
        color: var(--primary);
        background: #f1f5f9;
    }

    /* ===== PROGRESS BARS ===== */
    .progress-bar {
        height: 6px;
        background: #e2e8f0;
        border-radius: 3px;
        overflow: hidden;
        margin: 8px 0;
    }

    .progress-fill {
        height: 100%;
        background: var(--gradient-primary);
        border-radius: 3px;
        width: 0%;
        transition: width 1s ease-out;
    }

    /* ===== EXPERI√äNCIAS ===== */
    .experience-timeline {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
        margin-top: var(--space-sm);
    }

    .experience-entry {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
        position: relative;
        padding: var(--space-md);
        border-radius: var(--radius-md);
    }

    .experience-entry:hover {
        border-color: var(--primary);
    }

    .experience-entry::before {
        content: '';
        position: absolute;
        left: -10px;
        top: 20px;
        width: 16px;
        height: 16px;
        background: var(--primary);
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 0 0 2px var(--primary);
    }

    /* ===== LOADING ===== */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        backdrop-filter: blur(8px);
        flex-direction: column;
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-top: 4px solid var(--primary);
        border-right: 4px solid var(--purple);
        border-radius: 50%;
        animation: spin 1.2s linear infinite;
    }

    /* ===== NOTIFICATION ===== */
    .notification-system {
        position: fixed;
        top: 60px;
        right: 10px;
        left: 10px;
        z-index: 10000;
        max-width: 350px;
        margin: 0 auto;
    }

    .notification {
        background: white;
        padding: var(--space-md);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: slideInRight 0.4s ease;
        border-left: 5px solid var(--success);
        font-size: 0.9rem;
    }

    /* ===== MODAL ===== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: flex-end;
        z-index: 9999;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
        from {
            transform: translateY(100%);
        }
        to {
            transform: translateY(0);
        }
    }

    .modal-header {
        padding: var(--space-md);
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-body {
        padding: var(--space-md);
    }

    .modal-footer {
        padding: var(--space-md);
        border-top: 1px solid #e2e8f0;
        display: flex;
        justify-content: flex-end;
        gap: var(--space-sm);
    }

    /* ===== AN√ÅLISE ATS AVAN√áADA ===== */
    .ats-analysis-section {
        margin-top: var(--space-xl);
        padding-top: var(--space-lg);
        border-top: 2px dashed var(--primary);
    }

    .ats-analysis-card {
        margin-top: var(--space-xl);
        padding: var(--space-md);
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: var(--radius-xl);
        border: 1px solid rgba(226, 232, 240, 0.8);
        box-shadow: var(--shadow-lg);
    }

    .ats-analysis-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--success), var(--info), var(--primary));
    }

    .ats-score-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-md);
        margin-bottom: var(--space-md);
        padding-bottom: var(--space-md);
        border-bottom: 2px solid #f1f5f9;
    }

    .ats-score-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary);
    }

    .ats-score-title i {
        color: var(--info);
        font-size: 1.3rem;
    }

    .ats-score-value-container {
        text-align: center;
    }

    .ats-score-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: conic-gradient(var(--success) 100%, #e2e8f0 0%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        margin: 0 auto;
        box-shadow: 0 8px 20px rgba(0, 184, 148, 0.2);
    }

    .ats-score-circle::before {
        content: '';
        position: absolute;
        width: 75px;
        height: 75px;
        border-radius: 50%;
        background: white;
    }

    .ats-score-number {
        position: relative;
        font-size: 2rem;
        font-weight: 900;
        color: var(--success);
        z-index: 2;
    }

    .ats-score-label {
        font-size: 0.8rem;
        color: #64748b;
        margin-top: 4px;
    }

    .ats-quick-metrics {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-xs);
        margin: var(--space-md) 0;
    }

    .ats-metric-item {
        padding: var(--space-sm);
        border-radius: var(--radius-md);
        text-align: center;
        border: 2px solid transparent;
    }

    .ats-metric-item.structure {
        border-color: var(--info);
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    }

    .ats-metric-item.green-flags {
        border-color: var(--success);
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    }

    .ats-metric-item.red-flags {
        border-color: var(--danger);
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    }

    .ats-metric-value {
        font-size: 1.8rem;
        font-weight: 800;
        margin: 4px 0;
    }

    .ats-metric-item.structure .ats-metric-value {
        color: var(--info);
    }

    .ats-metric-item.green-flags .ats-metric-value {
        color: var(--success);
    }

    .ats-metric-item.red-flags .ats-metric-value {
        color: var(--danger);
    }

    .ats-metric-label {
        font-size: 0.7rem;
        color: #475569;
        text-transform: uppercase;
        font-weight: 600;
    }

    .ats-flags-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-md);
        margin: var(--space-md) 0;
    }

    .ats-flags-section {
        padding: var(--space-md);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
    }

    .ats-flags-section.green-flags {
        border-color: var(--success);
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    }

    .ats-flags-section.red-flags {
        border-color: var(--danger);
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    }

    .ats-flags-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: var(--space-sm);
        font-weight: 700;
    }

    .green-flags .ats-flags-header,
    .ats-flags-section.green-flags .ats-flags-header {
        color: #166534;
    }

    .red-flags .ats-flags-header,
    .ats-flags-section.red-flags .ats-flags-header {
        color: #991b1b;
    }

    .ats-flags-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }

    .ats-flag-tag {
        padding: 6px 10px;
        border-radius: var(--radius-full);
        font-size: 0.75rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        transition: all 0.2s ease;
    }

    .ats-flags-section.green-flags .ats-flag-tag {
        background: rgba(34, 197, 94, 0.15);
        color: #166534;
        border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .ats-flags-section.red-flags .ats-flag-tag {
        background: rgba(239, 68, 68, 0.15);
        color: #991b1b;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .ats-insights-container {
        margin-top: var(--space-md);
        padding: var(--space-md);
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border-radius: var(--radius-lg);
        border-left: 4px solid var(--info);
    }

    .ats-insights-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: var(--space-sm);
        color: var(--info);
        font-weight: 700;
    }

    .ats-insights-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-sm);
    }

    .ats-insight-card {
        background: white;
        padding: var(--space-sm);
        border-radius: var(--radius-md);
        border: 1px solid rgba(30, 60, 114, 0.1);
    }

    .ats-insight-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }

    .ats-insight-title {
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 4px;
        font-size: 0.9rem;
    }

    .ats-insight-text {
        font-size: 0.8rem;
        color: #475569;
    }

    .ats-recommendations {
        margin-top: var(--space-md);
        padding: var(--space-md);
        background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
        border-radius: var(--radius-lg);
        border: 2px solid var(--warning);
    }

    .ats-recommendations-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: var(--space-sm);
        color: #854d0e;
        font-weight: 700;
    }

    .ats-recommendations-content {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-sm);
    }

    .ats-recommendation-item {
        display: flex;
        align-items: flex-start;
        gap: 8px;
        padding: var(--space-sm);
        background: rgba(255, 255, 255, 0.8);
        border-radius: var(--radius-md);
        font-size: 0.85rem;
    }

    .ats-recommendation-item i {
        color: #f59e0b;
        font-size: 0.8rem;
        margin-top: 2px;
    }

    .ats-recommendation-text {
        color: #854d0e;
        line-height: 1.4;
    }

    /* ===== FOOTER ===== */
    .footer-container {
        max-width: 800px;
        margin: 0 auto;
        background: var(--gradient-card);
        border-radius: var(--radius-lg);
        padding: var(--space-md);
        box-shadow: var(--shadow-md);
    }

    .footer-title {
        color: var(--primary);
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .menu-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-xs);
        max-width: 600px;
        margin: 0 auto;
    }

    .menu-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        padding: 0.5rem;
    }

    .menu-item i {
        color: var(--primary);
        font-size: 0.9rem;
    }

    .menu-text {
        display: flex;
        flex-direction: column;
        font-size: 0.75rem;
        line-height: 1.2;
    }

    .menu-label {
        color: #64748b;
        font-size: 0.7rem;
        font-weight: 500;
    }

    .menu-value {
        color: #1e293b;
        font-weight: 700;
        font-size: 0.8rem;
    }

    .menu-btn {
        min-height: 60px;
        padding: var(--space-sm);
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: var(--radius-md);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        font-size: 0.7rem;
        color: var(--primary);
        cursor: pointer;
        width: 100%;
        font-weight: 600;
    }

    .menu-btn:hover {
        background: rgba(30, 60, 114, 0.05);
        border-color: var(--primary);
        transform: translateY(-2px);
    }

    .footer-security {
        color: #475569;
        font-size: 0.7rem;
        margin-top: 0.5rem;
        font-weight: 500;
        text-align: center;
    }

    .footer-security i {
        color: var(--primary);
    }

    .border-t {
        border-top: 1px solid #e2e8f0;
    }

    /* ===== UTILIT√ÅRIOS ===== */
    .hidden {
        display: none !important;
    }

    .text-center {
        text-align: center;
    }

    .flex {
        display: flex;
    }

    .flex-col {
        flex-direction: column;
    }

    .items-center {
        align-items: center;
    }

    .justify-between {
        justify-content: space-between;
    }

    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }

    .mb-1 { margin-bottom: var(--space-xs); }
    .mb-2 { margin-bottom: var(--space-sm); }
    .mb-3 { margin-bottom: var(--space-md); }
    .mb-4 { margin-bottom: var(--space-lg); }

    .mt-1 { margin-top: var(--space-xs); }
    .mt-2 { margin-top: var(--space-sm); }
    .mt-3 { margin-top: var(--space-md); }
    .mt-4 { margin-top: var(--space-lg); }

    .p-3 { padding: 0.75rem; }
    .p-4 { padding: 1rem; }
    .p-5 { padding: 1.25rem; }

    .rounded-lg { border-radius: var(--radius-lg); }
    .rounded-xl { border-radius: var(--radius-xl); }

    .bg-blue-50 { background-color: #eff6ff; }
    .bg-green-50 { background-color: #f0fdf4; }
    .bg-purple-50 { background-color: #faf5ff; }
    .bg-yellow-50 { background-color: #fefce8; }

    .text-secondary { color: #64748b; }
    .text-sm { font-size: 0.875rem; }
    .text-lg { font-size: 1.125rem; }

    .whitespace-pre-line { white-space: pre-line; }
    .grid { display: grid; }
    .grid-cols-1 { grid-template-columns: 1fr; }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }

    .d-flex { display: flex; }
    .justify-content-between { justify-content: space-between; }
    .align-items-center { align-items: center; }
    .font-medium { font-weight: 500; }

    /* ===== SCORES ===== */
    .score-excelente { color: #00b894; }
    .score-bom { color: #0984e3; }
    .score-medio { color: #fdcb6e; }
    .score-baixo { color: #ff6b6b; }

    .ats-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: var(--radius-full);
        font-size: 0.75rem;
        font-weight: 600;
    }

    .ats-badge.excelente {
        background: rgba(0, 184, 148, 0.2);
        color: #00b894;
        border: 1px solid rgba(0, 184, 148, 0.3);
    }

    .ats-badge.bom {
        background: rgba(9, 132, 227, 0.2);
        color: #0984e3;
        border: 1px solid rgba(9, 132, 227, 0.3);
    }

    .ats-badge.medio {
        background: rgba(253, 203, 110, 0.2);
        color: #f39c12;
        border: 1px solid rgba(253, 203, 110, 0.3);
    }

    .ats-badge.baixo {
        background: rgba(255, 107, 107, 0.2);
        color: #ff6b6b;
        border: 1px solid rgba(255, 107, 107, 0.3);
    }

    /* ===== ANIMA√á√ïES ===== */
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.8; }
        100% { transform: scale(1); opacity: 1; }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes pulseSuccess {
        0% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(0, 184, 148, 0); }
        100% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0); }
    }

    /* ===== RESPONSIVIDADE ===== */

    /* Tablet (768px+) */
    @media (min-width: 768px) {
        .container {
            padding: var(--space-lg);
        }

        .stats-grid {
            gap: var(--space-sm);
        }

        .stat-card {
            min-width: 80px;
        }

        .personas-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .ats-quick-metrics {
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-sm);
        }

        .ats-flags-container {
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .ats-insights-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .ats-recommendations-content {
            grid-template-columns: repeat(2, 1fr);
        }

        .btn-primary, .btn-rewrite {
            width: auto;
            flex: 1;
        }

        .analysis-actions {
            display: flex;
            flex-direction: row;
            gap: var(--space-sm);
        }

        .menu-grid {
            grid-template-columns: repeat(4, 1fr);
        }

        .ats-score-header {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }

        .analysis-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    /* Desktop (1024px+) */
    @media (min-width: 1024px) {
        .container {
            max-width: 1200px;
            padding: var(--space-xl);
            margin: 0 auto;
        }

        h1 {
            font-size: 1.4rem;
            max-width: 200px;
        }

        .tabs-header {
            overflow-x: visible;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            white-space: normal;
            font-size: 1rem;
            padding: var(--space-md);
        }

        .personas-grid {
            grid-template-columns: repeat(5, 1fr);
        }

        .tab-grid {
            flex-direction: row;
            gap: var(--space-xl);
        }

        .card {
            flex: 1;
        }

        .cv-comparison {
            flex-direction: row;
        }

        .cv-section {
            flex: 1;
        }

        .ats-analysis-card {
            padding: var(--space-lg);
        }

        .ats-score-circle {
            width: 120px;
            height: 120px;
        }

        .ats-score-circle::before {
            width: 90px;
            height: 90px;
        }

        .ats-score-number {
            font-size: 2.5rem;
        }
    }

    /* Touch feedback */
    .btn:active, .icon-btn:active, .tab-btn:active, .persona-btn:active {
        opacity: 0.7;
        transform: scale(0.98);
    }

    .tag:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }

    .btn:hover {
        transform: translateY(-2px);
    }

    .icon-btn:hover {
        background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
    }

    /* Melhor scroll */
    .overflow-auto {
        -webkit-overflow-scrolling: touch;
    }

    /* Corre√ß√µes */
    .score-medio {
        color: #fdcb6e;
    }

    #analysis-results {
        animation: fadeIn 0.5s ease-out;
    }
</style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- [TODO O HTML EXISTENTE SE MANT√âM IGUAL] -->
    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="header-content">
                <h1><i class="fas fa-magic"></i> CV ReWriter</h1>

                <div class="status-badge">
                    <span class="pulse-dot"></span>
                    <span>IA Ativa ‚Ä¢ Rewriting ‚Ä¢ Personas</span>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-analises">0</div>
                        <div class="stat-label">An√°lises</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-analises"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-rewrites">0</div>
                        <div class="stat-label">Reescritos</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-rewrites"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-matches">0</div>
                        <div class="stat-label">Matches</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-matches"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="reducao-irrelevante">40%</div>
                        <div class="stat-label">Redu√ß√£o</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-reducao"></div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Subt√≠tulo agora aparece como tooltip ou elemento escondido que aparece ao clicar -->
            <p class="subtitle hidden">Sistema completo de IA para REWRITING (reescrita inteligente) de curr√≠culos
                brasileiros com foco espec√≠fico por vaga e 5 personas estrat√©gicas</p>
        </header>

        <!-- SISTEMA DE ABAS -->
        <div class="tabs-system">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="analysis">
                    <i class="fas fa-search"></i>
                    <span>An√°lise de Vaga</span>
                    <span class="badge" id="analysis-badge">0</span>
                </button>
                <button class="tab-btn" data-tab="profile">
                    <i class="fas fa-user-tie"></i>
                    <span>Meu CV Original</span>
                </button>
                <button class="tab-btn" data-tab="relevance">
                    <i class="fas fa-chart-line"></i>
                    <span>An√°lise de Relev√¢ncia</span>
                </button>
                <button class="tab-btn" data-tab="rewriting">
                    <i class="fas fa-magic"></i>
                    <span>Rewriting IA</span>
                    <span class="badge" id="rewriting-badge">0</span>
                </button>
                <button class="tab-btn" data-tab="optimization">
                    <i class="fas fa-stars"></i>
                    <span>CV Otimizado</span>
                </button>
            </div>

            <!-- ABA 1: AN√ÅLISE DE VAGA -->
            <div id="analysis" class="tab-content active">
                <div class="tab-grid">
                    <!-- CARD DA ESQUERDA: DESCRI√á√ÉO DA VAGA -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-paste"></i> Descri√ß√£o da Vaga Alvo
                            </h3>
                            <div class="controls">
                                <button class="icon-btn" id="clear-job" title="Limpar tudo">
                                    <i class="fas fa-eraser"></i>
                                </button>
                                <button class="icon-btn" id="load-example" title="Carregar exemplo">
                                    <i class="fas fa-file-alt"></i>
                                </button>
                                <button class="icon-btn" id="paste-clipboard" title="Colar">
                                    <i class="fas fa-paste"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <textarea id="job-text" class="form-control" placeholder="Cole aqui o texto da vaga..."
                                rows="12"></textarea>
                        </div>

                        <!-- MODO BIL√çNGUE -->
                        <div class="language-mode-card">
                            <label class="form-label">
                                <i class="fas fa-language"></i> Modo do Sistema (Bilingue IA)
                            </label>
                            <select id="target-language" class="form-control language-select">
                                <option value="auto">‚ú® Intelig√™ncia Artificial (Detectar Idioma da Vaga)</option>
                                <option value="pt">üáßüá∑ For√ßar Sa√≠da em Portugu√™s</option>
                                <option value="en">üá∫üá∏ For√ßar Sa√≠da em Ingl√™s (Traduzir CV automaticamente)</option>
                            </select>
                            <small class="language-mode-info">
                                <i class="fas fa-info-circle"></i> A IA comparar√° o CV (mesmo em PT) e gerar√° o
                                resultado no idioma da vaga ou no escolhido acima.
                            </small>
                        </div>

                        <!-- DETEC√á√ÉO R√ÅPIDA -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-brain"></i> Detec√ß√£o R√°pida
                            </label>
                            <div id="auto-detection" class="tags-container">
                                <span class="tag tag-primary">
                                    <i class="fas fa-sync fa-spin"></i> Aguardando an√°lise...
                                </span>
                            </div>
                        </div>

                        <!-- BOT√ïES DE A√á√ÉO -->
                        <div class="analysis-actions">
                            <button class="btn btn-primary" id="analyze-btn">
                                <i class="fas fa-magic"></i> An√°lise Completa
                            </button>
                            <button class="btn btn-rewrite" id="quick-analyze">
                                <i class="fas fa-bolt"></i> Detectar Keywords
                            </button>
                        </div>
                    </div>

                    <!-- CARD DA DIREITA: AN√ÅLISE E INTELIG√äNCIA -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-network"></i> Intelig√™ncia e Alinhamento
                            </h3>
                        </div>

                        <!-- PLACEHOLDER INICIAL -->
                        <div id="analysis-placeholder" class="analysis-placeholder">
                            <div class="placeholder-icon">
                                <i class="fas fa-file-search fa-3x"></i>
                            </div>
                            <h3 class="placeholder-title">Nenhuma vaga analisada</h3>
                            <p class="placeholder-text">Analise uma vaga para ver o alinhamento com seu perfil.</p>
                        </div>

                        <!-- RESULTADOS DA AN√ÅLISE -->
                        <div id="analysis-results" class="hidden">
                            <!-- INFORMA√á√ïES B√ÅSICAS DA VAGA -->
                            <div class="analysis-grid" id="job-basic-info"></div>

                            <!-- AN√ÅLISE ATS AVAN√áADA -->
                            <div class="ats-analysis-card" id="ats-analysis-section" style="display: none;">
                                <div class="ats-score-header">
                                    <div class="ats-score-title">
                                        <i class="fas fa-chart-line"></i>
                                        An√°lise ATS Avan√ßada
                                    </div>
                                    <div class="ats-score-value-container">
                                        <div class="ats-score-circle">
                                            <div class="ats-score-number">100/100</div>
                                        </div>
                                        <div class="ats-score-label">Score ATS</div>
                                    </div>
                                </div>

                                <!-- M√âTRICAS R√ÅPIDAS ATS -->
                                <div class="ats-quick-metrics">
                                    <div class="ats-metric-item structure">
                                        <div class="ats-metric-value">100%</div>
                                        <div class="ats-metric-label">Estrutura</div>
                                    </div>
                                    <div class="ats-metric-item green-flags">
                                        <div class="ats-metric-value">3</div>
                                        <div class="ats-metric-label">Green Flags</div>
                                    </div>
                                    <div class="ats-metric-item red-flags">
                                        <div class="ats-metric-value">0</div>
                                        <div class="ats-metric-label">Red Flags</div>
                                    </div>
                                </div>

                                <!-- FLAGS ATS -->
                                <div class="ats-flags-container">
                                    <div class="ats-flags-section green-flags">
                                        <div class="ats-flags-header">
                                            <i class="fas fa-check-circle"></i>
                                            Green Flags
                                        </div>
                                        <div id="ats-green-flags" class="ats-flags-list">
                                            <span class="ats-flag-tag">
                                                <i class="fas fa-home"></i> home office
                                            </span>
                                        </div>
                                    </div>

                                    <div class="ats-flags-section red-flags">
                                        <div class="ats-flags-header">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            Red Flags
                                        </div>
                                        <div id="ats-red-flags" class="ats-flags-list">
                                            <span class="ats-flag-tag">
                                                <i class="fas fa-info-circle"></i> Nenhuma red flag detectada
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- INSIGHTS ATS -->
                                <div class="ats-insights-container">
                                    <div class="ats-insights-header">
                                        <i class="fas fa-lightbulb"></i>
                                        Insights ATS
                                    </div>
                                    <div id="ats-insights-grid" class="ats-insights-grid"></div>
                                </div>

                                <!-- RECOMENDA√á√ïES ATS -->
                                <div class="ats-recommendations">
                                    <div class="ats-recommendations-header">
                                        <i class="fas fa-rocket"></i>
                                        Recomenda√ß√µes ATS
                                    </div>
                                    <div id="ats-recommendations-content" class="ats-recommendations-content"></div>
                                </div>
                            </div>

                            <!-- INSIGHTS DE MERCADO -->
                            <div class="market-intelligence-card">
                                <h4 class="intelligence-title">
                                    <i class="fas fa-lightbulb"></i> Insights de Mercado e Cultura
                                </h4>
                                <div id="vaga-insights" class="intelligence-grid"></div>
                            </div>
                        </div>

                        <!-- KEYWORDS DETECTADAS -->
                        <div class="keywords-section">
                            <h4 class="keywords-title">
                                <i class="fas fa-code"></i> Keywords Cr√≠ticas (ATS)
                            </h4>
                            <div id="skills-detected" class="keywords-container"></div>
                        </div>

                        <!-- CALL TO ACTION -->
                        <div class="profile-mapped-card">
                            <div class="mapped-content">
                                <div class="mapped-text">
                                    <h5 class="mapped-title">Perfil Mapeado!</h5>
                                    <p class="mapped-description">Pronto para ajustar seu CV √† cultura desta vaga.</p>
                                </div>
                                <button class="btn btn-rewrite goto-profile-btn" id="goto-profile">
                                    <i class="fas fa-user-tie"></i> Configurar CV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 2: PERFIL/CV ORIGINAL -->
            <div id="profile" class="tab-content">
                <div class="tab-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-file-alt"></i>
                                Meu CV Original
                            </h3>
                            <div class="controls">
                                <button class="icon-btn" id="load-marcio" title="Carregar CV M√°rcio Maker">
                                    <i class="fas fa-user-ninja"></i>
                                </button>
                                <button class="icon-btn" id="load-complete-cv" title="Carregar CV Completo Fus√£o">
                                    <i class="fas fa-file-medical-alt"></i>
                                </button>
                                <button class="icon-btn" id="reset-cv" title="Redefinir CV">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" id="cv-name" class="form-control"
                                placeholder="Ex: M√°rcio Gemelli (M√°rcio Maker)" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Cargo Atual *</label>
                            <input type="text" id="cv-title" class="form-control"
                                placeholder="Ex: Desenvolvedor Full Stack" required>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div class="form-group">
                                <label class="form-label">Localiza√ß√£o</label>
                                <input type="text" id="cv-location" class="form-control"
                                    placeholder="Ex: S√£o Paulo, SP">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pretens√£o Salarial</label>
                                <input type="text" id="cv-salary" class="form-control"
                                    placeholder="Ex: R$ 8.000 - R$ 12.000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-bullseye"></i> Objetivo Profissional
                            </label>
                            <textarea id="cv-objective" class="form-control" rows="2"
                                placeholder="Ex: Busco oportunidade como Desenvolvedor Full Stack..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-code"></i> Habilidades T√©cnicas *
                            </label>
                            <textarea id="cv-skills" class="form-control"
                                placeholder="JavaScript, React, Node.js, Python, IA, Docker, AWS..." rows="3"
                                required></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-briefcase"></i> Experi√™ncias Profissionais</span>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="add-experience-btn">
                                    <i class="fas fa-plus"></i> Adicionar Cargo
                                </button>
                            </label>

                            <div id="experience-timeline" class="experience-timeline mt-2">
                            </div>

                            <textarea id="cv-experience" class="hidden"></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mt-3">
                            <button class="btn btn-primary" id="save-profile">
                                <i class="fas fa-save"></i> Salvar CV
                            </button>
                            <button class="btn btn-rewrite" id="enhance-cv">
                                <i class="fas fa-wand-magic-sparkles"></i> Melhorar com IA
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-eye"></i>
                                Pr√©-visualiza√ß√£o do CV Original
                            </h3>
                        </div>

                        <div id="cv-preview" class="space-y-4 max-h-[500px] overflow-y-auto p-3">
                            <div class="text-center p-4">
                                <i class="fas fa-file-alt fa-3x text-gray-300 mb-2"></i>
                                <h3 class="text-lg font-bold mb-1">CV n√£o configurado</h3>
                                <p class="text-secondary">Preencha os campos ao lado</p>
                            </div>
                        </div>

                        <div class="mt-4">
                            <button class="btn btn-primary w-full" id="goto-relevance">
                                <i class="fas fa-chart-line"></i> Analisar Relev√¢ncia do CV
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 3: AN√ÅLISE DE RELEV√ÇNCIA -->
            <div id="relevance" class="tab-content">
                <div class="tab-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                An√°lise de Relev√¢ncia do CV
                            </h3>
                            <div class="controls">
                                <button class="icon-btn" id="run-relevance" title="Analisar relev√¢ncia">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                            </div>
                        </div>

                        <div id="relevance-placeholder" class="text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-chart-bar fa-3x" style="color: #a5b4fc;"></i>
                            </div>
                            <h3 class="text-lg font-bold mb-2">An√°lise de Relev√¢ncia</h3>
                            <p class="text-secondary mb-3">Analise quanto do seu CV √© relevante para a vaga alvo</p>

                            <button class="btn btn-primary" id="start-relevance">
                                <i class="fas fa-play"></i> Iniciar An√°lise
                            </button>
                        </div>

                        <div id="relevance-results" class="hidden space-y-4">
                            <!-- Conte√∫do din√¢mico ser√° inserido aqui -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-lightbulb"></i>
                                Insights e Recomenda√ß√µes
                            </h3>
                        </div>

                        <div id="relevance-insights" class="space-y-3">
                            <div class="ai-message">
                                <strong>ü§ñ IA:</strong> Esta an√°lise identifica o que √© relevante para a vaga
                                espec√≠fica.
                            </div>

                            <div class="p-3 bg-purple-50 rounded-lg">
                                <h4 class="font-bold text-purple-700 mb-1">Como funciona:</h4>
                                <ul class="text-sm text-purple-800 space-y-1">
                                    <li>‚Ä¢ Match de keywords da vaga</li>
                                    <li>‚Ä¢ Identifica√ß√£o de irrelev√¢ncias</li>
                                    <li>‚Ä¢ Sugest√µes de reescrita</li>
                                </ul>
                            </div>

                            <div id="relevance-actions" class="hidden">
                                <!-- Bot√µes de a√ß√£o ser√£o inseridos aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 4: REWRITING IA COM PERSONAS -->
            <div id="rewriting" class="tab-content">
                <div class="tab-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-magic"></i>
                                Rewriting Inteligente do CV
                            </h3>
                            <div class="controls">
                                <button class="icon-btn" id="run-rewriting" title="Executar rewriting">
                                    <i class="fas fa-robot"></i>
                                </button>
                            </div>
                        </div>

                        <div id="rewriting-placeholder" class="text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-magic fa-3x" style="color: #8a2be2;"></i>
                            </div>
                            <h3 class="text-lg font-bold mb-2">Rewriting Inteligente</h3>
                            <p class="text-secondary mb-3">Reescreva seu CV focado na vaga espec√≠fica</p>

                            <!-- SISTEMA DE PERSONAS -->
                            <div class="personas-selector">
                                <h4 class="font-bold mb-3 text-purple-800">
                                    <i class="fas fa-user-tie"></i> Selecione sua Persona Estrat√©gica
                                </h4>
                                <p class="text-sm text-secondary mb-3">
                                    Escolha o foco que melhor se encaixa na vaga. <strong>Experi√™ncia, Educa√ß√£o e
                                        Contato permanecem intactos.</strong>
                                </p>

                                <div class="personas-grid" id="personas-grid">
                                    <button class="persona-btn" data-persona="frontend">
                                        <i class="fas fa-palette"></i>
                                        <span>Front-end</span>
                                        <small class="text-xs opacity-70">Interfaces & UX</small>
                                    </button>
                                    <button class="persona-btn" data-persona="backend">
                                        <i class="fas fa-server"></i>
                                        <span>Back-end</span>
                                        <small class="text-xs opacity-70">APIs & Dados</small>
                                    </button>
                                    <button class="persona-btn" data-persona="fullstack">
                                        <i class="fas fa-layer-group"></i>
                                        <span>Full Stack</span>
                                        <small class="text-xs opacity-70">Vis√£o completa</small>
                                    </button>
                                    <button class="persona-btn" data-persona="uxdev">
                                        <i class="fas fa-pen-nib"></i>
                                        <span>UX/UI Dev</span>
                                        <small class="text-xs opacity-70">Design + Code</small>
                                    </button>
                                    <button class="persona-btn" data-persona="produto">
                                        <i class="fas fa-chart-line"></i>
                                        <span>Produto</span>
                                        <small class="text-xs opacity-70">Inova√ß√£o</small>
                                    </button>
                                </div>

                                <div id="persona-description" class="persona-description hidden">
                                    <p id="persona-desc-text"></p>
                                </div>
                            </div>

                            <div class="rewrite-metrics mb-4">
                                <div class="metric-card">
                                    <div class="metric-value">40%+</div>
                                    <div class="metric-label">Redu√ß√£o Irrelevante</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">60%+</div>
                                    <div class="metric-label">Aumento Keywords</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">100%</div>
                                    <div class="metric-label">ATS Otimizado</div>
                                </div>
                            </div>

                            <button class="btn btn-rewrite btn-lg" id="start-rewriting">
                                <i class="fas fa-wand-magic-sparkles"></i> Executar Rewriting
                            </button>
                        </div>

                        <div id="rewriting-results" class="hidden">
                            <!-- Conte√∫do din√¢mico ser√° inserido aqui -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-rocket"></i>
                                Otimiza√ß√£o Avan√ßada
                            </h3>
                        </div>

                        <div id="rewriting-insights" class="space-y-3">
                            <div class="ai-message">
                                <strong>ü§ñ IA:</strong> O rewriting ir√° personalizar seu CV para a vaga espec√≠fica.
                            </div>

                            <div class="p-3 bg-purple-50 rounded-lg">
                                <h4 class="font-bold text-purple-700 mb-1">O que ser√° otimizado:</h4>
                                <ul class="text-sm text-purple-800 space-y-1">
                                    <li>‚Ä¢ Objetivo profissional direcionado</li>
                                    <li>‚Ä¢ Experi√™ncia com keywords da vaga</li>
                                    <li>‚Ä¢ Formata√ß√£o para ATS brasileiro</li>
                                    <li>‚Ä¢ M√©tricas e resultados quantific√°veis</li>
                                </ul>
                            </div>

                            <div class="p-3 bg-blue-50 rounded-lg">
                                <h4 class="font-bold text-blue-700 mb-1">Sistema de Personas:</h4>
                                <p class="text-sm text-blue-800">
                                    Cada persona ajusta apenas Objetivo e Habilidades. Experi√™ncia, Educa√ß√£o e Contato
                                    permanecem intactos.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 5: CV OTIMIZADO -->
            <div id="optimization" class="tab-content">
                <div class="tab-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-file-contract"></i>
                                CV Otimizado para ATS Brasileiro
                            </h3>
                            <div class="controls">
                                <button class="icon-btn" id="refresh-cv" title="Atualizar CV">
                                    <i class="fas fa-sync"></i>
                                </button>
                            </div>
                        </div>

                        <div id="optimization-placeholder" class="text-center p-4">
                            <div class="mb-3">
                                <i class="fas fa-check-circle fa-3x" style="color: #00b894;"></i>
                            </div>
                            <h3 class="text-lg font-bold mb-2">CV Otimizado com IA</h3>
                            <p class="text-secondary mb-3">Execute o rewriting para gerar seu CV otimizado</p>
                        </div>

                        <div id="optimization-results" class="hidden space-y-4">
                            <!-- Conte√∫do din√¢mico ser√° inserido aqui -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-bar"></i>
                                M√©tricas de Otimiza√ß√£o
                            </h3>
                        </div>

                        <div id="optimization-metrics" class="space-y-3">
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <h4 class="font-bold text-blue-700 mb-1">üìä Performance</h4>
                                <div class="space-y-2">
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm text-blue-700">Keywords</span>
                                            <span class="text-sm font-bold text-blue-700" id="keyword-density">0%</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="keyword-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm text-green-700">Relev√¢ncia</span>
                                            <span class="text-sm font-bold text-green-700"
                                                id="relevance-percent">0%</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="relevance-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="optimization-actions" class="space-y-2">
                                <!-- Bot√µes de a√ß√£o ser√£o inseridos aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <footer class="mt-5 pt-4">
            <div class="footer-container">
                <!-- Header compacto -->
                <div class="footer-header text-center mb-3">
                    <div class="footer-title">
                        <i class="fas fa-magic"></i> CV ReWriter Pro
                    </div>
                    <div style="font-size: 0.7rem; color: #64748b; margin-top: 2px;">
                        <a href="https://maker-ai-studio-tbx2.vercel.app/" target="_blank"
                            style="color: var(--primary); text-decoration: none;">
                            M√°rcio Maker ‚Ä¢ GitHub
                        </a>
                    </div>
                </div>
                <!-- Menu horizontal compacto -->
                <div class="footer-menu text-center mb-3">
                    <div class="menu-grid">
                        <div class="menu-item">
                            <i class="fas fa-clock"></i>
                            <span class="menu-text">
                                <span class="menu-label">√öltimo:</span>
                                <span id="last-rewrite-time" class="menu-value">--</span>
                            </span>
                        </div>
                        <div class="menu-item">
                            <i class="fas fa-brain"></i>
                            <span class="menu-text">
                                <span class="menu-label">ATS:</span>
                                <span id="learning-count" class="menu-value">0</span>
                            </span>
                        </div>
                        <div class="menu-item">
                            <button class="menu-btn" id="system-info" title="Informa√ß√µes do sistema">
                                <i class="fas fa-info"></i>
                                <span class="menu-text">Info</span>
                            </button>
                        </div>
                        <div class="menu-item">
                            <button class="menu-btn" id="reset-system" title="Resetar sistema">
                                <i class="fas fa-redo"></i>
                                <span class="menu-text">Reset</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Rodap√© minimalista -->
                <div class="footer-bottom text-center pt-3 border-t border-gray-300">
                    <p class="footer-security">
                        <i class="fas fa-shield-alt"></i> Processado localmente
                    </p>
                </div>
            </div>
        </footer>

    </div>

    <!-- MODAL PARA KEYWORDS -->
    <div class="modal-overlay" id="keywords-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="font-bold text-lg"><i class="fas fa-code"></i> Keywords da Vaga</h3>
                <button class="icon-btn close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="keywords-list" class="tags-container"></div>
                <p class="text-sm text-secondary mt-3" id="keywords-count">Total: 0 keywords</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary close-modal">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- OVERLAY DE LOADING -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Processando com IA...</div>
        <div class="text-gray-400 mt-3 text-sm" id="loading-subtext"></div>
    </div>

    <!-- SISTEMA DE NOTIFICA√á√ïES -->
    <div class="notification-system" id="notification-system"></div>

    <script>
        // ============ SISTEMA DE BACKEND LOCAL ============

        // 1. BANCO DE DADOS LOCAL (LOCALSTORAGE)
        class BancoDeDadosLocal {
            constructor() {
                this.KEYS = {
                    PERFIS: 'cvrewriter_perfis',
                    HISTORICO: 'cvrewriter_historico',
                    DICIONARIO: 'cvrewriter_dicionario',
                    EVOLUCAO: 'cvrewriter_evolucao',
                    ESTADO: 'cvrewriter_estado_atual',
                    PERSONAS: 'cvrewriter_personas_custom',
                    KEYWORDS: 'cvrewriter_keywords_aprendidas'
                };
                this.inicializarBancoDeDados();
            }

            inicializarBancoDeDados() {
                ['PERFIS', 'HISTORICO', 'DICIONARIO', 'EVOLUCAO', 'ESTADO', 'PERSONAS', 'KEYWORDS'].forEach(key => {
                    if (!localStorage.getItem(this.KEYS[key])) {
                        const valorPadrao = {
                            PERFIS: [],
                            HISTORICO: [],
                            DICIONARIO: {},
                            EVOLUCAO: { aprendizado: [], keywords: [] },
                            ESTADO: { perfilAtual: null, personaAtual: null, vagaAtual: null },
                            PERSONAS: {},
                            KEYWORDS: []
                        };
                        localStorage.setItem(this.KEYS[key], JSON.stringify(valorPadrao[key]));
                    }
                });
            }

            // PERFIS
            salvarPerfil(perfil) {
                try {
                    const perfis = this.carregarPerfis();
                    const index = perfis.findIndex(p => p.nome === perfil.nome);

                    if (index >= 0) {
                        perfis[index] = { ...perfil, atualizadoEm: new Date().toISOString() };
                    } else {
                        perfil.criadoEm = new Date().toISOString();
                        perfil.atualizadoEm = perfil.criadoEm;
                        perfis.push(perfil);
                    }

                    localStorage.setItem(this.KEYS.PERFIS, JSON.stringify(perfis));
                    this.salvarEstadoAtual({ perfilAtual: perfil.nome });

                    return { success: true, message: 'Perfil salvo com sucesso!' };
                } catch (error) {
                    return { success: false, message: 'Erro ao salvar perfil' };
                }
            }

            carregarPerfis() {
                try {
                    return JSON.parse(localStorage.getItem(this.KEYS.PERFIS)) || [];
                } catch {
                    return [];
                }
            }

            carregarPerfil(nome) {
                return this.carregarPerfis().find(p => p.nome === nome) || null;
            }

            // HIST√ìRICO
            registrarHistorico(acao, dados) {
                try {
                    const historico = this.carregarHistorico();
                    const registro = {
                        id: Date.now(),
                        acao,
                        dados,
                        data: new Date().toISOString(),
                        timestamp: Date.now()
                    };

                    historico.unshift(registro);
                    if (historico.length > 50) historico.pop();

                    localStorage.setItem(this.KEYS.HISTORICO, JSON.stringify(historico));
                    return registro;
                } catch {
                    return null;
                }
            }

            carregarHistorico() {
                try {
                    return JSON.parse(localStorage.getItem(this.KEYS.HISTORICO)) || [];
                } catch {
                    return [];
                }
            }

            // DICION√ÅRIO DE EVOLU√á√ÉO
            atualizarDicionario(termoOriginal, termoSubstituto, contexto = 'geral') {
                try {
                    const dicionario = this.carregarDicionario();

                    if (!dicionario[contexto]) dicionario[contexto] = [];

                    const existe = dicionario[contexto].find(item =>
                        item.original === termoOriginal && item.substituto === termoSubstituto
                    );

                    if (!existe) {
                        dicionario[contexto].push({
                            original: termoOriginal,
                            substituto: termoSubstituto,
                            usos: 1,
                            criadoEm: new Date().toISOString(),
                            ultimoUso: new Date().toISOString()
                        });
                    } else {
                        existe.usos++;
                        existe.ultimoUso = new Date().toISOString();
                    }

                    localStorage.setItem(this.KEYS.DICIONARIO, JSON.stringify(dicionario));
                    this.registrarAprendizado(termoOriginal, termoSubstituto, contexto);

                    return true;
                } catch {
                    return false;
                }
            }

            carregarDicionario() {
                try {
                    return JSON.parse(localStorage.getItem(this.KEYS.DICIONARIO)) || {};
                } catch {
                    return {};
                }
            }

            buscarSubstituto(termoOriginal, contexto = 'geral') {
                const dicionario = this.carregarDicionario();
                if (dicionario[contexto]) {
                    const item = dicionario[contexto].find(item => item.original === termoOriginal);
                    if (item) {
                        item.usos++;
                        item.ultimoUso = new Date().toISOString();
                        localStorage.setItem(this.KEYS.DICIONARIO, JSON.stringify(dicionario));
                        return item.substituto;
                    }
                }
                return null;
            }

            // APRENDIZADO
            registrarAprendizado(original, substituto, contexto) {
                try {
                    const evolucao = this.carregarEvolucao();
                    evolucao.aprendizado.push({ original, substituto, contexto, data: new Date().toISOString() });
                    this.adicionarKeywordAprendida(substituto);
                    localStorage.setItem(this.KEYS.EVOLUCAO, JSON.stringify(evolucao));
                    return true;
                } catch {
                    return false;
                }
            }

            adicionarKeywordAprendida(keyword) {
                try {
                    const keywords = this.carregarKeywords();
                    const existe = keywords.find(k => k.termo === keyword);

                    if (existe) {
                        existe.usos++;
                        existe.ultimoUso = new Date().toISOString();
                    } else {
                        keywords.push({
                            termo: keyword,
                            usos: 1,
                            aprendidoEm: new Date().toISOString(),
                            ultimoUso: new Date().toISOString()
                        });
                    }

                    localStorage.setItem(this.KEYS.KEYWORDS, JSON.stringify(keywords));
                    return true;
                } catch {
                    return false;
                }
            }

            carregarEvolucao() {
                try {
                    return JSON.parse(localStorage.getItem(this.KEYS.EVOLUCAO)) || { aprendizado: [], keywords: [] };
                } catch {
                    return { aprendizado: [], keywords: [] };
                }
            }

            carregarKeywords() {
                try {
                    return JSON.parse(localStorage.getItem(this.KEYS.KEYWORDS)) || [];
                } catch {
                    return [];
                }
            }

            getKeywordsAprendidas(limite = 20) {
                const keywords = this.carregarKeywords();
                return keywords
                    .sort((a, b) => b.usos - a.usos)
                    .slice(0, limite)
                    .map(k => k.termo);
            }

            // ESTADO
            salvarEstadoAtual(estado) {
                try {
                    const estadoAtual = this.carregarEstadoAtual();
                    const novoEstado = { ...estadoAtual, ...estado, atualizadoEm: new Date().toISOString() };
                    localStorage.setItem(this.KEYS.ESTADO, JSON.stringify(novoEstado));
                    return true;
                } catch {
                    return false;
                }
            }

            carregarEstadoAtual() {
                try {
                    return JSON.parse(localStorage.getItem(this.KEYS.ESTADO)) || { perfilAtual: null, personaAtual: null, vagaAtual: null };
                } catch {
                    return { perfilAtual: null, personaAtual: null, vagaAtual: null };
                }
            }

            // ESTAT√çSTICAS
            getEstatisticas() {
                return {
                    perfis: this.carregarPerfis().length,
                    historico: this.carregarHistorico().length,
                    termosAprendidos: Object.values(this.carregarDicionario()).reduce((acc, arr) => acc + arr.length, 0),
                    keywordsAprendidas: this.carregarKeywords().length,
                    aprendizadoRegistros: this.carregarEvolucao().aprendizado.length
                };
            }

            // BACKUP
            exportarBackup() {
                try {
                    const backup = {
                        perfis: this.carregarPerfis(),
                        historico: this.carregarHistorico(),
                        dicionario: this.carregarDicionario(),
                        evolucao: this.carregarEvolucao(),
                        estado: this.carregarEstadoAtual(),
                        keywords: this.carregarKeywords(),
                        metadata: {
                            exportadoEm: new Date().toISOString(),
                            versao: '1.0'
                        }
                    };
                    return JSON.stringify(backup, null, 2);
                } catch {
                    return null;
                }
            }

            importarBackup(backupJSON) {
                try {
                    const backup = JSON.parse(backupJSON);

                    localStorage.setItem(this.KEYS.PERFIS, JSON.stringify(backup.perfis || []));
                    localStorage.setItem(this.KEYS.HISTORICO, JSON.stringify(backup.historico || []));
                    localStorage.setItem(this.KEYS.DICIONARIO, JSON.stringify(backup.dicionario || {}));
                    localStorage.setItem(this.KEYS.EVOLUCAO, JSON.stringify(backup.evolucao || { aprendizado: [], keywords: [] }));
                    localStorage.setItem(this.KEYS.ESTADO, JSON.stringify(backup.estado || {}));
                    localStorage.setItem(this.KEYS.KEYWORDS, JSON.stringify(backup.keywords || []));

                    return { success: true, message: 'Backup restaurado!' };
                } catch {
                    return { success: false, message: 'Erro ao restaurar backup' };
                }
            }
        }

        // 2. IA LOCAL (PATTERN MATCHING)
        class IALocalPatternMatching {
            constructor(bd) {
                this.bd = bd;
                this.pesos = { EXATA: 1.0, PARCIAL: 0.7, SINONIMO: 0.5, CONTEXTO: 0.3, APRENDIZADO: 0.8 };

                this.sinonimosBase = {
                    'desenvolvedor': ['dev', 'developer', 'programador'],
                    'javascript': ['js'],
                    'react': ['react.js'],
                    'node.js': ['node'],
                    'python': ['py'],
                    'aws': ['amazon web services'],
                    'docker': ['container'],
                    'api': ['interface de programa√ß√£o']
                };
            }

            analisarRelevancia(cvTexto, vagaTexto) {
                const keywordsVaga = this.extrairKeywords(vagaTexto);
                let scoreTotal = 0;
                let maxScore = 0;
                const matches = [];

                keywordsVaga.forEach(keywordVaga => {
                    const cvLower = cvTexto.toLowerCase();
                    const vagaLower = keywordVaga.toLowerCase();

                    let melhorScore = 0;
                    let tipo = 'nenhum';

                    if (cvLower.includes(vagaLower)) {
                        melhorScore = this.pesos.EXATA;
                        tipo = 'exato';
                    } else if (cvLower.includes(vagaLower.substring(0, vagaLower.length - 1))) {
                        melhorScore = this.pesos.PARCIAL;
                        tipo = 'parcial';
                    } else if (this.saoSinonimos(vagaLower, cvLower)) {
                        melhorScore = this.pesos.SINONIMO;
                        tipo = 'sinonimo';
                    }

                    const pesoKeyword = this.getPesoPorTipo(keywordVaga);
                    const keywordScore = melhorScore * pesoKeyword;

                    scoreTotal += keywordScore;
                    maxScore += this.pesos.EXATA * pesoKeyword;

                    if (melhorScore > 0) {
                        matches.push({ keywordVaga, tipo, score: keywordScore });
                    }
                });

                const scoreFinal = maxScore > 0 ? (scoreTotal / maxScore) * 100 : 0;

                return {
                    score: Math.min(100, Math.round(scoreFinal)),
                    matches,
                    keywordsVaga,
                    recomendacoes: this.gerarRecomendacoes(scoreFinal, matches, keywordsVaga)
                };
            }

            extrairKeywords(texto) {
                if (!texto) return [];

                const textoLimpo = texto.toLowerCase()
                    .replace(/[^\w\s√°√©√≠√≥√∫√£√µ√¢√™√Æ√¥√ª√†√®√¨√≤√π√ß]/gi, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();

                const palavras = textoLimpo.split(' ');
                const stopWords = new Set(['a', 'o', 'as', 'os', 'de', 'do', 'da', 'em', 'no', 'na', 'por', 'para', 'com', 'e', 'ou']);

                const palavrasFiltradas = palavras.filter(palavra =>
                    palavra.length > 2 && !stopWords.has(palavra)
                );

                const frequencia = {};
                palavrasFiltradas.forEach(palavra => {
                    frequencia[palavra] = (frequencia[palavra] || 0) + 1;
                });

                const keywordsCompostas = this.extrairKeywordsCompostas(textoLimpo);
                let todasKeywords = [...keywordsCompostas];

                Object.entries(frequencia)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 20)
                    .forEach(([palavra]) => {
                        if (palavra.length > 3 && !todasKeywords.some(k => k.includes(palavra))) {
                            todasKeywords.push(palavra);
                        }
                    });

                const keywordsAprendidas = this.bd.getKeywordsAprendidas(5);
                keywordsAprendidas.forEach(kw => {
                    if (textoLimpo.includes(kw.toLowerCase()) && !todasKeywords.includes(kw)) {
                        todasKeywords.push(kw);
                    }
                });

                return [...new Set(todasKeywords)].slice(0, 30);
            }

            extrairKeywordsCompostas(texto) {
                const padroes = [
                    'full stack', 'back end', 'front end', 'web development',
                    'software engineer', 'data science', 'machine learning',
                    'cloud computing', 'devops', 'ux/ui', 'react native',
                    'node.js', 'type script', 'java script', 'rest api'
                ];

                return padroes.filter(padrao =>
                    texto.includes(padrao.replace(' ', '')) || texto.includes(padrao)
                );
            }

            saoSinonimos(termo1, termo2) {
                for (const [base, sinonimos] of Object.entries(this.sinonimosBase)) {
                    if ((termo1 === base || sinonimos.includes(termo1)) &&
                        (termo2 === base || sinonimos.includes(termo2))) {
                        return true;
                    }
                }
                return false;
            }

            getPesoPorTipo(keyword) {
                const kw = keyword.toLowerCase();
                const tecnologias = ['javascript', 'react', 'node', 'python', 'java', 'aws', 'docker', 'sql'];
                const metodologias = ['scrum', 'agile', 'devops', 'tdd', 'ci/cd'];

                if (tecnologias.some(t => kw.includes(t))) return 1.2;
                if (metodologias.some(m => kw.includes(m))) return 1.0;
                return 0.8;
            }

            gerarRecomendacoes(score, matches, keywordsVaga) {
                const recomendacoes = [];
                const percentual = Math.round(score);

                if (percentual < 40) {
                    recomendacoes.push(`Alinhamento baixo (${percentual}%). Reestruture seu CV.`);
                    recomendacoes.push(`Adicione keywords espec√≠ficas da vaga.`);
                } else if (percentual < 60) {
                    recomendacoes.push(`Alinhamento moderado (${percentual}%). Melhore o foco.`);
                } else if (percentual < 80) {
                    recomendacoes.push(`Bom alinhamento (${percentual}%). Ajustes pontuais.`);
                } else {
                    recomendacoes.push(`Excelente alinhamento (${percentual}%)!`);
                }

                const matchesCount = matches.filter(m => m.tipo === 'exato' || m.tipo === 'parcial').length;
                if (matchesCount < keywordsVaga.length / 2) {
                    recomendacoes.push(`Adicione mais keywords espec√≠ficas da vaga.`);
                }

                return recomendacoes;
            }
        }

        // 3. SISTEMA DE AUTO-ALIMENTA√á√ÉO
        class SistemaAutoAlimentacao {
            constructor(bd) {
                this.bd = bd;
                this.ultimoTexto = '';
            }

            iniciarMonitoramento(elementoId) {
                const elemento = document.getElementById(elementoId);
                if (!elemento) return;

                elemento.addEventListener('input', (e) => {
                    this.processarAlteracao(e.target.value, elementoId);
                });
            }

            processarAlteracao(novoTexto, contexto) {
                if (!this.ultimoTexto || novoTexto === this.ultimoTexto) {
                    this.ultimoTexto = novoTexto;
                    return;
                }

                const alteracoes = this.detectarAlteracoes(this.ultimoTexto, novoTexto);
                if (alteracoes.length > 0) {
                    this.registrarAlteracoes(alteracoes, contexto);
                    this.ultimoTexto = novoTexto;
                }
            }

            detectarAlteracoes(antigo, novo) {
                const alteracoes = [];
                const palavrasAntigas = antigo.toLowerCase().split(/\s+/);
                const palavrasNovas = novo.toLowerCase().split(/\s+/);

                palavrasNovas.forEach(palavra => {
                    if (palavra.length > 3 && !palavrasAntigas.includes(palavra)) {
                        const similar = palavrasAntigas.find(p =>
                            this.calcularSimilaridade(p, palavra) > 0.7
                        );
                        if (similar) {
                            alteracoes.push({
                                original: similar,
                                substituto: palavra,
                                tipo: 'substituicao'
                            });
                        }
                    }
                });

                return alteracoes;
            }

            registrarAlteracoes(alteracoes, contexto) {
                alteracoes.forEach(alt => {
                    if (alt.tipo === 'substituicao') {
                        this.bd.atualizarDicionario(alt.original, alt.substituto, contexto);
                        console.log(`Aprendizado: "${alt.original}" ‚Üí "${alt.substituto}"`);
                    }
                });
            }

            calcularSimilaridade(str1, str2) {
                if (str1 === str2) return 1;
                const maxLen = Math.max(str1.length, str2.length);
                const distance = this.levenshteinDistance(str1, str2);
                return 1 - distance / maxLen;
            }

            levenshteinDistance(str1, str2) {
                const matrix = [];
                for (let i = 0; i <= str2.length; i++) matrix[i] = [i];
                for (let j = 0; j <= str1.length; j++) matrix[0][j] = j;

                for (let i = 1; i <= str2.length; i++) {
                    for (let j = 1; j <= str1.length; j++) {
                        const cost = str1[j - 1] === str2[i - 1] ? 0 : 1;
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j - 1] + cost
                        );
                    }
                }
                return matrix[str2.length][str1.length];
            }
        }

        // 4. MOTOR DE PERSONAS
        class MotorDePersonas {
            constructor(bd) {
                this.bd = bd;
                this.personas = {
                    frontend: {
                        verbos: ['desenvolver', 'implementar', 'criar', 'otimizar'],
                        adjetivos: ['responsivo', 'moderno', 'intuitivo'],
                        substantivos: ['interface', 'experi√™ncia', 'componente'],
                        foco: ['Front-end', 'React', 'Vue', 'JavaScript'],
                        englishTemplates: {
                            objective: (cvData) => `Front-end developer specialized in creating modern, responsive, and high-performance interfaces. Seeking opportunities to apply my expertise in ${this.extractMainTech(cvData.habilidades, 'frontend')} in challenging projects that value user experience and visual quality.`,
                            summary: (cvData, anos) => `Front-end Developer with ${anos} of experience specialized in ${this.extractMainTech(cvData.habilidades, 'frontend')}. Expertise in creating responsive interfaces, optimizing performance, and implementing complex designs with fidelity.`
                        }
                    },
                    backend: {
                        verbos: ['arquitetar', 'escalar', 'processar', 'integrar'],
                        adjetivos: ['escal√°vel', 'seguro', 'robusto'],
                        substantivos: ['API', 'servidor', 'banco de dados'],
                        foco: ['Back-end', 'Node.js', 'Python', 'API'],
                        englishTemplates: {
                            objective: (cvData) => `Back-end developer specialized in scalable system architecture and robust APIs. Looking to contribute with my experience in ${this.extractMainTech(cvData.habilidades, 'backend')} to build secure, high-performance, and maintainable solutions.`,
                            summary: (cvData, anos) => `Back-end Developer with ${anos} of experience in ${this.extractMainTech(cvData.habilidades, 'backend')}. Focus on scalable architecture, data security, and development of robust APIs for high-traffic systems.`
                        }
                    },
                    fullstack: {
                        verbos: ['integrar', 'gerenciar', 'automatizar'],
                        adjetivos: ['completo', 'integrado', 'automatizado'],
                        substantivos: ['sistema', 'pipeline', 'infraestrutura'],
                        foco: ['Full Stack', 'DevOps', 'Cloud'],
                        englishTemplates: {
                            objective: (cvData) => `Full Stack developer with comprehensive vision of software development. Seeking positions where I can apply my skills in ${this.extractMainTech(cvData.habilidades, 'fullstack')} to deliver complete end-to-end solutions with focus on business results.`,
                            summary: (cvData, anos) => `Full Stack Developer with ${anos} of experience in ${this.extractMainTech(cvData.habilidades, 'fullstack')}. Ability to work throughout the development cycle, from front-end to infrastructure, with a holistic product vision.`
                        }
                    },
                    uxdev: {
                        verbos: ['prototipar', 'testar', 'validar'],
                        adjetivos: ['us√°vel', 'acess√≠vel', 'intuitivo'],
                        substantivos: ['prot√≥tipo', 'user journey', 'design'],
                        foco: ['UX/UI', 'Figma', 'Prototipa√ß√£o'],
                        englishTemplates: {
                            objective: (cvData) => `Professional at the intersection of Design and Development. Looking for projects where I can combine my technical expertise in ${this.extractMainTech(cvData.habilidades, 'frontend')} with UX/UI principles to create intuitive, accessible, and visually appealing digital products.`,
                            summary: (cvData, anos) => `Developer with UX/UI focus and ${anos} of experience in ${this.extractMainTech(cvData.habilidades, 'frontend')}. Specialized in translating designs into functional code, with attention to usability, accessibility, and user experience.`
                        }
                    },
                    produto: {
                        verbos: ['liderar', 'estrategizar', 'analisar'],
                        adjetivos: ['estrat√©gico', 'inovador', 'orientado a dados'],
                        substantivos: ['produto', 'm√©trica', 'roadmap'],
                        foco: ['Produto', 'Estrat√©gia', 'M√©tricas'],
                        englishTemplates: {
                            objective: (cvData) => `Tech professional with product mindset. Seeking opportunities to apply ${this.extractMainTech(cvData.habilidades)} to solve complex business problems, focusing on metrics, innovation, and measurable impact.`,
                            summary: (cvData, anos) => `Tech Professional with product mindset and ${anos} of experience in ${this.extractMainTech(cvData.habilidades)}. Focused on solving business problems through technology, with a data-driven approach oriented to metrics.`
                        }
                    }
                };
            }

            extractMainTech(skillsText, focus) {
                if (!skillsText) return 'tecnologias modernas';

                const skills = skillsText.split(/[,;\n]/).map(s => s.trim()).filter(s => s);

                if (focus === 'frontend') {
                    const frontendSkills = skills.filter(s =>
                        /react|vue|angular|javascript|typescript|css|html|ui|ux|frontend|sass|less|tailwind/i.test(s.toLowerCase())
                    );
                    return frontendSkills.length > 0 ? frontendSkills.slice(0, 3).join(', ') : 'front-end technologies';
                }

                if (focus === 'backend') {
                    const backendSkills = skills.filter(s =>
                        /node|python|java|c#|php|api|rest|graphql|sql|nosql|docker|aws|backend|server|microservice/i.test(s.toLowerCase())
                    );
                    return backendSkills.length > 0 ? backendSkills.slice(0, 3).join(', ') : 'back-end technologies';
                }

                if (focus === 'fullstack') {
                    const fullstackSkills = skills.filter(s =>
                        /full.?stack|javascript|node|react|api|database|devops|agile|cloud/i.test(s.toLowerCase())
                    );
                    return fullstackSkills.length > 0 ? fullstackSkills.slice(0, 3).join(', ') : 'full stack technologies';
                }

                return skills.length > 0 ? skills.slice(0, 3).join(', ') : 'modern technologies';
            }

            estimateExperienceYears(experienceText) {
                if (!experienceText) return 'more than 3 years';

                const yearMatches = experienceText.matchAll(/(\d{4})\s*[-‚Äì]\s*(\d{4}|Atual|atual|Presente)/g);
                let totalYears = 0;
                let count = 0;

                for (const match of yearMatches) {
                    const startYear = parseInt(match[1]);
                    const endYear = match[2].toLowerCase() === 'atual' || match[2].toLowerCase() === 'presente' ?
                        new Date().getFullYear() : parseInt(match[2]);
                    if (!isNaN(startYear) && !isNaN(endYear)) {
                        totalYears += (endYear - startYear);
                        count++;
                    }
                }

                if (count > 0) {
                    const avgYears = Math.round(totalYears / count);
                    return avgYears >= 1 ? `${avgYears} year${avgYears > 1 ? 's' : ''}` : 'more than 1 year';
                }

                return 'more than 3 years';
            }

            applyPersona(cvDados, personaName, jobKeywords = [], isEnglish = false) {
                const persona = this.personas[personaName];
                if (!persona) return cvDados;

                const cvModified = { ...cvDados };
                const anosExperiencia = this.estimateExperienceYears(cvDados.experiencia);

                if (isEnglish && persona.englishTemplates) {
                    cvModified.objetivo = persona.englishTemplates.objective(cvDados);
                    cvModified.resumo = persona.englishTemplates.summary(cvDados, anosExperiencia);
                } else {
                    cvModified.objetivo = persona.objectiveTemplate(cvDados);
                    cvModified.resumo = persona.summaryTemplate(cvDados, anosExperiencia);
                }

                cvModified.habilidades = this.reorderSkillsForPersona(
                    cvDados.habilidades,
                    persona.foco,
                    jobKeywords
                );

                return cvModified;
            }

            reorderSkillsForPersona(skillsText, personaFocus, jobKeywords) {
                if (!skillsText) return '';

                const skills = skillsText.split(/[,;\n]/).map(s => s.trim()).filter(s => s);

                const priority1 = [];
                const priority2 = [];
                const priority3 = [];
                const priority4 = [];

                skills.forEach(skill => {
                    const skillLower = skill.toLowerCase();
                    let isPersonaSkill = false;
                    let isJobKeyword = false;

                    for (const focus of personaFocus) {
                        if (skillLower.includes(focus.toLowerCase()) ||
                            focus.toLowerCase().includes(skillLower)) {
                            isPersonaSkill = true;
                            break;
                        }
                    }

                    if (jobKeywords.some(keyword =>
                        skillLower.includes(keyword.toLowerCase()) ||
                        keyword.toLowerCase().includes(skillLower))) {
                        isJobKeyword = true;
                    }

                    if (isPersonaSkill) {
                        priority1.push(skill);
                    } else if (isJobKeyword) {
                        priority2.push(skill);
                    } else if (this.isRelatedTech(skillLower, personaFocus)) {
                        priority3.push(skill);
                    } else {
                        priority4.push(skill);
                    }
                });

                const allSkills = [...priority1, ...priority2, ...priority3, ...priority4];
                const uniqueSkills = [...new Set(allSkills)];

                return uniqueSkills.join(', ');
            }

            isRelatedTech(skill, personaFocus) {
                const frontendTechs = ['react', 'vue', 'angular', 'javascript', 'typescript', 'css', 'html', 'sass', 'less'];
                const backendTechs = ['node', 'python', 'java', 'c#', 'php', 'sql', 'nosql', 'docker', 'aws', 'api'];

                if (personaFocus.some(pf => pf.toLowerCase().includes('front') || pf.toLowerCase().includes('ui'))) {
                    return frontendTechs.some(tech => skill.includes(tech));
                }

                if (personaFocus.some(pf => pf.toLowerCase().includes('back') || pf.toLowerCase().includes('api'))) {
                    return backendTechs.some(tech => skill.includes(tech));
                }

                return false;
            }

            getPersonaDescription(personaName) {
                const persona = this.personas[personaName];
                return persona ? persona.description : '';
            }

            getPersonaName(personaName) {
                const persona = this.personas[personaName];
                return persona ? persona.name : '';
            }
        }

        // 5. SISTEMA INTEGRADO
        class SistemaIntegradoCVReWriter {
            constructor() {
                this.bd = new BancoDeDadosLocal();
                this.ia = new IALocalPatternMatching(this.bd);
                this.autoAlimentacao = new SistemaAutoAlimentacao(this.bd);
                this.motorPersonas = new MotorDePersonas(this.bd);
                this.estado = { vagaAtual: null, cvAtual: null, personaAtual: null };
            }

            analisarVaga(vagaTexto) {
                if (!vagaTexto || vagaTexto.length < 20) {
                    return { success: false, message: 'Texto da vaga muito curto' };
                }

                this.estado.vagaAtual = vagaTexto;
                this.bd.salvarEstadoAtual({ vagaAtual: vagaTexto });

                const cvTexto = this.estado.cvAtual ? JSON.stringify(this.estado.cvAtual) : '';
                const analise = this.ia.analisarRelevancia(cvTexto, vagaTexto);

                this.bd.registrarHistorico('analise_vaga', {
                    keywords: analise.keywordsVaga.length,
                    score: analise.score
                });

                return {
                    success: true,
                    data: analise,
                    message: `${analise.keywordsVaga.length} keywords detectadas`
                };
            }

            salvarPerfilCV(dadosCV) {
                if (!dadosCV.nome || !dadosCV.habilidades) {
                    return { success: false, message: 'Nome e habilidades s√£o obrigat√≥rios' };
                }

                const resultado = this.bd.salvarPerfil(dadosCV);
                if (resultado.success) {
                    this.estado.cvAtual = dadosCV;
                    this.bd.registrarHistorico('salvar_perfil', {
                        nome: dadosCV.nome,
                        skills: dadosCV.habilidades.split(',').length
                    });
                }

                return resultado;
            }

            executarRewriting(personaNome, isEnglish = false) {
                if (!this.estado.cvAtual) {
                    return { success: false, message: 'Configure seu CV primeiro' };
                }

                this.estado.personaAtual = personaNome;
                this.bd.salvarEstadoAtual({ personaAtual: personaNome });

                const cvOriginal = { ...this.estado.cvAtual };
                let cvReescrito = { ...cvOriginal };

                cvReescrito = this.motorPersonas.applyPersona(
                    cvOriginal,
                    personaNome,
                    this.ia.extrairKeywords(this.estado.vagaAtual || ''),
                    isEnglish
                );

                this.bd.registrarHistorico('rewriting', {
                    persona: personaNome,
                    idioma: isEnglish ? 'ingl√™s' : 'portugu√™s',
                    alteracoes: 3
                });

                return {
                    success: true,
                    data: {
                        original: cvOriginal,
                        reescrito: cvReescrito,
                        persona: personaNome,
                        idioma: isEnglish ? 'en' : 'pt'
                    },
                    message: `Rewriting com persona "${personaNome}" em ${isEnglish ? 'ingl√™s' : 'portugu√™s'}`
                };
            }

            exportarBackup() {
                const backup = this.bd.exportarBackup();
                if (backup) {
                    const blob = new Blob([backup], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');

                    a.href = url;
                    a.download = `cvrewriter_backup_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    return { success: true, message: 'Backup exportado!' };
                }

                return { success: false, message: 'Erro ao exportar' };
            }

            async importarBackup(arquivo) {
                return new Promise((resolve) => {
                    const reader = new FileReader();

                    reader.onload = (e) => {
                        try {
                            const resultado = this.bd.importarBackup(e.target.result);
                            resolve(resultado);
                        } catch {
                            resolve({ success: false, message: 'Erro ao processar arquivo' });
                        }
                    };

                    reader.onerror = () => {
                        resolve({ success: false, message: 'Erro ao ler arquivo' });
                    };

                    reader.readAsText(arquivo);
                });
            }

            getEstatisticas() {
                return this.bd.getEstatisticas();
            }

            getKeywordsAprendidas() {
                return this.bd.getKeywordsAprendidas();
            }
        }

        // ============ SISTEMA COMPLETO DE REWRITING COM PERSONAS ============
        class PersonaSystem {
            constructor() {
                this.personas = {
                    frontend: {
                        name: "Foco Front-end",
                        icon: "fa-palette",
                        description: "√änfase em interfaces, reatividade (React/Vue), performance e fidelidade ao layout.",
                        objectiveTemplate: (cvData) => `Profissional especializado em desenvolvimento front-end com foco em criar interfaces modernas, responsivas e de alta performance. Busco oportunidades para aplicar minha expertise em ${this.extractMainTech(cvData.habilidades, 'frontend')} em projetos desafiadores que valorizam a experi√™ncia do usu√°rio e a qualidade visual.`,
                        skillsFocus: ['React', 'Vue', 'JavaScript', 'TypeScript', 'CSS', 'HTML5', 'Responsive Design', 'UI/UX', 'Performance', 'Webpack', 'Vite', 'Frontend'],
                        summaryTemplate: (cvData, anos) => `Front-end Developer com ${anos} de experi√™ncia especializada em ${this.extractMainTech(cvData.habilidades, 'frontend')}. Expertise em criar interfaces responsivas, otimizar performance e implementar designs complexos com fidelidade.`,
                        englishObjective: (cvData) => `Front-end developer specialized in creating modern, responsive, and high-performance interfaces. Seeking opportunities to apply my expertise in ${this.extractMainTech(cvData.habilidades, 'frontend')} in challenging projects that value user experience and visual quality.`,
                        englishSummary: (cvData, anos) => `Front-end Developer with ${anos} of experience specialized in ${this.extractMainTech(cvData.habilidades, 'frontend')}. Expertise in creating responsive interfaces, optimizing performance, and implementing complex designs with fidelity.`
                    },
                    backend: {
                        name: "Foco Back-end",
                        icon: "fa-server",
                        description: "√änfase em APIs, seguran√ßa, bancos de dados, escalabilidade e l√≥gica de neg√≥cio.",
                        objectiveTemplate: (cvData) => `Desenvolvedor back-end especializado em arquitetura de sistemas escal√°veis e APIs robustas. Busco contribuir com minha experi√™ncia em ${this.extractMainTech(cvData.habilidades, 'backend')} para construir solu√ß√µes seguras, perform√°ticas e de f√°cil manuten√ß√£o.`,
                        skillsFocus: ['Node.js', 'Python', 'Java', 'C#', 'API REST', 'GraphQL', 'SQL', 'NoSQL', 'Docker', 'AWS', 'Security', 'Microservices', 'Backend', 'APIs'],
                        summaryTemplate: (cvData, anos) => `Back-end Developer com ${anos} de experi√™ncia em ${this.extractMainTech(cvData.habilidades, 'backend')}. Foco em arquitetura escal√°vel, seguran√ßa de dados e desenvolvimento de APIs robustas para sistemas de alto tr√°fego.`,
                        englishObjective: (cvData) => `Back-end developer specialized in scalable system architecture and robust APIs. Looking to contribute with my experience in ${this.extractMainTech(cvData.habilidades, 'backend')} to build secure, high-performance, and maintainable solutions.`,
                        englishSummary: (cvData, anos) => `Back-end Developer with ${anos} of experience in ${this.extractMainTech(cvData.habilidades, 'backend')}. Focus on scalable architecture, data security, and development of robust APIs for high-traffic systems.`
                    },
                    fullstack: {
                        name: "Foco Full Stack",
                        icon: "fa-layer-group",
                        description: "√änfase na vis√£o hol√≠stica, integra√ß√£o entre camadas e agilidade na entrega ponta-a-ponta.",
                        objectiveTemplate: (cvData) => `Desenvolvedor Full Stack com vis√£o integral do desenvolvimento de software. Busco posi√ß√µes onde possa aplicar minhas habilidades em ${this.extractMainTech(cvData.habilidades, 'fullstack')} para entregar solu√ß√µes completas, do front-end ao back-end, com foco em resultados de neg√≥cio.`,
                        skillsFocus: ['Full Stack', 'JavaScript', 'Node.js', 'React', 'API', 'Database', 'DevOps', 'Agile', 'Cloud', 'CI/CD', 'End-to-end'],
                        summaryTemplate: (cvData, anos) => `Full Stack Developer com ${anos} de experi√™ncia em ${this.extractMainTech(cvData.habilidades, 'fullstack')}. Capacidade de atuar em todo o ciclo de desenvolvimento, desde o front-end at√© a infraestrutura, com vis√£o hol√≠stica de produto.`,
                        englishObjective: (cvData) => `Full Stack developer with comprehensive vision of software development. Seeking positions where I can apply my skills in ${this.extractMainTech(cvData.habilidades, 'fullstack')} to deliver complete end-to-end solutions with focus on business results.`,
                        englishSummary: (cvData, anos) => `Full Stack Developer with ${anos} of experience in ${this.extractMainTech(cvData.habilidades, 'fullstack')}. Ability to work throughout the development cycle, from front-end to infrastructure, with a holistic product vision.`
                    },
                    uxdev: {
                        name: "Foco UX/UI Design & Dev",
                        icon: "fa-pen-nib",
                        description: "√änfase em usabilidade, acessibilidade e na ponte entre o design e o c√≥digo.",
                        objectiveTemplate: (cvData) => `Profissional na intersec√ß√£o entre Design e Desenvolvimento. Busco projetos onde possa unir minha expertise t√©cnica em ${this.extractMainTech(cvData.habilidades, 'frontend')} com princ√≠pios de UX/UI para criar produtos digitais intuitivos, acess√≠veis e visualmente atrativos.`,
                        skillsFocus: ['UI/UX Design', 'Figma', 'Adobe XD', 'React', 'CSS', 'Prototyping', 'User Research', 'Accessibility', 'Design System', 'Frontend', 'Usabilidade'],
                        summaryTemplate: (cvData, anos) => `Developer com foco em UX/UI e ${anos} de experi√™ncia em ${this.extractMainTech(cvData.habilidades, 'frontend')}. Especializado em traduzir designs em c√≥digo funcional, com aten√ß√£o √† usabilidade, acessibilidade e experi√™ncia do usu√°rio.`,
                        englishObjective: (cvData) => `Professional at the intersection of Design and Development. Looking for projects where I can combine my technical expertise in ${this.extractMainTech(cvData.habilidades, 'frontend')} with UX/UI principles to create intuitive, accessible, and visually appealing digital products.`,
                        englishSummary: (cvData, anos) => `Developer with UX/UI focus and ${anos} of experience in ${this.extractMainTech(cvData.habilidades, 'frontend')}. Specialized in translating designs into functional code, with attention to usability, accessibility, and user experience.`
                    },
                    produto: {
                        name: "Foco Inova√ß√£o/Produto",
                        icon: "fa-chart-line",
                        description: "√änfase em resolver problemas de neg√≥cio atrav√©s da tecnologia, sugerindo melhorias e focado em m√©tricas.",
                        objectiveTemplate: (cvData) => `Profissional tech com mentalidade de produto. Busco oportunidades para aplicar ${this.extractMainTech(cvData.habilidades)} na resolu√ß√£o de problemas complexos de neg√≥cio, focando em m√©tricas, inova√ß√£o e impacto mensur√°vel.`,
                        skillsFocus: ['Product Mindset', 'Agile', 'Metrics', 'Business Analysis', 'Problem Solving', 'Innovation', 'Data-driven', 'Strategy', 'Technical Leadership', 'Product'],
                        summaryTemplate: (cvData, anos) => `Tech Professional com mentalidade de produto e ${anos} de experi√™ncia em ${this.extractMainTech(cvData.habilidades)}. Focado em resolver problemas de neg√≥cio atrav√©s da tecnologia, com abordagem data-driven e orientada a m√©tricas.`,
                        englishObjective: (cvData) => `Tech professional with product mindset. Seeking opportunities to apply ${this.extractMainTech(cvData.habilidades)} to solve complex business problems, focusing on metrics, innovation, and measurable impact.`,
                        englishSummary: (cvData, anos) => `Tech Professional with product mindset and ${anos} of experience in ${this.extractMainTech(cvData.habilidades)}. Focused on solving business problems through technology, with a data-driven approach oriented to metrics.`
                    }
                };
            }

            extractMainTech(skillsText, focus) {
                if (!skillsText) return 'tecnologias modernas';

                const skills = skillsText.split(/[,;\n]/).map(s => s.trim()).filter(s => s);

                if (focus === 'frontend') {
                    const frontendSkills = skills.filter(s =>
                        /react|vue|angular|javascript|typescript|css|html|ui|ux|frontend|sass|less|tailwind/i.test(s.toLowerCase())
                    );
                    return frontendSkills.length > 0 ? frontendSkills.slice(0, 3).join(', ') : 'tecnologias front-end';
                }

                if (focus === 'backend') {
                    const backendSkills = skills.filter(s =>
                        /node|python|java|c#|php|api|rest|graphql|sql|nosql|docker|aws|backend|server|microservice/i.test(s.toLowerCase())
                    );
                    return backendSkills.length > 0 ? backendSkills.slice(0, 3).join(', ') : 'tecnologias back-end';
                }

                if (focus === 'fullstack') {
                    const fullstackSkills = skills.filter(s =>
                        /full.?stack|javascript|node|react|api|database|devops|agile|cloud/i.test(s.toLowerCase())
                    );
                    return fullstackSkills.length > 0 ? fullstackSkills.slice(0, 3).join(', ') : 'tecnologias full stack';
                }

                return skills.length > 0 ? skills.slice(0, 3).join(', ') : 'tecnologias modernas';
            }

            estimateExperienceYears(experienceText) {
                if (!experienceText) return 'mais de 3 anos';

                const yearMatches = experienceText.matchAll(/(\d{4})\s*[-‚Äì]\s*(\d{4}|Atual|atual|Presente)/g);
                let totalYears = 0;
                let count = 0;

                for (const match of yearMatches) {
                    const startYear = parseInt(match[1]);
                    const endYear = match[2].toLowerCase() === 'atual' || match[2].toLowerCase() === 'presente' ?
                        new Date().getFullYear() : parseInt(match[2]);
                    if (!isNaN(startYear) && !isNaN(endYear)) {
                        totalYears += (endYear - startYear);
                        count++;
                    }
                }

                if (count > 0) {
                    const avgYears = Math.round(totalYears / count);
                    return avgYears >= 1 ? `${avgYears} ano${avgYears > 1 ? 's' : ''}` : 'mais de 1 ano';
                }

                return 'mais de 3 anos';
            }

            applyPersona(cvDados, personaName, jobKeywords = [], isEnglish = false) {
                const persona = this.personas[personaName];
                if (!persona) return cvDados;

                const cvModified = { ...cvDados };
                const anosExperiencia = this.estimateExperienceYears(cvDados.experiencia);

                if (isEnglish && persona.englishObjective) {
                    cvModified.objetivo = persona.englishObjective(cvDados);
                    cvModified.resumo = persona.englishSummary(cvDados, anosExperiencia);
                } else {
                    cvModified.objetivo = persona.objectiveTemplate(cvDados);
                    cvModified.resumo = persona.summaryTemplate(cvDados, anosExperiencia);
                }

                cvModified.habilidades = this.reorderSkillsForPersona(
                    cvDados.habilidades,
                    persona.skillsFocus,
                    jobKeywords
                );

                return cvModified;
            }

            reorderSkillsForPersona(skillsText, personaFocus, jobKeywords) {
                if (!skillsText) return '';

                const skills = skillsText.split(/[,;\n]/).map(s => s.trim()).filter(s => s);

                const priority1 = [];
                const priority2 = [];
                const priority3 = [];
                const priority4 = [];

                skills.forEach(skill => {
                    const skillLower = skill.toLowerCase();
                    let isPersonaSkill = false;
                    let isJobKeyword = false;

                    for (const focus of personaFocus) {
                        if (skillLower.includes(focus.toLowerCase()) ||
                            focus.toLowerCase().includes(skillLower)) {
                            isPersonaSkill = true;
                            break;
                        }
                    }

                    if (jobKeywords.some(keyword =>
                        skillLower.includes(keyword.toLowerCase()) ||
                        keyword.toLowerCase().includes(skillLower))) {
                        isJobKeyword = true;
                    }

                    if (isPersonaSkill) {
                        priority1.push(skill);
                    } else if (isJobKeyword) {
                        priority2.push(skill);
                    } else if (this.isRelatedTech(skillLower, personaFocus)) {
                        priority3.push(skill);
                    } else {
                        priority4.push(skill);
                    }
                });

                const allSkills = [...priority1, ...priority2, ...priority3, ...priority4];
                const uniqueSkills = [...new Set(allSkills)];

                return uniqueSkills.join(', ');
            }

            isRelatedTech(skill, personaFocus) {
                const frontendTechs = ['react', 'vue', 'angular', 'javascript', 'typescript', 'css', 'html', 'sass', 'less'];
                const backendTechs = ['node', 'python', 'java', 'c#', 'php', 'sql', 'nosql', 'docker', 'aws', 'api'];

                if (personaFocus.some(pf => pf.toLowerCase().includes('front') || pf.toLowerCase().includes('ui'))) {
                    return frontendTechs.some(tech => skill.includes(tech));
                }

                if (personaFocus.some(pf => pf.toLowerCase().includes('back') || pf.toLowerCase().includes('api'))) {
                    return backendTechs.some(tech => skill.includes(tech));
                }

                return false;
            }

            getPersonaDescription(personaName) {
                const persona = this.personas[personaName];
                return persona ? persona.description : '';
            }

            getPersonaName(personaName) {
                const persona = this.personas[personaName];
                return persona ? persona.name : '';
            }

            getObjectiveInEnglish(personaName, cvData) {
                const persona = this.personas[personaName];
                return persona && persona.englishObjective ? persona.englishObjective(cvData) : '';
            }

            getSummaryInEnglish(personaName, cvData) {
                const persona = this.personas[personaName];
                const anosExperiencia = this.estimateExperienceYears(cvData.experiencia);
                return persona && persona.englishSummary ? persona.englishSummary(cvData, anosExperiencia) : '';
            }
        }

        // 2. Classe Principal - Sistema Central
        class SistemaCVReWriter {
            constructor() {
                this.estado = {
                    vagaAnalisada: false,
                    cvConfigurado: false,
                    relevanciaAnalisada: false,
                    rewritingExecutado: false,
                    cvOtimizado: false,
                    personaSelecionada: null
                };

                this.dados = {
                    vaga: null,
                    cvOriginal: null,
                    analiseRelevancia: null,
                    cvReescrito: null,
                    cvOtimizado: null
                };

                this.metricas = {
                    analisesRealizadas: 0,
                    rewritesRealizados: 0,
                    keywordsAprendidas: new Set()
                };

                this.personaSystem = new PersonaSystem();
                this.carregarEstado();
            }

            analisarVaga(textoVaga) {
                this.estado.vagaAnalisada = true;
                this.dados.vaga = textoVaga;
                this.metricas.analisesRealizadas++;

                const keywords = this.extrairKeywordsAvancado(textoVaga);
                keywords.forEach(k => this.metricas.keywordsAprendidas.add(k));

                return {
                    keywords: keywords,
                    empresa: this.extrairEmpresa(textoVaga),
                    salario: this.extrairSalario(textoVaga),
                    senioridade: this.extrairSenioridade(textoVaga),
                    tipoContrato: this.extrairTipoContrato(textoVaga),
                    modeloTrabalho: this.extrairModeloTrabalho(textoVaga)
                };
            }

            configurarCV(dadosCV) {
                this.estado.cvConfigurado = true;
                this.dados.cvOriginal = dadosCV;
                return true;
            }

            analisarRelevancia() {
                if (!this.estado.vagaAnalisada || !this.estado.cvConfigurado) {
                    throw new Error('Configure a vaga e o CV primeiro');
                }

                this.estado.relevanciaAnalisada = true;
                const cvTexto = this.formatarCVParaTexto(this.dados.cvOriginal);
                const keywordsVaga = this.extrairKeywordsAvancado(this.dados.vaga);

                const score = this.calcularScoreRelevanciaAvancado(cvTexto, keywordsVaga);
                const recomendacoes = this.gerarRecomendacoesInteligentes(score, cvTexto, keywordsVaga);

                this.dados.analiseRelevancia = {
                    score: score,
                    keywordsVaga: keywordsVaga,
                    recomendacoes: recomendacoes,
                    porcentagemRelevante: Math.round(score * 100),
                    keywordsMatch: this.contarMatches(cvTexto, keywordsVaga),
                    totalKeywords: keywordsVaga.length,
                    senioridade: this.extrairSenioridade(this.dados.vaga)
                };

                return this.dados.analiseRelevancia;
            }

            executarRewriting(personaName = null, langConfig = { isEnglish: false }) {
                if (!this.estado.relevanciaAnalisada) {
                    throw new Error('Analise a relev√¢ncia primeiro');
                }

                this.estado.rewritingExecutado = true;
                this.estado.personaSelecionada = personaName || 'personalizado';
                this.metricas.rewritesRealizados++;

                let cvReescrito = { ...this.dados.cvOriginal };

                if (personaName && this.personaSystem) {
                    cvReescrito = this.personaSystem.applyPersona(
                        this.dados.cvOriginal,
                        personaName,
                        this.dados.analiseRelevancia.keywordsVaga,
                        langConfig.isEnglish
                    );
                } else {
                    if (cvReescrito.objetivo) {
                        cvReescrito.objetivo = this.ajustarObjetivoParaVaga(
                            cvReescrito.objetivo,
                            this.dados.analiseRelevancia,
                            langConfig.isEnglish
                        );
                    }

                    if (cvReescrito.habilidades) {
                        cvReescrito.habilidades = this.reordenarHabilidadesParaVaga(
                            cvReescrito.habilidades,
                            this.dados.analiseRelevancia.keywordsVaga
                        );
                    }

                    if (!cvReescrito.resumo) {
                        cvReescrito.resumo = this.criarResumoParaVaga(cvReescrito, this.dados.analiseRelevancia, langConfig.isEnglish);
                    }
                }

                this.dados.cvReescrito = cvReescrito;
                return cvReescrito;
            }

            ajustarObjetivoParaVaga(objetivoOriginal, analise, isEnglish = false) {
                if (!objetivoOriginal) return '';

                const senioridade = analise.senioridade || 'profissional';
                const area = this.extrairAreaPrincipal(analise.keywordsVaga) || 'tecnologia';

                if (isEnglish) {
                    const seniorityMap = {
                        'S√™nior': 'Senior',
                        'Senior': 'Senior',
                        'Pleno': 'Mid-level',
                        'J√∫nior': 'Junior',
                        'Junior': 'Junior',
                        'Estagi√°rio': 'Intern',
                        'Especialista': 'Specialist',
                        'Coordenador': 'Coordinator',
                        'Gerente': 'Manager'
                    };
                    const seniorityEN = seniorityMap[senioridade] || 'Professional';

                    return `${seniorityEN} specialized in ${area}. ${objetivoOriginal.replace(/^Busco\s+/i, 'Seeking ')} Focus on delivering measurable results and adding value through technical expertise.`;
                }

                const objetivoClean = objetivoOriginal.replace(/^Busco\s+/i, '');

                const formatos = [
                    `${senioridade} com expertise em ${area}. ${objetivoClean}`,
                    `${objetivoOriginal} Foco em ${area} e alinhamento estrat√©gico com os objetivos da empresa.`,
                    `Profissional de ${area} buscando ${objetivoClean.toLowerCase()}`
                ];

                return formatos[0];
            }

            reordenarHabilidadesParaVaga(habilidadesOriginal, keywordsVaga) {
                if (!habilidadesOriginal) return '';

                const habilidadesArray = habilidadesOriginal.split(/[,;\n]/).map(h => h.trim()).filter(h => h);
                const habilidadesComMatch = [];
                const outrasHabilidades = [];

                habilidadesArray.forEach(habilidade => {
                    const habLower = habilidade.toLowerCase();
                    const temMatch = keywordsVaga.some(k =>
                        habLower.includes(k.toLowerCase()) ||
                        k.toLowerCase().includes(habLower)
                    );

                    if (temMatch) {
                        habilidadesComMatch.push(habilidade);
                    } else {
                        outrasHabilidades.push(habilidade);
                    }
                });

                return [...habilidadesComMatch, ...outrasHabilidades].join(', ');
            }

            criarResumoParaVaga(cvDados, analise, isEnglish = false) {
                const anosExperiencia = this.extrairAnosExperiencia(cvDados.experiencia || '');
                const senioridade = analise.senioridade || 'Pleno';
                const area = this.extrairAreaPrincipal(analise.keywordsVaga) || 'tecnologia';

                if (isEnglish) {
                    const seniorityMap = {
                        'S√™nior': 'Senior',
                        'Senior': 'Senior',
                        'Pleno': 'Mid-level',
                        'J√∫nior': 'Junior',
                        'Junior': 'Junior'
                    };
                    const seniorityEN = seniorityMap[senioridade] || 'Professional';

                    return `${seniorityEN} ${area} developer with ${anosExperiencia} of experience. Focused on delivering measurable results and adding value through technical expertise.`;
                }

                return `${senioridade} de ${area} com ${anosExperiencia} de experi√™ncia. Foco em entregar resultados mensur√°veis e agregar valor atrav√©s de expertise t√©cnica.`;
            }

            otimizarCV() {
                if (!this.estado.rewritingExecutado) {
                    throw new Error('Execute o rewriting primeiro');
                }

                this.estado.cvOtimizado = true;
                const cvOtimizado = this.otimizarParaATS(this.dados.cvReescrito);
                this.dados.cvOtimizado = cvOtimizado;
                return cvOtimizado;
            }

            extrairKeywordsAvancado(texto) {
                const keywords = new Set();
                const textoLower = texto.toLowerCase();

                const listaKeywords = [
                    'javascript', 'typescript', 'react', 'angular', 'vue', 'node.js', 'nodejs',
                    'python', 'django', 'flask', 'java', 'spring', 'c#', '.net', 'php', 'laravel',
                    'aws', 'azure', 'gcp', 'docker', 'kubernetes', 'terraform', 'ansible',
                    'git', 'github', 'gitlab', 'bitbucket', 'jenkins', 'ci/cd',
                    'sql', 'mysql', 'postgresql', 'mongodb', 'redis', 'elasticsearch',
                    'react native', 'flutter', 'swift', 'kotlin', 'android', 'ios',
                    'figma', 'ui/ux', 'design system', 'prototyping',
                    'scrum', 'agile', 'kanban', 'devops', 'lean', 'waterfall',
                    'rest api', 'graphql', 'soap', 'microservices', 'monolith',
                    'tdd', 'bdd', 'testes automatizados', 'jest', 'cypress', 'selenium',
                    'lideran√ßa t√©cnica', 'mentoria', 'code review', 'pair programming',
                    'arquitetura de software', 'design patterns', 'clean code',
                    'performance optimization', 'scalability', 'security',
                    'machine learning', 'ia', 'data science', 'big data',
                    'clt', 'pj', 'mei', 'cooperado', 'vr', 'va', 'vt', 'plr',
                    'gympass', 'unimed', 'amil', 'bradesco', 'sulamerica',
                    'home office', 'presencial', 'h√≠brido', 'remoto',
                    'j√∫nior', 'pleno', 's√™nior', 'especialista', 'coordenador',
                    'fintech', 'healthtech', 'edtech', 'proptech', 'retail',
                    'e-commerce', 'marketplace', 'saas', 'paas', 'iaas'
                ];

                listaKeywords.forEach(keyword => {
                    if (textoLower.includes(keyword.toLowerCase())) {
                        keywords.add(keyword);
                    }
                });

                const palavrasCompostas = [
                    'full stack', 'back end', 'front end', 'mobile developer',
                    'data engineer', 'data analyst', 'product owner', 'scrum master',
                    'cloud computing', 'web development', 'software engineer'
                ];

                palavrasCompostas.forEach(composta => {
                    if (textoLower.includes(composta.toLowerCase())) {
                        keywords.add(composta);
                    }
                });

                return Array.from(keywords);
            }

            extrairEmpresa(texto) {
                const padroes = [
                    /(?:empresa|company|contratante)[:\s]+([^\n]+)/i,
                    /na\s+([^\n\s,]{3,})\s+(?:estamos|procuramos|buscamos)/i,
                    /^(?:[A-Z][a-z]+\s+)+(?:LTDA|SA|ME|EIRELI)/im
                ];

                for (let padrao of padroes) {
                    const match = texto.match(padrao);
                    if (match && match[1]) {
                        return match[1].trim();
                    }
                }
                return 'Empresa n√£o identificada';
            }

            extrairSalario(texto) {
                const padroes = [
                    /R\$\s*([\d\.,]+)(?:\s*[-a]\s*R\$\s*([\d\.,]+))?/i,
                    /sal√°rio[:\s]+([^\n]+)/i,
                    /remunera√ß√£o[:\s]+([^\n]+)/i,
                    /([\d\.,]+\s*[-a]\s*[\d\.,]+)\s*(?:mil|k|reais)/i
                ];

                for (let padrao of padroes) {
                    const match = texto.match(padrao);
                    if (match) {
                        if (match[2]) {
                            return `R$ ${match[1]} - R$ ${match[2]}`;
                        }
                        return `R$ ${match[1]}`;
                    }
                }
                return 'A combinar';
            }

            extrairSenioridade(texto) {
                const textoLower = texto.toLowerCase();
                if (textoLower.includes('s√™nior') || textoLower.includes('senior') || textoLower.includes('sr.')) return 'S√™nior';
                if (textoLower.includes('pleno') || textoLower.includes('mid-level')) return 'Pleno';
                if (textoLower.includes('j√∫nior') || textoLower.includes('junior') || textoLower.includes('jr.')) return 'J√∫nior';
                if (textoLower.includes('estagi√°rio') || textoLower.includes('estagiario') || textoLower.includes('trainee')) return 'Estagi√°rio';
                if (textoLower.includes('especialista') || textoLower.includes('expert')) return 'Especialista';
                if (textoLower.includes('coordenador') || textoLower.includes('coordinator')) return 'Coordenador';
                if (textoLower.includes('gerente') || textoLower.includes('manager')) return 'Gerente';
                return 'N√£o especificada';
            }

            extrairTipoContrato(texto) {
                const textoLower = texto.toLowerCase();
                if (textoLower.includes('clt')) return 'CLT';
                if (textoLower.includes('pj')) return 'PJ';
                if (textoLower.includes('cooperado')) return 'Cooperado';
                if (textoLower.includes('mei')) return 'MEI';
                return 'N√£o especificado';
            }

            extrairModeloTrabalho(texto) {
                const textoLower = texto.toLowerCase();
                if (textoLower.includes('home office') || textoLower.includes('remoto') || textoLower.includes('remote')) return 'Remoto';
                if (textoLower.includes('h√≠brido') || textoLower.includes('hibrido') || textoLower.includes('hybrid')) return 'H√≠brido';
                if (textoLower.includes('presencial') || textoLower.includes('on-site')) return 'Presencial';
                return 'N√£o especificado';
            }

            formatarCVParaTexto(cvDados) {
                return Object.values(cvDados).filter(v => v).join('\n');
            }

            calcularScoreRelevanciaAvancado(cvTexto, keywordsVaga) {
                if (!keywordsVaga.length) return 0.3;

                const cvLower = cvTexto.toLowerCase();
                let matches = 0;
                let pesoTotal = 0;

                keywordsVaga.forEach(keyword => {
                    const keywordLower = keyword.toLowerCase();
                    let peso = 1;

                    if (this.isKeywordTecnica(keywordLower)) peso = 1.5;
                    if (this.isKeywordSenioridade(keywordLower)) peso = 1.2;

                    if (cvLower.includes(keywordLower)) {
                        matches += peso;
                    }
                    pesoTotal += peso;
                });

                const densidade = this.calcularDensidadeKeywords(cvTexto, keywordsVaga);
                const bonusDensidade = Math.min(0.2, densidade * 0.1);

                const scoreBase = matches / pesoTotal;
                const scoreFinal = Math.min(1, scoreBase + bonusDensidade);

                return scoreFinal;
            }

            isKeywordTecnica(keyword) {
                const tecnicas = ['javascript', 'react', 'node', 'python', 'aws', 'docker', 'sql', 'api'];
                return tecnicas.some(tec => keyword.includes(tec));
            }

            isKeywordSenioridade(keyword) {
                const senioridades = ['s√™nior', 'senior', 'pleno', 'j√∫nior', 'junior', 'coordenador', 'gerente'];
                return senioridades.some(sen => keyword.includes(sen));
            }

            calcularDensidadeKeywords(texto, keywords) {
                const palavras = texto.toLowerCase().split(/\s+/).length;
                const matches = this.contarMatches(texto, keywords);
                return matches / Math.max(palavras, 1);
            }

            contarMatches(texto, keywords) {
                const textoLower = texto.toLowerCase();
                return keywords.filter(k => textoLower.includes(k.toLowerCase())).length;
            }

            gerarRecomendacoesInteligentes(score, cvTexto, keywordsVaga) {
                const recomendacoes = [];
                const matches = this.contarMatches(cvTexto, keywordsVaga);
                const percentMatch = (matches / keywordsVaga.length) * 100;

                if (score < 0.4) {
                    recomendacoes.push(`Apenas ${Math.round(percentMatch)}% das keywords da vaga est√£o no seu CV`);
                    recomendacoes.push('Reestruture completamente a se√ß√£o de habilidades');
                    recomendacoes.push('Adicione projetos espec√≠ficos relacionados √†s tecnologias da vaga');
                } else if (score < 0.6) {
                    recomendacoes.push(`${Math.round(percentMatch)}% de match - pode melhorar`);
                    recomendacoes.push('Reforce as experi√™ncias mais relevantes no in√≠cio do CV');
                    recomendacoes.push('Use mais termos espec√≠ficos da descri√ß√£o da vaga');
                } else if (score < 0.8) {
                    recomendacoes.push(`Bom match (${Math.round(percentMatch)}%) - ajustes focados`);
                    recomendacoes.push('Otimize a ordem das informa√ß√µes para destacar o que √© mais relevante');
                    recomendacoes.push('Adicione m√©tricas e resultados quantific√°veis');
                } else {
                    recomendacoes.push(`Excelente match (${Math.round(percentMatch)}%)`);
                    recomendacoes.push('Apenas ajuste a formata√ß√£o para melhor leitura do ATS');
                    recomendacoes.push('Destaque suas conquistas mais impressionantes');
                }

                const cvLower = cvTexto.toLowerCase();
                const keywordsFaltantes = keywordsVaga.filter(k => !cvLower.includes(k.toLowerCase()));

                if (keywordsFaltantes.length > 0 && keywordsFaltantes.length <= 5) {
                    recomendacoes.push(`Considere adicionar: ${keywordsFaltantes.slice(0, 3).join(', ')}`);
                }

                return recomendacoes;
            }

            extrairAreaPrincipal(keywords) {
                const areas = {
                    'front end': ['react', 'angular', 'vue', 'javascript', 'typescript', 'css'],
                    'back end': ['node.js', 'python', 'java', 'c#', 'php', 'api'],
                    'full stack': ['full stack', 'javascript', 'node.js', 'react', 'python'],
                    'devops': ['aws', 'docker', 'kubernetes', 'ci/cd', 'terraform'],
                    'mobile': ['react native', 'flutter', 'android', 'ios', 'mobile'],
                    'data': ['python', 'machine learning', 'data science', 'sql', 'big data']
                };

                for (const [area, palavras] of Object.entries(areas)) {
                    if (palavras.some(palavra => keywords.some(k => k.toLowerCase().includes(palavra)))) {
                        return area;
                    }
                }

                return 'tecnologia';
            }

            extrairAnosExperiencia(experiencia) {
                const anos = experiencia.match(/(\d+)\s*(?:anos|anoss|years)/i);
                return anos ? anos[1] + ' anos' : 'mais de 3 anos';
            }

            otimizarParaATS(cvDados) {
                const linhas = [];

                linhas.push('CV OTIMIZADO PARA ATS - GERADO POR CV REWRITER PRO ULTIMATE');
                linhas.push('='.repeat(60));
                linhas.push('');

                if (cvDados.nome) linhas.push(cvDados.nome.toUpperCase());
                if (cvDados.cargo) linhas.push(cvDados.cargo);
                if (cvDados.localizacao) linhas.push(`Localiza√ß√£o: ${cvDados.localizacao}`);
                if (cvDados.salario) linhas.push(`Pretens√£o Salarial: ${cvDados.salario}`);
                linhas.push('');

                if (cvDados.resumo) {
                    linhas.push('RESUMO EXECUTIVO');
                    linhas.push(cvDados.resumo);
                    linhas.push('');
                }

                if (cvDados.objetivo) {
                    linhas.push('OBJETIVO PROFISSIONAL');
                    linhas.push(cvDados.objetivo);
                    linhas.push('');
                }

                if (cvDados.experiencia) {
                    linhas.push('EXPERI√äNCIA PROFISSIONAL');
                    cvDados.experiencia.split('\n').forEach(linha => {
                        if (linha.trim()) linhas.push(linha.trim());
                    });
                    linhas.push('');
                }

                if (cvDados.habilidades) {
                    linhas.push('HABILIDADES T√âCNICAS');
                    const habilidadesArray = cvDados.habilidades.split(',').map(h => h.trim());
                    habilidadesArray.forEach((habilidade, i) => {
                        if (i % 3 === 0 && i > 0) linhas.push('');
                        linhas.push(`‚Ä¢ ${habilidade}`);
                    });
                    linhas.push('');
                }

                linhas.push('INFORMA√á√ïES ADICIONAIS');
                linhas.push('CV otimizado com IA para m√°xima compatibilidade com sistemas ATS');
                linhas.push(`Data de otimiza√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`);
                linhas.push('Ferramenta: CV ReWriter Pro Ultimate');

                return linhas.join('\n');
            }

            getStatus() {
                return this.estado;
            }

            getMetricas() {
                return {
                    analisesRealizadas: this.metricas.analisesRealizadas,
                    rewritesRealizados: this.metricas.rewritesRealizados,
                    keywordsCount: this.metricas.keywordsAprendidas.size
                };
            }

            salvarEstado() {
                try {
                    localStorage.setItem('cvrewriter_estado', JSON.stringify(this.estado));
                    localStorage.setItem('cvrewriter_metricas', JSON.stringify({
                        analisesRealizadas: this.metricas.analisesRealizadas,
                        rewritesRealizados: this.metricas.rewritesRealizados,
                        keywordsCount: this.metricas.keywordsAprendidas.size
                    }));
                    localStorage.setItem('cvrewriter_dados', JSON.stringify(this.dados));
                } catch (e) {
                    console.warn('Erro ao salvar estado:', e);
                }
            }

            carregarEstado() {
                try {
                    const estado = JSON.parse(localStorage.getItem('cvrewriter_estado'));
                    const metricas = JSON.parse(localStorage.getItem('cvrewriter_metricas'));
                    const dados = JSON.parse(localStorage.getItem('cvrewriter_dados'));

                    if (estado) this.estado = estado;
                    if (metricas) {
                        this.metricas.analisesRealizadas = metricas.analisesRealizadas || 0;
                        this.metricas.rewritesRealizados = metricas.rewritesRealizados || 0;
                        this.metricas.keywordsAprendidas = new Set();
                    }
                    if (dados) this.dados = dados;
                } catch (e) {
                    console.warn('Erro ao carregar estado:', e);
                }
            }

            resetarSistema() {
                this.estado = {
                    vagaAnalisada: false,
                    cvConfigurado: false,
                    relevanciaAnalisada: false,
                    rewritingExecutado: false,
                    cvOtimizado: false,
                    personaSelecionada: null
                };

                this.dados = {
                    vaga: null,
                    cvOriginal: null,
                    analiseRelevancia: null,
                    cvReescrito: null,
                    cvOtimizado: null
                };

                localStorage.removeItem('cvrewriter_estado');
                localStorage.removeItem('cvrewriter_metricas');
                localStorage.removeItem('cvrewriter_dados');

                return true;
            }

            getPersonaSystem() {
                return this.personaSystem;
            }
        }

        // 3. Classe de Interface - Gerencia toda a UI
        class InterfaceCVReWriter {
            constructor() {
                this.sistema = new SistemaCVReWriter();
                this.sistemaLocal = window.sistemaLocal || null;
                this.autoSaveTimeout = null;
                this.autoDetectTimeout = null;
                this.selectedPersona = null;
                this.intelligenceHub = {
                    keywords: [],
                    requirements: "",
                    culturalTone: "profissional",
                    matchScore: 0,
                    analyzed: false,
                    personaRecommendation: null,
                    redFlags: [],
                    greenFlags: [],
                    priorityKeywords: []
                };
                this.init();
            }

            showLoading(message = 'Processando...', submessage = '') {
                const overlay = document.getElementById('loading-overlay');
                const text = document.getElementById('loading-text');
                const subtext = document.getElementById('loading-subtext');

                if (overlay && text) {
                    text.textContent = message;
                    if (subtext && submessage) {
                        subtext.textContent = submessage;
                    }
                    overlay.style.display = 'flex';
                }
            }

            hideLoading() {
                const overlay = document.getElementById('loading-overlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
            }

            showNotification(message, type = 'info') {
                const notificationSystem = document.getElementById('notification-system');
                if (!notificationSystem) return;

                const notification = document.createElement('div');
                notification.className = 'notification';

                const colors = {
                    success: '#00b894',
                    error: '#ff6b6b',
                    warning: '#fdcb6e',
                    info: '#0984e3'
                };

                notification.style.borderLeftColor = colors[type] || colors.info;

                const icon = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                }[type] || 'fa-info-circle';

                notification.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                `;

                notificationSystem.appendChild(notification);

                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.parentNode.removeChild(notification);
                            }
                        }, 300);
                    }
                }, 5000);
            }

            switchTab(tabName) {
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });

                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                const tabContent = document.getElementById(tabName);
                const tabButton = document.querySelector(`[data-tab="${tabName}"]`);

                if (tabContent) tabContent.classList.add('active');
                if (tabButton) tabButton.classList.add('active');

                this.currentTab = tabName;
            }

            async init() {
                this.currentTab = 'analysis';

                this.showLoading('Inicializando sistema...');

                try {
                    this.setupEventListeners();
                    this.setupPersonaEvents();
                    this.carregarCVFusao();
                    this.carregarCVDoLocalStorage();
                    this.atualizarStats();
                    this.loadInitialExample();

                    setTimeout(() => {
                        this.hideLoading();
                        this.showNotification('Sistema pronto! üöÄ', 'success');
                    }, 800);

                } catch (error) {
                    console.error('Erro na inicializa√ß√£o:', error);
                    this.showNotification('Erro na inicializa√ß√£o', 'error');
                    this.hideLoading();
                }
            }

            async carregarCVFusao() {
                try {
                    const cvFusao = {
                        nome: "M√°rcio Gemelli (CV Fus√£o Completo)",
                        cargo: "Desenvolvedor Full Stack & Tech Lead",
                        localizacao: "S√£o Paulo, SP",
                        salario: "R$ 12.000 - R$ 18.000",
                        objetivo: "Profissional especializado em desenvolvimento full stack com foco em criar solu√ß√µes escal√°veis e de alta performance. Busco oportunidades para aplicar minha expertise em JavaScript, React e Node.js em projetos desafiadores.",
                        habilidades: "JavaScript, TypeScript, React, Node.js, Python, AWS, Docker, PostgreSQL, MongoDB, GraphQL, CI/CD, Scrum, Agile",
                        experiencia: `Tech Lead - Tech Solutions SA (2021 - Atual)
‚Ä¢ Lideran√ßa de equipe de desenvolvedores em metodologia √°gil
‚Ä¢ Arquitetura de sistemas escal√°veis com microservi√ßos
‚Ä¢ Redu√ß√£o de custos em infraestrutura cloud

Desenvolvedor Full Stack - Startup XYZ (2019 - 2021)
‚Ä¢ Desenvolvimento de aplica√ß√µes web modernas
‚Ä¢ Integra√ß√£o com APIs REST e GraphQL
‚Ä¢ Otimiza√ß√£o de performance e experi√™ncia do usu√°rio

Analista de Sistemas - Empresa ABC (2017 - 2019)
‚Ä¢ Manuten√ß√£o e evolu√ß√£o de sistemas
‚Ä¢ Migra√ß√£o e otimiza√ß√£o de bancos de dados
‚Ä¢ Automa√ß√£o de processos internos`
                    };

                    document.getElementById('cv-name').value = cvFusao.nome;
                    document.getElementById('cv-title').value = cvFusao.cargo;
                    document.getElementById('cv-location').value = cvFusao.localizacao;
                    document.getElementById('cv-salary').value = cvFusao.salario;
                    document.getElementById('cv-objective').value = cvFusao.objetivo;
                    document.getElementById('cv-skills').value = cvFusao.habilidades;
                    document.getElementById('cv-experience').value = cvFusao.experiencia;

                    this.updateCVPreview();

                    console.log('‚úÖ CV Fus√£o carregado com sucesso');

                } catch (error) {
                    console.warn('‚ö†Ô∏è N√£o foi poss√≠vel carregar CV Fus√£o:', error);
                }
            }

            setupEventListeners() {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.currentTarget.dataset.tab);
                    });
                });

                document.getElementById('analyze-btn').addEventListener('click', () => this.analisarVagaHibrida());
                document.getElementById('quick-analyze').addEventListener('click', () => {
                    if (this.sistemaLocal && this.sistemaLocal.ia) {
                        const jobText = document.getElementById('job-text').value.trim();
                        if (jobText) {
                            this.showLoading('Detectando keywords...');
                            setTimeout(() => {
                                try {
                                    const keywords = this.sistemaLocal.ia.extrairKeywords(jobText).slice(0, 10);
                                    const detectionDiv = document.getElementById('auto-detection');

                                    if (keywords.length > 0) {
                                        detectionDiv.innerHTML = keywords.map(k =>
                                            `<span class="tag tag-primary">${k}</span>`
                                        ).join('');
                                        this.showNotification(`${keywords.length} keywords detectadas!`, 'info');
                                    }
                                } catch (error) {
                                    this.showNotification('Erro na detec√ß√£o', 'error');
                                } finally {
                                    this.hideLoading();
                                }
                            }, 600);
                        } else {
                            this.showNotification('Cole uma vaga primeiro!', 'warning');
                        }
                    } else {
                        this.quickAnalyze();
                    }
                });

                document.getElementById('clear-job').addEventListener('click', () => this.clearJobText());
                document.getElementById('load-example').addEventListener('click', () => this.loadExampleJobHibrida());
                document.getElementById('paste-clipboard').addEventListener('click', () => this.pasteFromClipboard());
                document.getElementById('goto-profile').addEventListener('click', () => this.switchTab('profile'));

                document.getElementById('save-profile').addEventListener('click', () => this.salvarCVHibrido());
                document.getElementById('load-marcio').addEventListener('click', () => this.carregarCVMaker());
                document.getElementById('load-complete-cv').addEventListener('click', () => this.carregarCVFusao());
                document.getElementById('enhance-cv').addEventListener('click', () => this.enhanceCV());
                document.getElementById('reset-cv').addEventListener('click', () => this.resetCV());
                document.getElementById('add-experience-btn').addEventListener('click', () => this.addExperienceEntry());
                document.getElementById('goto-relevance').addEventListener('click', () => {
                    this.switchTab('relevance');
                    setTimeout(() => this.analisarRelevanciaHibrida(), 300);
                });

                document.getElementById('start-relevance').addEventListener('click', () => this.analisarRelevanciaHibrida());
                document.getElementById('run-relevance').addEventListener('click', () => this.analisarRelevanciaHibrida());

                document.getElementById('start-rewriting').addEventListener('click', () => this.executarRewritingHibrido());
                document.getElementById('run-rewriting').addEventListener('click', () => this.executarRewritingHibrido());

                document.getElementById('refresh-cv').addEventListener('click', () => this.atualizarCVOtimizado());

                document.getElementById('system-info').addEventListener('click', () => this.showSystemInfoHibrido());
                document.getElementById('reset-system').addEventListener('click', () => this.resetSystemHibrido());

                document.getElementById('job-text').addEventListener('input', (e) => {
                    this.autoDetectChangesHibrida(e.target.value);
                });

                const cvFields = ['cv-name', 'cv-title', 'cv-location', 'cv-salary',
                    'cv-objective', 'cv-skills', 'cv-experience'];

                cvFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', () => {
                            this.updateCVPreview();
                            clearTimeout(this.autoSaveTimeout);
                            this.autoSaveTimeout = setTimeout(() => {
                                this.salvarCVHibrido(true);
                            }, 2000);
                        });
                    }
                });

                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        if (document.getElementById('analysis').classList.contains('active')) {
                            this.analisarVagaHibrida();
                        }
                    }
                });

                document.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.getElementById('keywords-modal').classList.remove('active');
                    });
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.getElementById('keywords-modal').classList.remove('active');
                    }
                });
            }

            analisarVagaHibrida() {
                const jobText = document.getElementById('job-text').value.trim();
                const langConfig = this.getFlowLanguageConfig(jobText);

                if (!jobText || jobText.length < 20) {
                    this.showNotification('Cole uma descri√ß√£o de vaga mais completa.', 'warning');
                    return;
                }

                this.showLoading(`Analisando vaga em ${langConfig.label}...`);

                try {
                    let analise;
                    if (this.sistemaLocal && this.sistemaLocal.analisarVaga) {
                        const resultado = this.sistemaLocal.analisarVaga(jobText);
                        if (resultado.success) {
                            analise = resultado.data;
                            const stats = this.sistemaLocal.getEstatisticas();
                            document.getElementById('total-analises').textContent = stats.historico;
                        } else {
                            throw new Error(resultado.message);
                        }
                    } else {
                        analise = this.sistema.analisarVaga(jobText);
                    }

                    analise.langConfig = langConfig;
                    
                    this.updateIntelligenceFromVaga(analise, jobText);
                    
                    this.displayAnalysisResults(analise);
                    this.atualizarStats();

                    this.showNotification(`Vaga analisada (${langConfig.label})! ${analise.keywords.length} keywords detectadas.`, 'success');

                } catch (error) {
                    console.error('Erro na an√°lise:', error);
                    this.showNotification('Erro na an√°lise da vaga', 'error');
                } finally {
                    this.hideLoading();
                }
            }

            updateIntelligenceFromVaga(analise, jobText) {
                this.intelligenceHub = {
                    keywords: analise.keywords || [],
                    requirements: this.extractKeyRequirements(jobText),
                    culturalTone: this.detectCulturalTone(jobText),
                    matchScore: analise.score || 0,
                    analyzed: true,
                    personaRecommendation: this.recommendPersona(analise.keywords),
                    redFlags: this.detectRedFlags(jobText),
                    greenFlags: this.detectGreenFlags(jobText),
                    priorityKeywords: this.extractPriorityKeywords(analise.keywords)
                };
                
                console.log('üìä Intelig√™ncia ATS atualizada:', this.intelligenceHub);
            }

            extractKeyRequirements(jobText) {
                const lines = jobText.split('\n');
                const requirements = lines.filter(line =>
                    line.toLowerCase().includes('requisito') ||
                    line.toLowerCase().includes('obrigat√≥rio') ||
                    line.toLowerCase().includes('necess√°rio')
                );
                return requirements.slice(0, 3).join(' | ');
            }

            detectCulturalTone(jobText) {
                const text = jobText.toLowerCase();
                if (text.includes('startup') || text.includes('din√¢mico') || text.includes('√°gil')) return 'inovador';
                if (text.includes('corpora√ß√£o') || text.includes('multinacional') || text.includes('tradicional')) return 'corporativo';
                if (text.includes('consultoria') || text.includes('cliente') || text.includes('projeto')) return 'consultivo';
                return 'profissional';
            }

            detectRedFlags(jobText) {
                const redFlags = [];
                const text = jobText.toLowerCase();
                const flags = ['24/7', 'plant√£o', 'multitarefa', 'sal√°rio a combinar', 'sobreaviso'];

                flags.forEach(flag => {
                    if (text.includes(flag)) redFlags.push(flag);
                });
                return redFlags;
            }

            detectGreenFlags(jobText) {
                const greenFlags = [];
                const text = jobText.toLowerCase();
                const flags = ['remoto total', 'home office', 'flexibilidade', 'plano de carreira', 'treinamento'];

                flags.forEach(flag => {
                    if (text.includes(flag)) greenFlags.push(flag);
                });
                return greenFlags;
            }

            extractPriorityKeywords(keywords) {
                if (!keywords) return [];
                const priorityTerms = ['obrigat√≥rio', 'requisito', 'essencial', 'imprescind√≠vel', 'necess√°rio'];
                return keywords.filter(kw =>
                    priorityTerms.some(term => kw.toLowerCase().includes(term.toLowerCase()))
                );
            }

            recommendPersona(keywords) {
                if (!keywords || !keywords.length) return null;

                const kwLower = keywords.map(k => k.toLowerCase());

                if (kwLower.some(k => ['frontend', 'react', 'vue', 'angular', 'css', 'ui', 'ux', 'javascript'].includes(k))) {
                    return 'frontend';
                } else if (kwLower.some(k => ['backend', 'node', 'python', 'java', 'api', 'database', 'server', 'sql'].includes(k))) {
                    return 'backend';
                } else if (kwLower.some(k => ['fullstack', 'full stack', 'full-stack'].includes(k))) {
                    return 'fullstack';
                } else if (kwLower.some(k => ['ux', 'ui', 'design', 'figma', 'prototype', 'usabilidade'].includes(k))) {
                    return 'uxdev';
                } else if (kwLower.some(k => ['product', 'produto', 'business', 'neg√≥cio', 'metrics', 'agile', 'scrum'].includes(k))) {
                    return 'produto';
                }
                return null;
            }

            loadExampleJobHibrida() {
                const exampleJob = `Analista de Dados S√™nior
Empresa: DataCorp Analytics
Sal√°rio: R$ 15.000 - R$ 22.000 PJ
Requisitos: Python, SQL, Power BI, Machine Learning, AWS
Benef√≠cios: Remoto total, b√¥nus por performance, VR/VA`;

                const jobTextElement = document.getElementById('job-text');
                if (jobTextElement) {
                    jobTextElement.value = exampleJob;

                    const inputEvent = new Event('input', { bubbles: true });
                    jobTextElement.dispatchEvent(inputEvent);

                    this.showNotification('Exemplo carregado!', 'info');
                    return true;
                }
                return false;
            }

            salvarCVHibrido(silent = false) {
                const cvData = {
                    nome: document.getElementById('cv-name').value.trim(),
                    cargo: document.getElementById('cv-title').value.trim(),
                    localizacao: document.getElementById('cv-location').value.trim(),
                    salario: document.getElementById('cv-salary').value.trim(),
                    objetivo: document.getElementById('cv-objective').value.trim(),
                    habilidades: document.getElementById('cv-skills').value.trim(),
                    experiencia: document.getElementById('cv-experience').value.trim()
                };

                if (!cvData.nome || !cvData.habilidades) {
                    if (!silent) this.showNotification('Nome e habilidades s√£o obrigat√≥rios!', 'warning');
                    return false;
                }

                let sucessoLocal = true;
                let sucessoOriginal = true;

                if (this.sistemaLocal && this.sistemaLocal.salvarPerfilCV) {
                    const resultado = this.sistemaLocal.salvarPerfilCV(cvData);
                    sucessoLocal = resultado.success;
                }

                sucessoOriginal = this.sistema.configurarCV(cvData);

                try {
                    localStorage.setItem('cv_data', JSON.stringify(cvData));
                } catch (error) {
                    console.warn('Erro ao salvar no localStorage:', error);
                }

                if (sucessoLocal && sucessoOriginal) {
                    if (!silent) this.showNotification('CV salvo em ambos sistemas!', 'success');
                    this.updateCVPreview();
                    document.querySelector('[data-tab="profile"]').classList.add('completed');
                    return true;
                } else {
                    if (!silent) this.showNotification('CV salvo parcialmente', 'warning');
                    return false;
                }
            }

            analisarRelevanciaHibrida() {
                const status = this.sistema.getStatus();

                if (!status.vagaAnalisada) {
                    this.showNotification('Analise uma vaga primeiro!', 'warning');
                    this.switchTab('analysis');
                    return;
                }

                if (!status.cvConfigurado) {
                    this.showNotification('Configure seu CV primeiro!', 'warning');
                    this.switchTab('profile');
                    return;
                }

                this.showLoading('Analisando relev√¢ncia com IA...');

                try {
                    const analise = this.sistema.analisarRelevancia();

                    if (this.sistemaLocal) {
                        this.sistemaLocal.bd.registrarHistorico('analise_relevancia', {
                            score: analise.porcentagemRelevante,
                            keywords: analise.keywordsVaga.length
                        });
                    }

                    this.displayRelevanceResults(analise);
                    this.atualizarStats();

                    this.showNotification('An√°lise de relev√¢ncia conclu√≠da!', 'success');

                } catch (error) {
                    console.error('Erro na an√°lise:', error);
                    this.showNotification('Erro na an√°lise de relev√¢ncia', 'error');
                } finally {
                    this.hideLoading();
                }
            }

            executarRewritingHibrido() {
                const status = this.sistema.getStatus();
                const jobText = document.getElementById('job-text').value;
                const langConfig = this.getFlowLanguageConfig(jobText);

                if (!status.relevanciaAnalisada) {
                    this.showNotification('Analise a relev√¢ncia primeiro!', 'warning');
                    this.switchTab('relevance');
                    return;
                }

                if (!this.selectedPersona) {
                    if (this.intelligenceHub.personaRecommendation) {
                        this.selectedPersona = this.intelligenceHub.personaRecommendation;
                        this.selectPersona(this.selectedPersona);
                        this.showNotification(`Usando persona recomendada: ${this.selectedPersona}`, 'info');
                    } else {
                        this.showNotification('Selecione uma persona primeiro!', 'warning');
                        return;
                    }
                }

                const msgLoading = langConfig.isEnglish ?
                    `Executing rewriting with "${this.selectedPersona}" persona (English Mode)...` :
                    `Executando rewriting com persona "${this.selectedPersona}"...`;

                this.showLoading(msgLoading);

                try {
                    let cvReescrito;
                    if (this.sistemaLocal && this.sistemaLocal.executarRewriting) {
                        const resultado = this.sistemaLocal.executarRewriting(this.selectedPersona, langConfig.isEnglish);
                        if (resultado.success) {
                            cvReescrito = resultado.data.reescrito;
                            document.getElementById('total-rewrites').textContent =
                                parseInt(document.getElementById('total-rewrites').textContent) + 1;
                        }
                    }

                    if (!cvReescrito) {
                        cvReescrito = this.sistema.executarRewriting(this.selectedPersona, langConfig);
                    }

                    this.sistema.dados.cvReescrito = cvReescrito;

                    this.displayRewritingResults(cvReescrito, langConfig);
                    this.atualizarStats();

                    const msgSuccess = langConfig.isEnglish ?
                        `‚úÖ Rewriting completed in English using "${this.selectedPersona}"!` :
                        `‚úÖ Rewriting conclu√≠do com persona "${this.selectedPersona}"!`;

                    this.showNotification(msgSuccess, 'success');

                } catch (error) {
                    console.error('Erro no rewriting:', error);
                    this.showNotification('Erro no rewriting do CV', 'error');
                } finally {
                    this.hideLoading();
                }
            }

            atualizarCVOtimizado() {
                const status = this.sistema.getStatus();

                if (!status.rewritingExecutado) {
                    this.showNotification('Execute o rewriting primeiro!', 'warning');
                    this.switchTab('rewriting');
                    return;
                }

                this.showLoading('Otimizando CV para ATS...');

                setTimeout(() => {
                    try {
                        // Gerar CV otimizado
                        const cvOtimizado = this.sistema.otimizarCV();
                        
                        // IMPORTANTE: Salvar no sistema
                        this.sistema.dados.cvOtimizado = cvOtimizado;
                        
                        // Chamar o m√©todo de display com o CV otimizado
                        this.displayOptimizationResults(cvOtimizado);
                        
                        // Atualizar m√©tricas
                        this.atualizarMetricasOtimizacao();

                        this.showNotification('CV otimizado com sucesso!', 'success');

                    } catch (error) {
                        console.error('Erro na otimiza√ß√£o:', error);
                        this.showNotification('Erro ao otimizar CV', 'error');
                    } finally {
                        this.hideLoading();
                    }
                }, 800);
            }

            displayOptimizationResults(cvOtimizado) {
                document.getElementById('optimization-placeholder').classList.add('hidden');
                document.getElementById('optimization-results').classList.remove('hidden');

                const personaSystem = this.sistema.getPersonaSystem();
                const personaName = personaSystem ? personaSystem.getPersonaName(this.selectedPersona) : 'Personalizado';
                
                const jobText = document.getElementById('job-text').value;
                const langConfig = this.getFlowLanguageConfig(jobText);
                const isEn = langConfig.isEnglish;

                document.getElementById('optimization-results').innerHTML = `
                    <div class="space-y-4">
                        <div class="p-3 bg-purple-50 rounded-lg">
                            <h4 class="font-bold text-purple-800 mb-1">
                                <i class="fas fa-file-contract"></i> ${isEn ? 'CV Optimized for Brazilian ATS' : 'CV Otimizado para ATS Brasileiro'}
                            </h4>
                            <p class="text-sm text-purple-700">
                                ${isEn ? 'Persona' : 'Persona'}: <strong>${personaName}</strong> ‚Ä¢ 
                                ${isEn ? 'Formatted for Gupy, Vagas.com, LinkedIn and InfoJobs' : 'Formatado para Gupy, Vagas.com, LinkedIn e InfoJobs'}
                            </p>
                        </div>
                        
                        <!-- VISUALIZADOR DO CV -->
                        <div class="p-3 bg-white rounded-lg border-2 border-green-500">
                            <div class="flex justify-between items-center mb-3 pb-2 border-b border-gray-200">
                                <h5 class="font-bold text-gray-700">
                                    <i class="fas fa-file-alt text-green-600 mr-2"></i>
                                    ${isEn ? 'Optimized CV Content' : 'Conte√∫do do CV Otimizado'}
                                </h5>
                                <div class="flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary" id="view-txt-btn" title="${isEn ? 'View as TXT' : 'Ver como TXT'}">
                                        <i class="fas fa-file-code"></i> TXT
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" id="copy-cv-btn" title="${isEn ? 'Copy to clipboard' : 'Copiar para √°rea de transfer√™ncia'}">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="max-h-[400px] overflow-y-auto whitespace-pre-line p-3 text-sm font-mono bg-gray-50 rounded border" id="cv-content-display">
                                ${cvOtimizado}
                            </div>
                        </div>
                        
                        <!-- M√âTRICAS DE OTIMIZA√á√ÉO -->
                        <div class="grid grid-cols-3 gap-3">
                            <div class="p-3 bg-blue-50 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-700" id="keyword-density">0%</div>
                                <div class="text-xs text-blue-600">${isEn ? 'Keyword Density' : 'Densidade Keywords'}</div>
                            </div>
                            <div class="p-3 bg-green-50 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-700" id="relevance-percent">0%</div>
                                <div class="text-xs text-green-600">${isEn ? 'Relevance' : 'Relev√¢ncia'}</div>
                            </div>
                            <div class="p-3 bg-purple-50 rounded-lg text-center">
                                <div class="text-2xl font-bold text-purple-700" id="ats-score">${this.intelligenceHub.matchScore || 0}%</div>
                                <div class="text-xs text-purple-600">${isEn ? 'ATS Score' : 'Score ATS'}</div>
                            </div>
                        </div>
                        
                        <!-- BOT√ïES DE A√á√ÉO PRINCIPAIS -->
                        <div class="grid grid-cols-2 gap-3 mt-4">
                            <button class="btn btn-primary" id="download-txt-btn">
                                <i class="fas fa-file-alt"></i> ${isEn ? 'Download TXT' : 'Baixar TXT'}
                            </button>
                            <button class="btn btn-rewrite" id="download-pdf-btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                                <i class="fas fa-file-pdf"></i> ${isEn ? 'Download PDF' : 'Baixar PDF'}
                            </button>
                        </div>
                        
                        <!-- DICAS DE USO -->
                        <div class="p-3 bg-yellow-50 rounded-lg">
                            <h4 class="font-bold text-yellow-700 mb-2">
                                <i class="fas fa-lightbulb"></i> ${isEn ? 'Usage Tips' : 'Dicas para Uso'}:
                            </h4>
                            <ul class="text-sm text-yellow-800 space-y-1">
                                <li>‚Ä¢ ${isEn ? 'Copy and paste directly into job application systems' : 'Copie e cole diretamente nos sistemas de vagas'}</li>
                                <li>‚Ä¢ ${isEn ? 'Keep simple formatting (no tables or images)' : 'Mantenha a formata√ß√£o simples (sem tabelas ou imagens)'}</li>
                                <li>‚Ä¢ ${isEn ? 'Use this CV as a base for other applications' : 'Use este CV como base para outras aplica√ß√µes'}</li>
                                <li>‚Ä¢ ${isEn ? 'Adjust the objective for each specific job' : 'Ajuste o objetivo para cada vaga espec√≠fica'}</li>
                                <li>‚Ä¢ ${isEn ? 'Change persona according to job focus' : 'Troque de persona conforme o foco da vaga'}</li>
                            </ul>
                        </div>
                    </div>
                `;

                // Atualizar m√©tricas
                this.atualizarMetricasOtimizacao();

                // Configurar event listeners
                setTimeout(() => {
                    // Bot√£o Visualizar TXT
                    document.getElementById('view-txt-btn')?.addEventListener('click', () => {
                        this.showCVasTXT(cvOtimizado);
                    });

                    // Bot√£o Copiar
                    document.getElementById('copy-cv-btn')?.addEventListener('click', () => {
                        this.copiarCV();
                    });

                    // Bot√£o Download TXT
                    document.getElementById('download-txt-btn')?.addEventListener('click', () => {
                        this.downloadCV();
                    });

                    // Bot√£o Download PDF
                    document.getElementById('download-pdf-btn')?.addEventListener('click', () => {
                        this.downloadPDF();
                    });
                }, 100);

                document.querySelector('[data-tab="optimization"]').classList.add('completed');
            }

            showCVasTXT(cvTexto) {
                if (!cvTexto) {
                    this.showNotification('Nenhum CV dispon√≠vel para visualiza√ß√£o', 'warning');
                    return;
                }

                const jobText = document.getElementById('job-text').value;
                const langConfig = this.getFlowLanguageConfig(jobText);
                const isEn = langConfig.isEnglish;

                const modal = document.getElementById('keywords-modal');
                const keywordsList = document.getElementById('keywords-list');
                const keywordsCount = document.getElementById('keywords-count');

                const escapeHTML = (text) => {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                };

                const cvFormatado = cvTexto.split('\n').map(line => {
                    if (line.trim() === '') return '&nbsp;';
                    return escapeHTML(line);
                }).join('<br>');

                keywordsList.innerHTML = `
                    <div class="space-y-3">
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <h4 class="font-bold text-blue-700 mb-2">
                                <i class="fas fa-file-code"></i> ${isEn ? 'CV in TXT Format' : 'CV em Formato TXT'}
                            </h4>
                            <p class="text-xs text-blue-600 mb-3">
                                ${isEn ? 'Copy the content below or use the buttons to download' : 'Copie o conte√∫do abaixo ou use os bot√µes para baixar'}
                            </p>
                            <div class="bg-white p-4 rounded border font-mono text-sm max-h-[400px] overflow-y-auto whitespace-pre-wrap">
                                ${cvFormatado}
                            </div>
                        </div>
                        
                        <div class="flex justify-end gap-2 mt-3">
                            <button class="btn btn-sm btn-outline-primary" id="modal-copy-txt">
                                <i class="fas fa-copy"></i> ${isEn ? 'Copy' : 'Copiar'}
                            </button>
                            <button class="btn btn-sm btn-outline-success" id="modal-download-txt">
                                <i class="fas fa-download"></i> ${isEn ? 'Download TXT' : 'Baixar TXT'}
                            </button>
                            <button class="btn btn-sm btn-outline-danger" id="modal-download-pdf">
                                <i class="fas fa-file-pdf"></i> ${isEn ? 'Download PDF' : 'Baixar PDF'}
                            </button>
                            <button class="btn btn-sm btn-secondary close-modal">
                                <i class="fas fa-times"></i> ${isEn ? 'Close' : 'Fechar'}
                            </button>
                        </div>
                    </div>
                `;

                keywordsCount.textContent = isEn ? 'CV Preview - TXT Format' : 'Pr√©-visualiza√ß√£o do CV - Formato TXT';
                modal.classList.add('active');

                setTimeout(() => {
                    document.getElementById('modal-copy-txt')?.addEventListener('click', () => {
                        navigator.clipboard.writeText(cvTexto).then(() => {
                            this.showNotification(isEn ? 'CV copied!' : 'CV copiado!', 'success');
                        }).catch(() => {
                            this.showNotification(isEn ? 'Error copying' : 'Erro ao copiar', 'error');
                        });
                    });

                    document.getElementById('modal-download-txt')?.addEventListener('click', () => {
                        this.downloadCV();
                    });

                    document.getElementById('modal-download-pdf')?.addEventListener('click', () => {
                        this.downloadPDF();
                    });
                }, 100);
            }

            copiarCV() {
                const cvTexto = this.sistema.dados.cvOtimizado;
                if (!cvTexto) {
                    this.showNotification('Nenhum CV dispon√≠vel para copiar', 'warning');
                    return;
                }

                navigator.clipboard.writeText(cvTexto).then(() => {
                    this.showNotification('CV copiado para √°rea de transfer√™ncia!', 'success');
                }).catch(() => {
                    this.showNotification('Erro ao copiar', 'error');
                });
            }

            downloadCV() {
                const cvTexto = this.sistema.dados.cvOtimizado;
                if (!cvTexto) {
                    this.showNotification('Nenhum CV dispon√≠vel para download', 'warning');
                    return;
                }

                const data = new Date();
                const timestamp = data.toISOString().split('T')[0];
                const personaSystem = this.sistema.getPersonaSystem();
                const personaName = this.selectedPersona ? 
                    personaSystem.getPersonaName(this.selectedPersona) : 'Personalizado';

                const blob = new Blob([cvTexto], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');

                a.href = url;
                a.download = `CV_Otimizado_${personaName.replace(/\s+/g, '_')}_${timestamp}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                this.showNotification('CV baixado com sucesso!', 'success');
            }

            downloadPDF() {
                const cvTexto = this.sistema.dados.cvOtimizado;
                if (!cvTexto) {
                    this.showNotification('Nenhum CV dispon√≠vel para PDF', 'warning');
                    return;
                }

                const data = new Date();
                const timestamp = data.toISOString().split('T')[0];
                const personaSystem = this.sistema.getPersonaSystem();
                const personaName = this.selectedPersona ? 
                    personaSystem.getPersonaName(this.selectedPersona) : 'Personalizado';

                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                document.body.appendChild(iframe);

                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const cvTextoEscapado = cvTexto
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');

                const cvComBr = cvTextoEscapado.replace(/\n/g, '<br>');

                iframeDoc.open();
                iframeDoc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Curr√≠culo - ${personaName}</title>
                        <style>
                            body { 
                                font-family: 'Courier New', monospace;
                                line-height: 1.4;
                                margin: 2cm;
                                font-size: 12pt;
                                color: black;
                                background: white;
                            }
                            .header {
                                text-align: center;
                                margin-bottom: 20px;
                                padding-bottom: 10px;
                                border-bottom: 2px solid #333;
                            }
                            .content {
                                white-space: pre-wrap;
                                word-wrap: break-word;
                            }
                            @media print {
                                body { margin: 1.5cm; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header no-print">
                            <h2>Curr√≠culo Otimizado - ${personaName}</h2>
                            <p>Gerado em: ${data.toLocaleDateString('pt-BR')}</p>
                        </div>
                        
                        <div class="content">
                            ${cvComBr}
                        </div>
                        
                        <div class="no-print" style="margin-top: 30px; font-size: 10px; text-align: center; color: #666;">
                            <hr>
                            CV gerado por CV ReWriter Pro Ultimate
                        </div>
                        
                        <script>
                            window.onload = function() {
                                setTimeout(function() {
                                    window.print();
                                    setTimeout(function() {
                                        window.parent.document.body.removeChild(window.frameElement);
                                    }, 1000);
                                }, 500);
                            }
                        <\/script>
                    </body>
                    </html>
                `);
                iframeDoc.close();
            }

            atualizarMetricasOtimizacao() {
                try {
                    const analise = this.sistema.dados.analiseRelevancia;
                    if (analise) {
                        const keywordPercent = Math.min(100, analise.porcentagemRelevante + 20);
                        const relevancePercent = analise.porcentagemRelevante;

                        document.getElementById('keyword-density').textContent = `${keywordPercent}%`;
                        document.getElementById('keyword-bar').style.width = `${keywordPercent}%`;

                        document.getElementById('relevance-percent').textContent = `${relevancePercent}%`;
                        document.getElementById('relevance-bar').style.width = `${relevancePercent}%`;
                    }
                } catch (error) {
                    console.log('Erro ao atualizar m√©tricas:', error);
                }
            }

            formatCVForDisplay(cvTexto) {
                if (!cvTexto) return '<div class="text-center p-4"><i class="fas fa-file-alt fa-3x text-gray-300"></i><p>CV n√£o dispon√≠vel</p></div>';

                const lines = cvTexto.split('\n');
                let html = '<div class="space-y-4">';

                lines.forEach(line => {
                    if (line.trim() === '') return;

                    if (line.includes('=')) {
                        html += `<hr class="my-4 border-gray-300">`;
                    } else if (line === line.toUpperCase() && !line.includes(':')) {
                        html += `<h3 class="text-xl font-bold text-primary mb-2">${line}</h3>`;
                    } else if (line.includes(':')) {
                        const [label, ...valueParts] = line.split(':');
                        const value = valueParts.join(':').trim();
                        html += `
                            <div class="mb-2">
                                <strong class="text-gray-700">${label}:</strong>
                                <span class="text-gray-900">${value}</span>
                            </div>
                        `;
                    } else if (line.startsWith('‚Ä¢')) {
                        html += `<div class="ml-4 flex items-start">
                                <i class="fas fa-circle text-xs text-primary mt-1 mr-2"></i>
                                <span>${line.substring(1).trim()}</span>
                            </div>`;
                    } else {
                        html += `<p class="text-gray-800">${line}</p>`;
                    }
                });

                html += '</div>';
                return html;
            }

            autoDetectChangesHibrida(text) {
                if (text.length < 30) {
                    const detectionDiv = document.getElementById('auto-detection');
                    if (detectionDiv) {
                        detectionDiv.innerHTML = '<span class="tag tag-primary">Digite mais texto...</span>';
                    }
                    return;
                }

                clearTimeout(this.autoDetectTimeout);
                this.autoDetectTimeout = setTimeout(() => {
                    try {
                        let keywords = [];

                        if (this.sistemaLocal && this.sistemaLocal.ia) {
                            keywords = this.sistemaLocal.ia.extrairKeywords(text).slice(0, 5);
                        } else if (this.sistema && this.sistema.extrairKeywordsAvancado) {
                            keywords = this.sistema.extrairKeywordsAvancado(text).slice(0, 5);
                        }

                        const detectionDiv = document.getElementById('auto-detection');
                        if (detectionDiv) {
                            if (keywords.length > 0) {
                                detectionDiv.innerHTML = keywords.map(k =>
                                    `<span class="tag tag-primary">${k}</span>`
                                ).join('');
                            } else {
                                detectionDiv.innerHTML = '<span class="tag tag-primary">Nenhuma keyword detectada</span>';
                            }
                        }
                    } catch (error) {
                        console.log('Erro na detec√ß√£o:', error);
                    }
                }, 1200);
            }

            showSystemInfoHibrido() {
                const status = this.sistema.getStatus();
                const metricas = this.sistema.getMetricas();

                let statsLocal = { perfis: 0, historico: 0, keywordsAprendidas: 0 };
                if (this.sistemaLocal) {
                    statsLocal = this.sistemaLocal.getEstatisticas();
                }

                const infoHTML = `
                    <div class="space-y-4">
                        <div class="p-3 bg-purple-50 rounded-lg">
                            <div class="font-bold text-purple-700">CV ReWriter Pro Ultimate</div>
                            <div class="text-sm text-purple-800">
                                Sistema 100% funcional de rewriting de CVs com IA avan√ßada e 5 Personas Estrat√©gicas
                            </div>
                        </div>
                        
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <div class="font-bold text-blue-700 mb-1">Status do Sistema</div>
                            <div class="text-sm text-blue-800 space-y-1">
                                <div class="flex justify-between">
                                    <span>An√°lise de Vaga:</span>
                                    <span class="font-bold ${status.vagaAnalisada ? 'text-green-600' : 'text-red-600'}">
                                        ${status.vagaAnalisada ? '‚úì Conclu√≠da' : '‚úó Pendente'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span>CV Configurado:</span>
                                    <span class="font-bold ${status.cvConfigurado ? 'text-green-600' : 'text-red-600'}">
                                        ${status.cvConfigurado ? '‚úì Conclu√≠do' : '‚úó Pendente'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span>An√°lise de Relev√¢ncia:</span>
                                    <span class="font-bold ${status.relevanciaAnalisada ? 'text-green-600' : 'text-red-600'}">
                                        ${status.relevanciaAnalisada ? '‚úì Conclu√≠da' : '‚úó Pendente'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Rewriting:</span>
                                    <span class="font-bold ${status.rewritingExecutado ? 'text-green-600' : 'text-red-600'}">
                                        ${status.rewritingExecutado ? '‚úì Conclu√≠do' : '‚úó Pendente'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Persona Selecionada:</span>
                                    <span class="font-bold ${status.personaSelecionada ? 'text-purple-600' : 'text-gray-600'}">
                                        ${status.personaSelecionada || 'Nenhuma'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-green-50 rounded-lg">
                            <div class="font-bold text-green-700 mb-1">Estat√≠sticas do Sistema</div>
                            <div class="text-sm text-green-800">
                                <p>‚Ä¢ An√°lises realizadas: ${metricas.analisesRealizadas}</p>
                                <p>‚Ä¢ Rewritings executados: ${metricas.rewritesRealizados}</p>
                                <p>‚Ä¢ Keywords aprendidas: ${metricas.keywordsCount}</p>
                                <p>‚Ä¢ Personas dispon√≠veis: 5 (Front-end, Back-end, Full Stack, UX/UI Dev, Produto)</p>
                            </div>
                        </div>
                        
                        ${this.sistemaLocal ? `
                        <div class="p-3 bg-yellow-50 rounded-lg">
                            <div class="font-bold text-yellow-700 mb-1">Backend Local</div>
                            <div class="text-sm text-yellow-800">
                                <p>‚Ä¢ Perfis salvos: ${statsLocal.perfis}</p>
                                <p>‚Ä¢ A√ß√µes no hist√≥rico: ${statsLocal.historico}</p>
                                <p>‚Ä¢ Keywords aprendidas: ${statsLocal.keywordsAprendidas}</p>
                                <p>‚Ä¢ Sistema de aprendizado ativo</p>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;

                const modal = document.getElementById('keywords-modal');
                const keywordsList = document.getElementById('keywords-list');
                const keywordsCount = document.getElementById('keywords-count');

                keywordsList.innerHTML = infoHTML;
                keywordsCount.textContent = 'Informa√ß√µes do Sistema (Integrado)';
                modal.classList.add('active');
            }

            resetSystemHibrido() {
                if (confirm('Tem certeza que deseja resetar todo o sistema? Todos os dados ser√£o perdidos.')) {
                    this.sistema.resetarSistema();
                    this.selectedPersona = null;

                    if (this.sistemaLocal) {
                        ['PERFIS', 'HISTORICO', 'DICIONARIO', 'EVOLUCAO', 'ESTADO', 'KEYWORDS'].forEach(key => {
                            const KEYS = this.sistemaLocal.bd.KEYS;
                            if (KEYS[key]) {
                                localStorage.removeItem(KEYS[key]);
                            }
                        });
                        this.sistemaLocal.bd.inicializarBancoDeDados();
                    }

                    this.clearJobText();
                    this.resetCV();

                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('completed');
                    });

                    document.querySelectorAll('.persona-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    document.getElementById('persona-description').classList.add('hidden');

                    document.getElementById('analysis-placeholder').classList.remove('hidden');
                    document.getElementById('analysis-results').classList.add('hidden');

                    document.getElementById('relevance-placeholder').classList.remove('hidden');
                    document.getElementById('relevance-results').classList.add('hidden');

                    document.getElementById('rewriting-placeholder').classList.remove('hidden');
                    document.getElementById('rewriting-results').classList.add('hidden');

                    document.getElementById('optimization-placeholder').classList.remove('hidden');
                    document.getElementById('optimization-results').classList.add('hidden');

                    this.atualizarStats();
                    this.switchTab('analysis');

                    this.showNotification('Sistemas resetados com sucesso!', 'success');
                }
            }

            setupPersonaEvents() {
                document.querySelectorAll('.persona-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const persona = e.currentTarget.dataset.persona;
                        this.selectPersona(persona);
                    });
                });
            }

            selectPersona(personaName) {
                this.selectedPersona = personaName;

                document.querySelectorAll('.persona-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                const selectedBtn = document.querySelector(`[data-persona="${personaName}"]`);
                if (selectedBtn) selectedBtn.classList.add('active');

                const personaSystem = this.sistema.getPersonaSystem();
                if (personaSystem) {
                    const description = personaSystem.getPersonaDescription(personaName);
                    const name = personaSystem.getPersonaName(personaName);

                    const descElement = document.getElementById('persona-description');
                    const textElement = document.getElementById('persona-desc-text');

                    if (descElement && textElement) {
                        descElement.classList.remove('hidden');
                        textElement.textContent = `${name}: ${description}`;
                    }
                }

                this.showNotification(`Persona "${personaName}" selecionada`, 'info');
            }

            addExperienceEntry() {
                const timeline = document.getElementById('experience-timeline');
                const entryId = `experience-${Date.now()}`;

                const entryHTML = `
                    <div class="experience-entry mb-3 p-3 border rounded-lg bg-white" id="${entryId}">
                        <div class="grid grid-cols-2 gap-3 mb-2">
                            <div>
                                <label class="text-sm font-medium">Cargo</label>
                                <input type="text" class="form-control-sm" 
                                       placeholder="Ex: Desenvolvedor Full Stack" data-field="cargo">
                            </div>
                            <div>
                                <label class="text-sm font-medium">Empresa</label>
                                <input type="text" class="form-control-sm" 
                                       placeholder="Ex: Tech Solutions" data-field="empresa">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mb-2">
                            <div>
                                <label class="text-sm font-medium">Per√≠odo</label>
                                <input type="text" class="form-control-sm" 
                                       placeholder="Ex: 2020 - Atual" data-field="periodo">
                            </div>
                            <div>
                                <label class="text-sm font-medium">Local</label>
                                <input type="text" class="form-control-sm" 
                                       placeholder="Ex: S√£o Paulo, SP" data-field="local">
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="text-sm font-medium">Descri√ß√£o</label>
                            <textarea class="form-control-sm" rows="2" 
                                      placeholder="Principais realiza√ß√µes..." data-field="descricao"></textarea>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger remove-experience" 
                                data-id="${entryId}">
                            <i class="fas fa-trash"></i> Remover
                        </button>
                    </div>
                `;

                timeline.insertAdjacentHTML('beforeend', entryHTML);

                document.querySelector(`#${entryId} .remove-experience`).addEventListener('click', (e) => {
                    const button = e.target.tagName === 'BUTTON' ? e.target : e.target.closest('button');
                    const entry = document.getElementById(button.dataset.id);
                    if (entry) entry.remove();
                    this.updateExperienceField();
                });

                const entryEl = document.getElementById(entryId);
                entryEl.querySelectorAll('input, textarea').forEach(field => {
                    field.addEventListener('input', () => this.updateExperienceField());
                });

                this.updateExperienceField();
            }

            updateExperienceField() {
                const entries = document.querySelectorAll('.experience-entry');
                const experiences = [];

                entries.forEach(entry => {
                    const cargo = entry.querySelector('[data-field="cargo"]')?.value || '';
                    const empresa = entry.querySelector('[data-field="empresa"]')?.value || '';
                    const periodo = entry.querySelector('[data-field="periodo"]')?.value || '';
                    const local = entry.querySelector('[data-field="local"]')?.value || '';
                    const descricao = entry.querySelector('[data-field="descricao"]')?.value || '';

                    if (cargo || empresa || descricao) {
                        let experiencia = '';
                        if (cargo && empresa) {
                            experiencia = `${cargo} - ${empresa}`;
                        } else if (cargo) {
                            experiencia = cargo;
                        } else if (empresa) {
                            experiencia = empresa;
                        }

                        if (periodo) {
                            experiencia += ` (${periodo})`;
                        }
                        if (local) {
                            experiencia += ` | ${local}`;
                        }

                        if (experiencia) {
                            experiences.push(experiencia);
                        }
                        if (descricao) {
                            experiences.push(descricao);
                        }
                    }
                });

                document.getElementById('cv-experience').value = experiences.join('\n');
                this.updateCVPreview();
            }

            parseExperienceToTimeline(experienceText) {
                if (!experienceText || !experienceText.trim()) return;

                const timeline = document.getElementById('experience-timeline');
                timeline.innerHTML = '';

                const sections = experienceText.split(/\n{2,}/);

                sections.forEach(section => {
                    if (section.trim()) {
                        this.addExperienceEntry();
                        const entries = document.querySelectorAll('.experience-entry');
                        const lastEntry = entries[entries.length - 1];

                        if (lastEntry) {
                            const lines = section.split('\n').filter(l => l.trim());

                            if (lines.length > 0) {
                                const firstLine = lines[0];

                                if (firstLine.includes(' - ')) {
                                    const [cargo, ...rest] = firstLine.split(' - ');
                                    const empresa = rest.join(' - ');
                                    lastEntry.querySelector('[data-field="cargo"]').value = cargo.trim();

                                    const empresaMatch = empresa.match(/(.*?)\s*\(([^)]+)\)/);
                                    if (empresaMatch) {
                                        lastEntry.querySelector('[data-field="empresa"]').value = empresaMatch[1].trim();
                                        lastEntry.querySelector('[data-field="periodo"]').value = empresaMatch[2].trim();
                                    } else {
                                        lastEntry.querySelector('[data-field="empresa"]').value = empresa.trim();
                                    }
                                } else {
                                    lastEntry.querySelector('[data-field="cargo"]').value = firstLine.trim();
                                }

                                if (lines.length > 1) {
                                    const descricao = lines.slice(1).join('\n').trim();
                                    lastEntry.querySelector('[data-field="descricao"]').value = descricao;
                                }
                            }
                        }
                    }
                });

                this.updateExperienceField();
            }

            carregarCVDoLocalStorage() {
                try {
                    const savedCV = localStorage.getItem('cv_data');
                    if (savedCV) {
                        const cvData = JSON.parse(savedCV);
                        this.preencherFormularioCV(cvData);
                    }
                } catch (e) {
                    console.warn('Erro ao carregar CV:', e);
                }
            }

            getFlowLanguageConfig(jobText) {
                const choice = document.getElementById('target-language')?.value || 'auto';
                const enKeywords = ['requirements', 'skills', 'experience', 'responsibilities', 'knowledge', 'background', 'description'];
                const isJobEnglish = enKeywords.some(word => jobText.toLowerCase().includes(word));

                const targetEn = choice === 'en' || (choice === 'auto' && isJobEnglish);

                return {
                    isEnglish: targetEn,
                    label: targetEn ? 'English' : 'Portugu√™s',
                    instruction: targetEn ?
                        "MODO TRADU√á√ÉO: Compare o CV em portugu√™s com a vaga em ingl√™s. O RESULTADO FINAL deve ser em INGL√äS t√©cnico." :
                        "MODO PADR√ÉO: Analise e otimize o curr√≠culo mantendo o idioma em PORTUGU√äS.",
                    ui: {
                        appliedPersona: targetEn ? 'Applied Persona' : 'Persona Aplicada',
                        recommendedByATS: targetEn ? '(Recommended by ATS Analysis)' : '(Recomendada pela An√°lise ATS)',
                        manuallySelected: targetEn ? '(Manually selected)' : '(Selecionada manualmente)',
                        atsRecommends: targetEn ? 'ATS recommends' : 'An√°lise recomenda',
                        noATSAnalysis: targetEn ? '(ATS Analysis not performed)' : '(An√°lise ATS n√£o realizada)',
                        preserved: targetEn ? 'Preserved' : 'Preservado',
                        experienceEducation: targetEn ? 'Experience, Education, Contact, Dates, Companies' : 'Experi√™ncia, Educa√ß√£o, Contato, Datas, Empresas',
                        adapted: targetEn ? 'Adapted' : 'Adaptado',
                        objectiveSkills: targetEn ? 'Objective, Summary, Skills Ordering' : 'Objetivo, Resumo, Ordena√ß√£o de Habilidades',
                        originalCV: targetEn ? 'ORIGINAL CV' : 'CV ORIGINAL',
                        rewrittenCV: targetEn ? 'REWRITTEN CV' : 'CV REWRITTEN',
                        reductionIrrelevant: targetEn ? 'Irrelevant Reduction' : 'Redu√ß√£o Irrelevante',
                        keywordsIncrease: targetEn ? 'Keywords Increase' : 'Aumento Keywords',
                        ATS_MATCH: targetEn ? 'ATS Match' : 'Match ATS',
                        viewDetails: targetEn ? 'View Details' : 'Ver Detalhes',
                        viewOptimizedCV: targetEn ? 'View Optimized CV' : 'Ver CV Otimizado',
                        redFlags: targetEn ? 'Red Flags' : 'Red Flags',
                        greenFlags: targetEn ? 'Green Flags' : 'Green Flags',
                        priorityKeywords: targetEn ? 'Priority Keywords' : 'Keywords Priorit√°rias'
                    }
                };
            }

            displayAnalysisResults(analise) {
                document.getElementById('analysis-placeholder').classList.add('hidden');
                document.getElementById('analysis-results').classList.remove('hidden');

                const isEn = analise.langConfig && analise.langConfig.isEnglish;
                const langBadge = isEn ?
                    `<div class="analysis-item" style="grid-column: span 2; background: rgba(9, 132, 227, 0.1); border: 1px solid var(--info);">
                        <div class="analysis-label" style="color: var(--info); font-weight: bold;"><i class="fas fa-globe-americas"></i> BILINGUAL MODE ACTIVE</div>
                        <div class="analysis-value">Output configured for: <strong>ENGLISH</strong> (Auto Translation Active)</div>
                    </div>` :
                    `<div class="analysis-item" style="grid-column: span 2; background: rgba(0, 184, 148, 0.1); border: 1px solid var(--success);">
                        <div class="analysis-label" style="color: var(--success); font-weight: bold;"><i class="fas fa-check-circle"></i> STANDARD LANGUAGE</div>
                        <div class="analysis-value">Output configured for: <strong>PORTUGUESE</strong></div>
                    </div>`;

                const basicInfoDiv = document.getElementById('job-basic-info');
                basicInfoDiv.innerHTML = `
                    ${langBadge}
                    <div class="analysis-item">
                        <div class="analysis-label">${isEn ? 'Company' : 'Empresa'}</div>
                        <div class="analysis-value">${analise.empresa}</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">${isEn ? 'Salary' : 'Sal√°rio'}</div>
                        <div class="analysis-value">${analise.salario}</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">${isEn ? 'Seniority' : 'Senioridade'}</div>
                        <div class="analysis-value">${analise.senioridade}</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">${isEn ? 'Contract' : 'Contrato'}</div>
                        <div class="analysis-value">${analise.tipoContrato}</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">${isEn ? 'Work Model' : 'Modelo'}</div>
                        <div class="analysis-value">${analise.modeloTrabalho}</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">${isEn ? 'Keywords' : 'Keywords'}</div>
                        <div class="analysis-value">${analise.keywords.length}</div>
                    </div>
                `;

                const insightsContainer = document.getElementById('vaga-insights');
                if (insightsContainer) {
                    const ehSenior = analise.senioridade.toLowerCase().includes('s√™nior') ||
                        analise.senioridade.toLowerCase().includes('senior');
                    const salarioAlto = analise.salario.includes('15') ||
                        analise.salario.includes('18') ||
                        analise.salario.includes('20');

                    if (isEn) {
                        insightsContainer.innerHTML = `
                            <div class="p-2 bg-white rounded border border-blue-100 mb-2">
                                <strong class="text-blue-700"><i class="fas fa-coins"></i> Financial Analysis:</strong> 
                                ${salarioAlto ? 'Premium budget' : 'Competitive budget'} for ${analise.senioridade} level. ${analise.tipoContrato !== 'N√£o especificado' ? `${analise.tipoContrato} model.` : ''}
                            </div>
                            <div class="p-2 bg-white rounded border border-blue-100 mb-2">
                                <strong class="text-blue-700"><i class="fas fa-bullseye"></i> Application Strategy:</strong> 
                                ${ehSenior ? 'Emphasize leadership and business impact' : 'Highlight technical execution and fast learning'}. 
                            </div>
                            <div class="p-2 bg-white rounded border border-blue-100">
                                <strong class="text-blue-700"><i class="fas fa-users"></i> Organizational Culture:</strong> 
                                ${analise.modeloTrabalho === 'Remoto' ? 'High autonomy environment' :
                            analise.modeloTrabalho === 'H√≠brido' ? 'Flexible culture with in-person collaboration' :
                                'Traditional culture focused on in-person work'}. 
                            </div>
                        `;
                    } else {
                        insightsContainer.innerHTML = `
                            <div class="p-2 bg-white rounded border border-blue-100 mb-2">
                                <strong class="text-blue-700"><i class="fas fa-coins"></i> An√°lise Financeira:</strong> 
                                ${salarioAlto ? 'Or√ßamento premium' : 'Or√ßamento competitivo'} para n√≠vel ${analise.senioridade}. ${analise.tipoContrato !== 'N√£o especificado' ? `Modelo ${analise.tipoContrato}.` : ''}
                            </div>
                            <div class="p-2 bg-white rounded border border-blue-100 mb-2">
                                <strong class="text-blue-700"><i class="fas fa-bullseye"></i> Estrat√©gia de Candidatura:</strong> 
                                ${ehSenior ? 'Enfatizar lideran√ßa e impacto no neg√≥cio' : 'Destacar execu√ß√£o t√©cnica e aprendizado r√°pido'}. 
                            </div>
                            <div class="p-2 bg-white rounded border border-blue-100">
                                <strong class="text-blue-700"><i class="fas fa-users"></i> Cultura Organizacional:</strong> 
                                ${analise.modeloTrabalho === 'Remoto' ? 'Ambiente de alta autonomia' :
                            analise.modeloTrabalho === 'H√≠brido' ? 'Cultura flex√≠vel com colabora√ß√£o presencial' :
                                'Cultura tradicional com foco em presencial'}. 
                            </div>
                        `;
                    }
                }

                const skillsDiv = document.getElementById('skills-detected');
                const keywordsToShow = analise.keywords.slice(0, 20);
                skillsDiv.innerHTML = keywordsToShow.map(skill =>
                    `<span class="tag tag-primary">${skill}</span>`
                ).join('');

                document.querySelector('[data-tab="analysis"]').classList.add('completed');
            }

            quickAnalyze() {
                const jobText = document.getElementById('job-text').value.trim();

                if (!jobText) {
                    this.showNotification('Cole uma vaga primeiro!', 'warning');
                    return;
                }

                this.showLoading('Detectando keywords...');

                setTimeout(() => {
                    try {
                        const keywords = this.sistema.extrairKeywordsAvancado(jobText).slice(0, 10);
                        const detectionDiv = document.getElementById('auto-detection');

                        if (keywords.length > 0) {
                            detectionDiv.innerHTML = keywords.map(k =>
                                `<span class="tag tag-primary">${k}</span>`
                            ).join('');
                            this.showNotification(`${keywords.length} keywords detectadas!`, 'info');
                        } else {
                            detectionDiv.innerHTML = '<span class="tag tag-primary">Nenhuma keyword detectada</span>';
                        }

                    } catch (error) {
                        this.showNotification('Erro na detec√ß√£o', 'error');
                    } finally {
                        this.hideLoading();
                    }
                }, 600);
            }

            clearJobText() {
                document.getElementById('job-text').value = '';
                const detectionDiv = document.getElementById('auto-detection');
                if (detectionDiv) {
                    detectionDiv.innerHTML = '<span class="tag tag-primary">Aguardando an√°lise...</span>';
                }
                document.getElementById('analysis-placeholder').classList.remove('hidden');
                document.getElementById('analysis-results').classList.add('hidden');
                this.showNotification('Texto da vaga limpo!', 'info');
            }

            loadInitialExample() {
                const exampleJob = `Desenvolvedor Full Stack Pleno

Empresa: TechSolutions Brasil
Sal√°rio: R$ 12.000 - R$ 18.000 CLT
Senioridade: Pleno
Modelo: H√≠brido (3x presencial)

REQUISITOS OBRIGAT√ìRIOS:
- JavaScript/TypeScript avan√ßado
- React.js com Hooks e Context API
- Node.js e Express para APIs REST
- Banco de dados SQL (PostgreSQL) e NoSQL (MongoDB)
- Git e metodologias √°geis (Scrum/Kanban)
- Conhecimento em AWS (EC2, S3, Lambda)

DIFERENCIAIS:
- Experi√™ncia com Docker e Kubernetes
- Conhecimento em GraphQL
- Testes automatizados (Jest, Cypress)
- CI/CD com GitHub Actions

ATRIBUI√á√ïES:
- Desenvolvimento de novas features
- Manuten√ß√£o e otimiza√ß√£o de sistemas existentes
- Colabora√ß√£o com equipe de UX/UI
- Participa√ß√£o em code reviews

BENEF√çCIOS:
- Plano de sa√∫de Unimed
- VR/VA de R$ 1.200
- Gympass
- Home office 2x por semana
- Plano de desenvolvimento individual`;

                document.getElementById('job-text').value = exampleJob;
                setTimeout(() => this.autoDetectChangesHibrida(exampleJob), 100);
            }

            loadExampleJob() {
                const exampleJob = `Analista de Dados S√™nior
Empresa: DataCorp Analytics
Sal√°rio: R$ 15.000 - R$ 22.000 PJ
Requisitos: Python, SQL, Power BI, Machine Learning, AWS
Benef√≠cios: Remoto total, b√¥nus por performance, VR/VA`;

                document.getElementById('job-text').value = exampleJob;
                setTimeout(() => this.autoDetectChangesHibrida(exampleJob), 100);
                this.showNotification('Exemplo carregado!', 'info');
            }

            async pasteFromClipboard() {
                try {
                    const text = await navigator.clipboard.readText();
                    if (text) {
                        const jobTextElement = document.getElementById('job-text');
                        jobTextElement.value = text;

                        const inputEvent = new Event('input', { bubbles: true });
                        jobTextElement.dispatchEvent(inputEvent);

                        this.showNotification('Texto colado do clipboard!', 'success');

                        setTimeout(() => {
                            if (text.length > 100) {
                                this.analisarVagaHibrida();
                            }
                        }, 500);

                        return true;
                    } else {
                        this.showNotification('Clipboard vazio ou sem texto', 'warning');
                        return false;
                    }
                } catch (error) {
                    console.error('Erro ao acessar clipboard:', error);

                    const fallbackText = prompt('Cole o texto da vaga:');
                    if (fallbackText) {
                        document.getElementById('job-text').value = fallbackText;
                        this.showNotification('Texto colado via prompt!', 'info');
                        return true;
                    }

                    this.showNotification('N√£o foi poss√≠vel acessar o clipboard', 'error');
                    return false;
                }
            }

            carregarCVMaker() {
                const cvMaker = {
                    nome: 'M√°rcio Gemelli',
                    cargo: 'Desenvolvedor Full Stack',
                    localizacao: 'S√£o Paulo, SP',
                    salario: 'R$ 8.000 - R$ 12.000',
                    objetivo: 'Busco oportunidade como Desenvolvedor Full Stack em empresa inovadora para aplicar minhas habilidades em desenvolvimento web e contribuir com projetos desafiadores.',
                    habilidades: 'JavaScript, React, Node.js, Python, Docker, AWS, Git, MongoDB, PostgreSQL, Figma',
                    experiencia: `Desenvolvedor Full Stack Freelance (2023 - Atual)
‚Ä¢ Desenvolvimento de aplica√ß√µes web com React e Node.js
‚Ä¢ Cria√ß√£o de APIs REST para integra√ß√£o de sistemas
‚Ä¢ Implementa√ß√£o de bancos de dados NoSQL e SQL
‚Ä¢ Deploy de aplica√ß√µes em AWS e Docker

Projetos Acad√™micos
‚Ä¢ Sistema de gest√£o para pequenas empresas
‚Ä¢ Aplicativo de tarefas com React Native
‚Ä¢ API de an√°lise de dados com Python`
                };

                this.preencherFormularioCV(cvMaker);
                this.sistema.configurarCV(cvMaker);
                this.showNotification('CV M√°rcio Maker carregado!', 'success');
            }

            preencherFormularioCV(cvDados) {
                document.getElementById('cv-name').value = cvDados.nome || '';
                document.getElementById('cv-title').value = cvDados.cargo || '';
                document.getElementById('cv-location').value = cvDados.localizacao || '';
                document.getElementById('cv-salary').value = cvDados.salario || '';
                document.getElementById('cv-objective').value = cvDados.objetivo || '';
                document.getElementById('cv-skills').value = cvDados.habilidades || '';
                document.getElementById('cv-experience').value = cvDados.experiencia || '';

                if (cvDados.experiencia) {
                    this.parseExperienceToTimeline(cvDados.experiencia);
                }

                this.updateCVPreview();
            }

            updateCVPreview() {
                const nome = document.getElementById('cv-name').value || 'Nome n√£o informado';
                const cargo = document.getElementById('cv-title').value || 'Cargo n√£o informado';
                const localizacao = document.getElementById('cv-location').value || '';
                const salario = document.getElementById('cv-salary').value || '';
                const objetivo = document.getElementById('cv-objective').value || '';
                const habilidades = document.getElementById('cv-skills').value || '';
                const experiencia = document.getElementById('cv-experience').value || '';

                let previewHTML = `
                    <div class="space-y-4">
                        <div class="p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg">
                            <h3 class="text-xl font-bold">${nome}</h3>
                            <p class="opacity-90 mt-1">${cargo}</p>
                            ${localizacao ? `<p class="opacity-80 text-sm mt-1"><i class="fas fa-map-marker-alt"></i> ${localizacao}</p>` : ''}
                            ${salario ? `<p class="opacity-80 text-sm mt-1"><i class="fas fa-money-bill-wave"></i> ${salario}</p>` : ''}
                        </div>
                        
                        ${objetivo ? `
                            <div>
                                <h4 class="font-bold mb-2 text-primary">Objetivo</h4>
                                <p class="text-sm">${objetivo}</p>
                            </div>
                        ` : ''}
                        
                        ${habilidades ? `
                            <div>
                                <h4 class="font-bold mb-2 text-primary">Habilidades T√©cnicas</h4>
                                <div class="tags-container">
                                    ${habilidades.split(/[,;\n]/).slice(0, 12).map(skill =>
                    skill.trim() ? `<span class="tag tag-primary">${skill.trim()}</span>` : ''
                ).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${experiencia ? `
                            <div>
                                <h4 class="font-bold mb-2 text-primary">Experi√™ncia Profissional</h4>
                                <div class="text-sm space-y-3">
                                    ${experiencia.split('\n\n').slice(0, 3).map(exp =>
                    `<div class="p-2 border-l-4 border-primary bg-blue-50">
                                            <div class="whitespace-pre-line">${exp.substring(0, 150)}${exp.length > 150 ? '...' : ''}</div>
                                        </div>`
                ).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;

                document.getElementById('cv-preview').innerHTML = previewHTML;
            }

            enhanceCV() {
                this.showLoading('Melhorando CV com IA...', 'Reescrevendo objetivo e habilidades');

                setTimeout(() => {
                    try {
                        const objetivoAtual = document.getElementById('cv-objective').value;
                        if (objetivoAtual && objetivoAtual.length > 10) {
                            const novoObjetivo = objetivoAtual.replace(/busco/i, 'profissional especializado em')
                                .replace(/oportunidade/i, 'desafios')
                                .replace(/onde possa/i, 'com foco em');
                            document.getElementById('cv-objective').value = novoObjetivo + " Comprometido com excel√™ncia t√©cnica e entrega de resultados mensur√°veis.";
                        }

                        const skillsAtual = document.getElementById('cv-skills').value;
                        if (skillsAtual) {
                            const skillsArray = skillsAtual.split(',').map(s => s.trim());
                            const skillsMelhoradas = skillsArray
                                .filter(s => s.length > 2)
                                .map(s => s.charAt(0).toUpperCase() + s.slice(1))
                                .join(', ');
                            document.getElementById('cv-skills').value = skillsMelhoradas;
                        }

                        this.updateCVPreview();
                        this.showNotification('CV melhorado com IA!', 'success');

                    } catch (error) {
                        this.showNotification('Erro ao melhorar CV', 'error');
                    } finally {
                        this.hideLoading();
                    }
                }, 1500);
            }

            resetCV() {
                if (confirm('Redefinir formul√°rio de CV?')) {
                    document.getElementById('cv-name').value = '';
                    document.getElementById('cv-title').value = '';
                    document.getElementById('cv-location').value = '';
                    document.getElementById('cv-salary').value = '';
                    document.getElementById('cv-objective').value = '';
                    document.getElementById('cv-skills').value = '';
                    document.getElementById('cv-experience').value = '';

                    const timeline = document.getElementById('experience-timeline');
                    timeline.innerHTML = '';

                    this.updateCVPreview();
                    this.showNotification('CV redefinido!', 'info');
                }
            }

            displayRelevanceResults(analise) {
                document.getElementById('relevance-placeholder').classList.add('hidden');
                document.getElementById('relevance-results').classList.remove('hidden');

                const scorePorcentagem = analise.porcentagemRelevante;
                const matches = analise.keywordsMatch || 0;
                const totalKeywords = analise.totalKeywords || analise.keywordsVaga.length;

                const jobText = document.getElementById('job-text').value;
                const langConfig = this.getFlowLanguageConfig(jobText);
                const isEn = langConfig.isEnglish;

                document.getElementById('relevance-results').innerHTML = `
                    <div class="score-display">
                        <div class="score-label">${isEn ? 'CV Relevance for the Job' : 'Relev√¢ncia do CV para a Vaga'}</div>
                        <div class="score-value">${scorePorcentagem}%</div>
                        <div class="text-sm text-secondary mt-2">
                            ${scorePorcentagem >= 80 ? (isEn ? 'Excellent alignment!' : 'Excelente alinhamento!') :
                        scorePorcentagem >= 60 ? (isEn ? 'Good alignment' : 'Bom alinhamento') :
                            scorePorcentagem >= 40 ? (isEn ? 'Moderate alignment' : 'Alinhamento moderado') :
                                (isEn ? 'Low alignment' : 'Baixo alinhamento')}
                        </div>
                    </div>
                    
                    <div class="rewrite-metrics mb-4">
                        <div class="metric-card">
                            <div class="metric-value">${totalKeywords}</div>
                            <div class="metric-label">${isEn ? 'Job Keywords' : 'Keywords da Vaga'}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${matches}/${totalKeywords}</div>
                            <div class="metric-label">${isEn ? 'Keyword Match' : 'Match de Keywords'}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${analise.recomendacoes.length}</div>
                            <div class="metric-label">${isEn ? 'Recommendations' : 'Recomenda√ß√µes'}</div>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-purple-50 rounded-lg">
                        <h4 class="font-bold text-purple-800 mb-2">${isEn ? 'Improvement Recommendations' : 'Recomenda√ß√µes para Melhoria'}</h4>
                        <div class="space-y-2">
                            ${analise.recomendacoes.map((rec, i) => `
                                <div class="flex items-start gap-2">
                                    <i class="fas fa-magic text-purple-500 mt-1"></i>
                                    <span class="text-sm">${i + 1}. ${rec}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <button class="btn btn-primary" id="view-keywords-btn">
                            <i class="fas fa-code"></i> ${isEn ? 'View Keywords' : 'Ver Keywords'}
                        </button>
                        <button class="btn btn-rewrite" id="goto-rewriting-btn">
                            <i class="fas fa-wand-magic-sparkles"></i> ${isEn ? 'Execute Rewriting' : 'Executar Rewriting'}
                        </button>
                    </div>
                `;

                setTimeout(() => {
                    document.getElementById('view-keywords-btn')?.addEventListener('click', () => {
                        this.showKeywordsModal(analise.keywordsVaga);
                    });

                    document.getElementById('goto-rewriting-btn')?.addEventListener('click', () => {
                        this.switchTab('rewriting');
                    });
                }, 100);

                document.querySelector('[data-tab="relevance"]').classList.add('completed');
            }

            showKeywordsModal(keywords) {
                const modal = document.getElementById('keywords-modal');
                const keywordsList = document.getElementById('keywords-list');
                const keywordsCount = document.getElementById('keywords-count');

                keywordsList.innerHTML = keywords.map(keyword =>
                    `<span class="tag tag-primary">${keyword}</span>`
                ).join('');

                keywordsCount.textContent = `Total: ${keywords.length} keywords`;
                modal.classList.add('active');
            }

            displayRewritingResults(cvReescrito, langConfig) {
                document.getElementById('rewriting-placeholder').classList.add('hidden');
                document.getElementById('rewriting-results').classList.remove('hidden');

                const cvOriginal = this.sistema.dados.cvOriginal;
                const cvOriginalTexto = this.sistema.formatarCVParaTexto(cvOriginal);
                const cvReescritoTexo = this.sistema.formatarCVParaTexto(cvReescrito);
                const personaSystem = this.sistema.getPersonaSystem();
                const personaName = this.selectedPersona ?
                    personaSystem.getPersonaName(this.selectedPersona) :
                    (langConfig?.personas?.custom || 'Personalizado');

                const isEn = langConfig && langConfig.isEnglish;

                const atsControlInfo = `
                    <div class="mb-4 p-3 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg text-white">
                        <h4 class="font-bold mb-2">üéØ ${isEn ? 'ATS ANALYSIS CONTROL' : 'CONTROLE DA AN√ÅLISE ATS'}</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>
                                <strong>${isEn ? 'ATS Score' : 'Score ATS'}:</strong> ${this.intelligenceHub.matchScore || 0}/100
                            </div>
                            <div>
                                <strong>${isEn ? 'Keywords' : 'Keywords'}:</strong> ${this.intelligenceHub.keywords?.length || 0}
                            </div>
                            <div>
                                <strong>${isEn ? 'Recommended Persona' : 'Persona Recomendada'}:</strong> ${this.intelligenceHub.personaRecommendation || 'N/A'}
                            </div>
                            <div>
                                <strong>${isEn ? 'Cultural Tone' : 'Tom Cultural'}:</strong> ${this.intelligenceHub.culturalTone || 'profissional'}
                            </div>
                        </div>
                        ${this.intelligenceHub.redFlags?.length > 0 ? `
                            <div class="mt-2 p-2 bg-red-900 bg-opacity-30 rounded">
                                <strong>‚ö†Ô∏è ${isEn ? 'Red Flags' : 'Red Flags'}:</strong> ${this.intelligenceHub.redFlags.join(', ')}
                            </div>
                        ` : ''}
                        ${this.intelligenceHub.greenFlags?.length > 0 ? `
                            <div class="mt-2 p-2 bg-green-900 bg-opacity-30 rounded">
                                <strong>‚úÖ ${isEn ? 'Green Flags' : 'Green Flags'}:</strong> ${this.intelligenceHub.greenFlags.join(', ')}
                            </div>
                        ` : ''}
                        ${this.intelligenceHub.priorityKeywords?.length > 0 ? `
                            <div class="mt-2 p-2 bg-yellow-900 bg-opacity-30 rounded">
                                <strong>üî• ${isEn ? 'Priority Keywords' : 'Keywords Priorit√°rias'}:</strong> ${this.intelligenceHub.priorityKeywords.slice(0, 5).join(', ')}
                            </div>
                        ` : ''}
                    </div>
                `;

                document.getElementById('rewriting-results').innerHTML = `
                    ${atsControlInfo}
                    
                    <div class="mb-4 p-3 bg-purple-50 rounded-lg border border-purple-200">
                        <h4 class="font-bold text-purple-800 mb-1">
                            <i class="fas fa-user-tie"></i> ${langConfig?.ui?.appliedPersona || 'Persona Aplicada'}: ${personaName}
                        </h4>
                        <p class="text-sm text-purple-700">
                            ${this.intelligenceHub.analyzed ?
                        (this.intelligenceHub.personaRecommendation === this.selectedPersona ?
                            `‚úÖ ${langConfig?.ui?.recommendedByATS || '(Recomendada pela An√°lise ATS)'}` :
                            this.intelligenceHub.personaRecommendation ?
                                `‚ÑπÔ∏è ${langConfig?.ui?.manuallySelected || '(Selecionada manualmente)'} - ${langConfig?.ui?.atsRecommends || 'An√°lise recomenda'}: ${this.intelligenceHub.personaRecommendation}` :
                                `‚ÑπÔ∏è ${langConfig?.ui?.manuallySelected || '(Selecionada manualmente)'}`) :
                        `‚ö†Ô∏è ${langConfig?.ui?.noATSAnalysis || '(An√°lise ATS n√£o realizada)'}`
                    }
                            <br><strong>${langConfig?.ui?.preserved || 'Preservado'}:</strong> ${langConfig?.ui?.experienceEducation || 'Experi√™ncia, Educa√ß√£o, Contato, Datas, Empresas'}
                            <br><strong>${langConfig?.ui?.adapted || 'Adaptado'}:</strong> ${langConfig?.ui?.objectiveSkills || 'Objetivo, Resumo, Ordena√ß√£o de Habilidades'}
                        </p>
                    </div>
                    
                    <div class="cv-comparison">
                        <div class="cv-section cv-original">
                            <div class="cv-header">${langConfig?.ui?.originalCV || 'CV ORIGINAL'}</div>
                            <div class="p-3 text-sm whitespace-pre-line max-h-[300px] overflow-y-auto">
                                ${cvOriginalTexto.substring(0, 800)}${cvOriginalTexto.length > 800 ? '...' : ''}
                            </div>
                        </div>
                        
                        <div class="cv-section cv-rewritten">
                            <div class="cv-header">${langConfig?.ui?.rewrittenCV || 'CV REWRITTEN'} (${personaName})</div>
                            <div class="p-3 text-sm whitespace-pre-line max-h-[300px] overflow-y-auto">
                                ${cvReescritoTexo.substring(0, 800)}${cvReescritoTexo.length > 800 ? '...' : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="rewrite-metrics mt-4">
                        <div class="metric-card">
                            <div class="metric-value">${Math.min(100, 40 + (this.intelligenceHub.matchScore || 0) * 0.6)}%</div>
                            <div class="metric-label">${langConfig?.ui?.reductionIrrelevant || 'Redu√ß√£o Irrelevante'}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${Math.min(100, 60 + (this.intelligenceHub.matchScore || 0) * 0.4)}%</div>
                            <div class="metric-label">${langConfig?.ui?.keywordsIncrease || 'Aumento Keywords'}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${this.intelligenceHub.matchScore || 0}%</div>
                            <div class="metric-label">${langConfig?.ui?.ATS_MATCH || 'Match ATS'}</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <button class="btn btn-primary" id="view-details-btn">
                            <i class="fas fa-search"></i> ${langConfig?.ui?.viewDetails || 'Ver Detalhes'}
                        </button>
                        <button class="btn btn-rewrite" id="goto-optimization-btn">
                            <i class="fas fa-file-contract"></i> ${langConfig?.ui?.viewOptimizedCV || 'Ver CV Otimizado'}
                        </button>
                    </div>
                `;

                setTimeout(() => {
                    document.getElementById('view-details-btn')?.addEventListener('click', () => {
                        this.showRewritingDetails();
                    });

                    document.getElementById('goto-optimization-btn')?.addEventListener('click', () => {
                        this.switchTab('optimization');
                        setTimeout(() => this.atualizarCVOtimizado(), 300);
                    });
                }, 100);

                document.querySelector('[data-tab="rewriting"]').classList.add('completed');
            }

            showRewritingDetails() {
                const cvOriginal = this.sistema.dados.cvOriginal;
                const cvReescrito = this.sistema.dados.cvReescrito;
                const diferen√ßas = this.compararCVs(cvOriginal, cvReescrito);
                const personaSystem = this.sistema.getPersonaSystem();

                const jobText = document.getElementById('job-text').value;
                const langConfig = this.getFlowLanguageConfig(jobText);
                const isEn = langConfig.isEnglish;

                const modal = document.getElementById('keywords-modal');
                const keywordsList = document.getElementById('keywords-list');
                const keywordsCount = document.getElementById('keywords-count');

                keywordsList.innerHTML = `
                    <div class="space-y-3">
                        <div class="p-3 bg-purple-50 rounded-lg">
                            <h4 class="font-bold text-purple-700 mb-2">
                                <i class="fas fa-user-tie"></i> ${isEn ? 'Persona' : 'Persona'}: ${personaSystem.getPersonaName(this.selectedPersona)}
                            </h4>
                            <p class="text-sm text-purple-800 mb-2">
                                <strong>${isEn ? 'Strategy' : 'Estrat√©gia'}:</strong> ${personaSystem.getPersonaDescription(this.selectedPersona)}
                                <br><strong>${isEn ? 'Preserved' : 'Preservado'}:</strong> ${isEn ? 'Experience, Education, Contact, Dates, Companies' : 'Experi√™ncia, Educa√ß√£o, Contato, Datas, Empresas'}
                                <br><strong>${isEn ? 'Adapted' : 'Adaptado'}:</strong> ${isEn ? 'Objective, Summary, Skills Ordering' : 'Objetivo, Resumo, Ordena√ß√£o de Habilidades'}
                            </p>
                        </div>
                        
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <h4 class="font-bold text-blue-700 mb-2">${isEn ? 'Main Changes' : 'Principais Altera√ß√µes'}:</h4>
                            <ul class="text-sm text-blue-800 space-y-1">
                                ${diferen√ßas.map(diff => `<li>‚Ä¢ ${diff}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;

                keywordsCount.textContent = isEn ? `Strategic changes: ${diferen√ßas.length}` : `Altera√ß√µes estrat√©gicas: ${diferen√ßas.length}`;
                modal.classList.add('active');
            }

            compararCVs(cvOriginal, cvReescrito) {
                const diferen√ßas = [];

                if (cvOriginal.objetivo !== cvReescrito.objetivo) {
                    diferen√ßas.push('Objetivo profissional direcionado');
                }

                const habOriginal = cvOriginal.habilidades.split(',').map(h => h.trim());
                const habReescrito = cvReescrito.habilidades.split(',').map(h => h.trim());
                const novasHabilidades = habReescrito.filter(h => !habOriginal.includes(h));

                if (novasHabilidades.length > 0) {
                    diferen√ßas.push(`${novasHabilidades.length} novas habilidades/keywords inseridas`);
                }

                if (cvReescrito.resumo && (!cvOriginal.resumo || cvOriginal.resumo !== cvReescrito.resumo)) {
                    diferen√ßas.push('Resumo de qualifica√ß√µes otimizado');
                }

                return diferen√ßas;
            }

            atualizarStats() {
                const metricas = this.sistema.getMetricas();

                document.getElementById('total-analises').textContent = metricas.analisesRealizadas;
                document.getElementById('analysis-badge').textContent = metricas.analisesRealizadas;

                document.getElementById('total-rewrites').textContent = metricas.rewritesRealizados;
                document.getElementById('rewriting-badge').textContent = metricas.rewritesRealizados;

                document.getElementById('total-matches').textContent = metricas.keywordsCount;
                document.getElementById('learning-count').textContent = metricas.keywordsCount;

                const reducao = this.calcularReducaoIrrelevante();
                document.getElementById('reducao-irrelevante').textContent = `${reducao}%`;

                const progressBars = {
                    'progress-analises': Math.min(100, (metricas.analisesRealizadas / 10) * 100),
                    'progress-rewrites': Math.min(100, (metricas.rewritesRealizados / 10) * 100),
                    'progress-matches': Math.min(100, (metricas.keywordsCount / 50) * 100),
                    'progress-reducao': reducao
                };

                Object.entries(progressBars).forEach(([id, width]) => {
                    const bar = document.getElementById(id);
                    if (bar) bar.style.width = `${width}%`;
                });

                const now = new Date();
                document.getElementById('last-rewrite-time').textContent =
                    now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR').substring(0, 5);

                this.sistema.salvarEstado();
            }

            calcularReducaoIrrelevante() {
                if (!this.sistema.dados.analiseRelevancia) return 40;

                const score = this.sistema.dados.analiseRelevancia.score || 0.5;
                const reducao = Math.round((1 - score) * 60 + 20);
                return Math.min(80, reducao);
            }
        }

        // ============ INICIALIZA√á√ÉO DO BACKEND LOCAL ============
        function integrarBackendLocal() {
            if (typeof window.cvReWriter === 'undefined') {
                setTimeout(integrarBackendLocal, 100);
                return;
            }

            console.log('üîß Integrando sistema de backend local...');

            const sistemaLocal = new SistemaIntegradoCVReWriter();
            const sistema = window.cvReWriter;

            const analisarVagaOriginal = sistema.analisarVaga;
            sistema.analisarVagaIntegrada = function () {
                const jobText = document.getElementById('job-text').value.trim();

                if (sistemaLocal && sistemaLocal.analisarVaga) {
                    const resultado = sistemaLocal.analisarVaga(jobText);

                    if (resultado.success) {
                        analisarVagaOriginal.call(this);
                        this.showNotification(resultado.message, 'success');

                        const stats = sistemaLocal.getEstatisticas();
                        document.getElementById('total-analises').textContent = stats.historico;
                        return true;
                    } else {
                        this.showNotification(resultado.message, 'error');
                        return false;
                    }
                } else {
                    return analisarVagaOriginal.call(this);
                }
            };

            const salvarCVOriginal = sistema.salvarCV;
            sistema.salvarCV = function (silent = false) {
                const cvData = {
                    nome: document.getElementById('cv-name').value.trim(),
                    cargo: document.getElementById('cv-title').value.trim(),
                    localizacao: document.getElementById('cv-location').value.trim(),
                    salario: document.getElementById('cv-salary').value.trim(),
                    objetivo: document.getElementById('cv-objective').value.trim(),
                    habilidades: document.getElementById('cv-skills').value.trim(),
                    experiencia: document.getElementById('cv-experience').value.trim()
                };

                const resultado = sistemaLocal.salvarPerfilCV(cvData);

                if (resultado.success) {
                    if (!silent) this.showNotification(resultado.message, 'success');
                    sistema.updateCVPreview();
                    return true;
                } else {
                    if (!silent) this.showNotification(resultado.message, 'warning');
                    return false;
                }
            };

            sistemaLocal.autoAlimentacao.iniciarMonitoramento('cv-experience');
            sistemaLocal.autoAlimentacao.iniciarMonitoramento('cv-objective');

            setTimeout(() => {
                adicionarBotoesBackup(sistema, sistemaLocal);
            }, 2000);

            const estado = sistemaLocal.bd.carregarEstadoAtual();
            if (estado.perfilAtual) {
                const perfil = sistemaLocal.bd.carregarPerfil(estado.perfilAtual);
                if (perfil) {
                    setTimeout(() => {
                        sistema.preencherFormularioCV(perfil);
                        sistema.showNotification(`Perfil "${perfil.nome}" carregado!`, 'info');
                    }, 1000);
                }
            }

            const stats = sistemaLocal.getEstatisticas();
            document.getElementById('learning-count').textContent = stats.keywordsAprendidas;

            window.sistemaLocal = sistemaLocal;

            console.log('‚úÖ Sistema de backend local integrado!');
        }

        function adicionarBotoesBackup(sistema, sistemaLocal) {
            const footer = document.querySelector('footer');
            if (!footer) return;

            const divExistente = footer.querySelector('.text-center');
            if (divExistente) {
                divExistente.innerHTML += `
                    <div class="mt-3 space-x-2">
                        <button class="btn btn-sm btn-outline-primary" id="btn-backup-export">
                            <i class="fas fa-download"></i> Exportar Backup
                        </button>
                        <label class="btn btn-sm btn-outline-info">
                            <i class="fas fa-upload"></i> Importar Backup
                            <input type="file" id="btn-backup-import" accept=".json" class="hidden">
                        </label>
                        <button class="btn btn-sm btn-outline-warning" id="btn-estatisticas">
                            <i class="fas fa-chart-bar"></i> Estat√≠sticas
                        </button>
                    </div>
                `;

                document.getElementById('btn-backup-export').addEventListener('click', () => {
                    const resultado = sistemaLocal.exportarBackup();
                    sistema.showNotification(resultado.message, resultado.success ? 'success' : 'error');
                });

                document.getElementById('btn-backup-import').addEventListener('change', async (e) => {
                    const arquivo = e.target.files[0];
                    if (arquivo) {
                        sistema.showLoading('Importando backup...');
                        const resultado = await sistemaLocal.importarBackup(arquivo);
                        sistema.hideLoading();

                        sistema.showNotification(resultado.message, resultado.success ? 'success' : 'error');

                        if (resultado.success) {
                            setTimeout(() => location.reload(), 1500);
                        }

                        e.target.value = '';
                    }
                });

                document.getElementById('btn-estatisticas').addEventListener('click', () => {
                    const stats = sistemaLocal.getEstatisticas();
                    const keywords = sistemaLocal.getKeywordsAprendidas();

                    const modal = document.getElementById('keywords-modal');
                    const keywordsList = document.getElementById('keywords-list');
                    const keywordsCount = document.getElementById('keywords-count');

                    keywordsList.innerHTML = `
                        <div class="space-y-4">
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <h4 class="font-bold text-blue-700 mb-2">üìä Estat√≠sticas do Sistema</h4>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div><strong>Perfis salvos:</strong> ${stats.perfis}</div>
                                    <div><strong>A√ß√µes no hist√≥rico:</strong> ${stats.historico}</div>
                                    <div><strong>Termos aprendidos:</strong> ${stats.termosAprendidos}</div>
                                    <div><strong>Keywords aprendidas:</strong> ${stats.keywordsAprendidas}</div>
                                </div>
                            </div>
                            
                            ${keywords.length > 0 ? `
                            <div class="p-3 bg-purple-50 rounded-lg">
                                <h4 class="font-bold text-purple-700 mb-2">üìö Keywords Aprendidas</h4>
                                <div class="tags-container">
                                    ${keywords.slice(0, 10).map(k => `<span class="tag tag-primary">${k}</span>`).join('')}
                                </div>
                            </div>
                            ` : ''}
                            
                            <div class="p-3 bg-green-50 rounded-lg">
                                <h4 class="font-bold text-green-700 mb-2">üí° Sistema de Aprendizado</h4>
                                <p class="text-sm text-green-800">
                                    O sistema aprende automaticamente com cada edi√ß√£o que voc√™ faz.
                                    Quanto mais usar, mais inteligente ele fica!
                                </p>
                            </div>
                        </div>
                    `;

                    keywordsCount.textContent = 'Estat√≠sticas do Sistema';
                    modal.classList.add('active');
                });
            }
        }

        // ============ SISTEMA DE AN√ÅLISE ATS AVAN√áADA ============

        class ATSMetadataAnalyzer {
            constructor() {
                this.patterns = {
                    structure: {
                        sections: [
                            'Requisitos Obrigat√≥rios',
                            'Diferenciais',
                            'Atribui√ß√µes',
                            'Responsabilidades',
                            'Benef√≠cios',
                            'O que oferecemos',
                            'Requisitos'
                        ],
                        separators: /^[-‚Ä¢*]\s+|^\d+\.\s+|\n\s*[-‚Ä¢*]\s+/gm
                    },

                    highPriority: [
                        'obrigat√≥rio', 'requisito', 'essencial', 'imprescind√≠vel',
                        'necess√°rio', 'fundamental', 'obrigatoriamente'
                    ],

                    mediumPriority: [
                        'desej√°vel', 'diferencial', 'vantagem', 'plus',
                        'seria um plus', 'conhecimento em', 'experi√™ncia com'
                    ],

                    redFlags: [
                        '24/7', 'plant√£o', 'sobreaviso', 'disponibilidade total',
                        'multitarefa', 'multitasking', 'policial', 'super-her√≥i',
                        'sal√°rio a combinar', 'remunera√ß√£o atrativa', 'bolsa aux√≠lio'
                    ],

                    greenFlags: [
                        'remoto total', 'home office', 'flexibilidade',
                        'plano de carreira', 'treinamento', 'certifica√ß√£o',
                        'b√¥nus por performance', 'participa√ß√£o nos lucros',
                        'equil√≠brio vida-trabalho'
                    ],

                    implicit: {
                        cultura: {
                            'startup': 'Ambiente din√¢mico, r√°pido, multitarefa',
                            'corpora√ß√£o': 'Estrutura hier√°rquica, processos formais',
                            'consultoria': 'Press√£o por resultados, cliente externo',
                            'fintech': 'Ritmo acelerado, foco em inova√ß√£o e seguran√ßa'
                        },
                        expectativa: {
                            's√™nior': 'Lideran√ßa t√©cnica, tomada de decis√£o',
                            'pleno': 'Autonomia com supervis√£o moderada',
                            'j√∫nior': 'Aprendizado ativo, execu√ß√£o supervisionada'
                        }
                    }
                };
            }

            analyze(jobText) {
                if (!jobText || jobText.length < 50) {
                    return {
                        score: 0,
                        insights: ['Texto muito curto para an√°lise ATS'],
                        sections: {},
                        recommendations: []
                    };
                }

                const analysis = {
                    score: 0,
                    atsCompatibility: 0,
                    structureScore: 0,
                    keywordDensity: 0,
                    sections: this.extractSections(jobText),
                    redFlags: [],
                    greenFlags: [],
                    implicitCulture: [],
                    implicitExpectations: [],
                    keywordAnalysis: this.analyzeKeywords(jobText),
                    formattingAnalysis: this.analyzeFormatting(jobText),
                    recommendations: [],
                    strategicInsights: []
                };

                analysis.structureScore = this.calculateStructureScore(analysis.sections);
                analysis.redFlags = this.detectRedFlags(jobText);
                analysis.greenFlags = this.detectGreenFlags(jobText);
                analysis.implicitCulture = this.detectImplicitCulture(jobText);
                analysis.implicitExpectations = this.detectImplicitExpectations(jobText);
                analysis.keywordDensity = this.calculateKeywordDensity(jobText);
                analysis.atsCompatibility = this.calculateATSCompatibility(analysis);
                analysis.score = analysis.atsCompatibility;
                analysis.recommendations = this.generateRecommendations(analysis);
                analysis.strategicInsights = this.generateStrategicInsights(analysis);

                return analysis;
            }

            extractSections(jobText) {
                const sections = {};
                const lines = jobText.split('\n');
                let currentSection = 'Geral';

                lines.forEach(line => {
                    const trimmed = line.trim();

                    for (const section of this.patterns.structure.sections) {
                        if (trimmed.toLowerCase().includes(section.toLowerCase())) {
                            currentSection = section;
                            sections[currentSection] = sections[currentSection] || [];
                            return;
                        }
                    }

                    if (trimmed && !trimmed.match(/^\s*$/)) {
                        sections[currentSection] = sections[currentSection] || [];
                        sections[currentSection].push(trimmed);
                    }
                });

                return sections;
            }

            analyzeKeywords(jobText) {
                const analysis = {
                    highPriority: [],
                    mediumPriority: [],
                    totalKeywords: 0,
                    priorityScore: 0
                };

                const textLower = jobText.toLowerCase();

                this.patterns.highPriority.forEach(keyword => {
                    if (textLower.includes(keyword.toLowerCase())) {
                        analysis.highPriority.push(keyword);
                    }
                });

                this.patterns.mediumPriority.forEach(keyword => {
                    if (textLower.includes(keyword.toLowerCase())) {
                        analysis.mediumPriority.push(keyword);
                    }
                });

                analysis.totalKeywords = analysis.highPriority.length + analysis.mediumPriority.length;
                analysis.priorityScore = (analysis.highPriority.length * 2) + analysis.mediumPriority.length;

                return analysis;
            }

            analyzeFormatting(jobText) {
                const bulletPoints = (jobText.match(/^[-‚Ä¢*]\s+/gm) || []).length;
                const numberedLists = (jobText.match(/^\d+\.\s+/gm) || []).length;
                const lineBreaks = (jobText.match(/\n\s*\n/g) || []).length;
                const paragraphs = (jobText.match(/\n\s*[A-Z]/g) || []).length;

                return {
                    bulletPoints,
                    numberedLists,
                    lineBreaks,
                    paragraphs,
                    formattingScore: Math.min(100,
                        (bulletPoints * 2) +
                        (numberedLists * 1.5) +
                        (lineBreaks * 0.5) +
                        (paragraphs * 1)
                    )
                };
            }

            calculateStructureScore(sections) {
                const sectionCount = Object.keys(sections).length;
                const totalLines = Object.values(sections).reduce((sum, lines) => sum + lines.length, 0);
                const avgLinesPerSection = totalLines / Math.max(sectionCount, 1);

                let score = 0;

                if (sectionCount >= 3) score += 30;
                if (sectionCount >= 5) score += 20;
                if (avgLinesPerSection >= 3 && avgLinesPerSection <= 10) score += 25;

                const standardSections = ['Requisitos', 'Atribui√ß√µes', 'Benef√≠cios'];
                standardSections.forEach(section => {
                    if (sections[section]) score += 15;
                });

                return Math.min(100, score);
            }

            detectRedFlags(jobText) {
                const textLower = jobText.toLowerCase();
                const redFlags = [];

                this.patterns.redFlags.forEach(flag => {
                    if (textLower.includes(flag.toLowerCase())) {
                        redFlags.push(flag);
                    }
                });

                if (textLower.includes('sal√°rio') && textLower.includes('combinar')) {
                    redFlags.push('Sal√°rio oculto');
                }

                if ((textLower.match(/multitarefa|multitasking/g) || []).length >= 2) {
                    redFlags.push('Excesso de multitarefa');
                }

                if (textLower.includes('plant√£o') || textLower.includes('sobreaviso')) {
                    redFlags.push('Hor√°rio abusivo');
                }

                return redFlags;
            }

            detectGreenFlags(jobText) {
                const textLower = jobText.toLowerCase();
                const greenFlags = [];

                this.patterns.greenFlags.forEach(flag => {
                    if (textLower.includes(flag.toLowerCase())) {
                        greenFlags.push(flag);
                    }
                });

                if (textLower.includes('remoto') || textLower.includes('home office')) {
                    greenFlags.push('Trabalho remoto');
                }

                if (textLower.includes('flexibilidade') || textLower.includes('hor√°rio flex√≠vel')) {
                    greenFlags.push('Flexibilidade');
                }

                if (textLower.includes('plano de carreira') || textLower.includes('desenvolvimento')) {
                    greenFlags.push('Crescimento profissional');
                }

                return greenFlags;
            }

            detectImplicitCulture(jobText) {
                const textLower = jobText.toLowerCase();
                const culture = [];

                Object.entries(this.patterns.implicit.cultura).forEach(([keyword, description]) => {
                    if (textLower.includes(keyword.toLowerCase())) {
                        culture.push(description);
                    }
                });

                const dynamicWords = ['din√¢mico', 'r√°pido', '√°gil', 'startup', 'inova√ß√£o'];
                const corporateWords = ['corporativo', 'estruturado', 'processos', 'hierarquia'];
                const consultingWords = ['cliente', 'consultoria', 'projeto', 'entrega'];

                const dynamicCount = dynamicWords.filter(w => textLower.includes(w)).length;
                const corporateCount = corporateWords.filter(w => textLower.includes(w)).length;
                const consultingCount = consultingWords.filter(w => textLower.includes(w)).length;

                if (dynamicCount >= 2) culture.push('Ambiente de startup: r√°pido, experimental, com mudan√ßas frequentes');
                if (corporateCount >= 2) culture.push('Corpora√ß√£o tradicional: processos bem definidos, hierarquia clara');
                if (consultingCount >= 2) culture.push('Consultoria: foco no cliente, prazos apertados, qualidade premium');

                return [...new Set(culture)];
            }

            detectImplicitExpectations(jobText) {
                const textLower = jobText.toLowerCase();
                const expectations = [];

                Object.entries(this.patterns.implicit.expectativa).forEach(([keyword, description]) => {
                    if (textLower.includes(keyword.toLowerCase())) {
                        expectations.push(description);
                    }
                });

                if (textLower.includes('lideran√ßa') || textLower.includes('mentoria')) {
                    expectations.push('Expectativa de lideran√ßa e desenvolvimento de outros');
                }

                if (textLower.includes('autonomia') || textLower.includes('proatividade')) {
                    expectations.push('Alta autonomia e iniciativa pr√≥pria esperada');
                }

                if (textLower.includes('resultados') || textLower.includes('m√©tricas') || textLower.includes('kpi')) {
                    expectations.push('Foco intenso em resultados mensur√°veis');
                }

                return [...new Set(expectations)];
            }

            calculateKeywordDensity(jobText) {
                const words = jobText.toLowerCase().match(/\b\w+\b/g) || [];
                const totalWords = words.length;

                if (totalWords === 0) return 0;

                const techKeywords = [
                    'javascript', 'react', 'python', 'java', 'node', 'aws', 'docker',
                    'sql', 'api', 'frontend', 'backend', 'fullstack', 'mobile'
                ];

                const techCount = words.filter(word => techKeywords.includes(word)).length;
                const density = (techCount / totalWords) * 100;

                return Math.min(100, density * 10);
            }

            calculateATSCompatibility(analysis) {
                let score = 50;

                score += analysis.structureScore * 0.3;
                score += analysis.keywordDensity * 0.2;
                score += analysis.formattingAnalysis.formattingScore * 0.15;
                score += analysis.greenFlags.length * 5;
                score -= analysis.redFlags.length * 10;
                score += analysis.keywordAnalysis.priorityScore * 2;

                return Math.max(0, Math.min(100, Math.round(score)));
            }

            generateRecommendations(analysis) {
                const recommendations = [];

                if (analysis.atsCompatibility < 40) {
                    recommendations.push('‚ùå Estrutura muito fraca para sistemas ATS. Reescreva a vaga com se√ß√µes claras.');
                    recommendations.push('üîç Adicione bullet points e formata√ß√£o consistente.');
                } else if (analysis.atsCompatibility < 60) {
                    recommendations.push('‚ö†Ô∏è Estrutura moderada. Melhore a organiza√ß√£o das se√ß√µes.');
                    recommendations.push('üìù Separe claramente "Requisitos Obrigat√≥rios" de "Diferenciais".');
                } else if (analysis.atsCompatibility < 80) {
                    recommendations.push('‚úÖ Boa estrutura ATS. Mantenha a formata√ß√£o atual.');
                    recommendations.push('üéØ Foque em adicionar keywords t√©cnicas espec√≠ficas.');
                } else {
                    recommendations.push('üöÄ Excelente estrutura ATS! Altamente compat√≠vel com filtros autom√°ticos.');
                    recommendations.push('üí° Otimize ainda mais usando exatamente as mesmas palavras da vaga no seu CV.');
                }

                if (analysis.redFlags.length > 0) {
                    recommendations.push(`‚ö†Ô∏è ATEN√á√ÉO: Detectamos ${analysis.redFlags.length} red flag(s): ${analysis.redFlags.join(', ')}`);
                    recommendations.push('Considere cuidadosamente se esta vaga se alinha com seus objetivos profissionais.');
                }

                if (analysis.structureScore < 50) {
                    recommendations.push('üìã Estruture a vaga com se√ß√µes claras: Requisitos, Responsabilidades, Benef√≠cios.');
                }

                if (analysis.keywordAnalysis.highPriority.length === 0) {
                    recommendations.push('üîë Adicione palavras como "Requisitos Obrigat√≥rios" para melhorar filtragem.');
                }

                return recommendations;
            }

            generateStrategicInsights(analysis) {
                const insights = [];

                if (analysis.implicitCulture.length > 0) {
                    insights.push(`üè¢ **Cultura Impl√≠cita**: ${analysis.implicitCulture.join('; ')}`);
                }

                if (analysis.implicitExpectations.length > 0) {
                    insights.push(`üéØ **Expectativas Escondidas**: ${analysis.implicitExpectations.join('; ')}`);
                }

                if (analysis.keywordAnalysis.highPriority.length > 0) {
                    insights.push(`‚ö° **Foco do Recrutador**: ${analysis.keywordAnalysis.highPriority.length} requisitos s√£o marcados como OBRIGAT√ìRIOS`);
                }

                if (analysis.formattingAnalysis.bulletPoints > 10) {
                    insights.push('üìä **Vaga Bem Estruturada**: M√∫ltiplos bullet points indicam clareza nos requisitos');
                }

                if (analysis.greenFlags.length > 3) {
                    insights.push(`üåü **Vaga de Qualidade**: ${analysis.greenFlags.length} green flags detectados`);
                }

                insights.push(`üéØ **Dica ATS**: Use exatamente as mesmas palavras da se√ß√£o "Requisitos Obrigat√≥rios" no seu CV`);

                return insights;
            }

            getATSReport(jobText) {
                const analysis = this.analyze(jobText);

                return {
                    summary: {
                        atsScore: analysis.atsCompatibility,
                        structureScore: analysis.structureScore,
                        keywordScore: analysis.keywordAnalysis.priorityScore,
                        formattingScore: analysis.formattingAnalysis.formattingScore,
                        redFlagsCount: analysis.redFlags.length,
                        greenFlagsCount: analysis.greenFlags.length,
                        sectionsCount: Object.keys(analysis.sections).length
                    },
                    details: analysis
                };
            }
        }

        function integrarATSNoSistema() {
            console.log('üîç Integrando analisador ATS avan√ßado...');

            if (typeof window.cvReWriter === 'undefined') {
                setTimeout(integrarATSNoSistema, 100);
                return;
            }

            const atsAnalyzer = new ATSMetadataAnalyzer();

            const analisarVagaOriginal = window.cvReWriter.analisarVagaHibrida || window.cvReWriter.analisarVaga;

            window.cvReWriter.analisarVagaHibrida = function () {
                const jobText = document.getElementById('job-text').value.trim();

                if (!jobText || jobText.length < 50) {
                    this.showNotification('Cole uma vaga mais completa para an√°lise ATS.', 'warning');
                    return analisarVagaOriginal.call(this);
                }

                this.showLoading('Analisando metadados ATS e estrutura da vaga...');

                try {
                    const atsReport = atsAnalyzer.getATSReport(jobText);
                    const resultadoOriginal = analisarVagaOriginal.call(this);
                    this.displayATSResults(atsReport);

                    this.showNotification(`‚úÖ An√°lise ATS completa! Score: ${atsReport.summary.atsScore}/100`, 'success');

                    return resultadoOriginal;

                } catch (error) {
                    console.error('Erro na an√°lise ATS:', error);
                    this.showNotification('An√°lise ATS parcial', 'warning');
                    return analisarVagaOriginal.call(this);
                } finally {
                    this.hideLoading();
                }
            };

            setTimeout(() => {
                adicionarContainerATS();
            }, 500);

            console.log('‚úÖ Analisador ATS integrado!');
        }

        function adicionarContainerATS() {
            const analysisCard = document.querySelector('#analysis .card:last-child');
            if (!analysisCard) return;

            const atsSection = document.createElement('div');
            atsSection.className = 'mt-4 p-4 rounded-lg border-2 border-purple-200 bg-gradient-to-r from-purple-50 to-pink-50';
            atsSection.id = 'ats-analysis-section';
            atsSection.innerHTML = `
                <h4 class="font-bold text-purple-800 mb-3">
                    <i class="fas fa-robot"></i> An√°lise ATS Avan√ßada
                    <span id="ats-score-badge" class="ml-2 px-2 py-1 text-xs bg-purple-600 text-white rounded-full">0/100</span>
                </h4>
                
                <div id="ats-placeholder" class="text-center p-4">
                    <div class="mb-2">
                        <i class="fas fa-search fa-2x text-purple-300"></i>
                    </div>
                    <p class="text-purple-600 text-sm">
                        Execute uma an√°lise para ver insights ATS
                    </p>
                </div>
                
                <div id="ats-results" class="hidden space-y-3">
                    <!-- Conte√∫do din√¢mico ser√° inserido aqui -->
                </div>
                
                <button id="toggle-ats-details" class="mt-3 text-xs text-purple-600 hover:text-purple-800 flex items-center gap-1">
                    <i class="fas fa-chevron-down"></i>
                    Ver detalhes t√©cnicos ATS
                </button>
                
                <div id="ats-details" class="hidden mt-3 p-3 bg-white rounded border border-purple-100">
                    <!-- Detalhes t√©cnicos ser√£o inseridos aqui -->
                </div>
            `;

            const insightsSection = analysisCard.querySelector('#market-intelligence-card');
            if (insightsSection) {
                insightsSection.parentNode.insertBefore(atsSection, insightsSection.nextSibling);
            } else {
                analysisCard.appendChild(atsSection);
            }

            document.getElementById('toggle-ats-details')?.addEventListener('click', function () {
                const details = document.getElementById('ats-details');
                const isHidden = details.classList.contains('hidden');

                if (isHidden) {
                    details.classList.remove('hidden');
                    this.innerHTML = '<i class="fas fa-chevron-up"></i> Ocultar detalhes t√©cnicos ATS';
                } else {
                    details.classList.add('hidden');
                    this.innerHTML = '<i class="fas fa-chevron-down"></i> Ver detalhes t√©cnicos ATS';
                }
            });
        }

        InterfaceCVReWriter.prototype.displayATSResults = function (atsReport) {
            const atsSection = document.getElementById('ats-analysis-section');
            const atsPlaceholder = document.getElementById('ats-placeholder');
            const atsResults = document.getElementById('ats-results');
            const atsDetails = document.getElementById('ats-details');
            const atsScoreBadge = document.getElementById('ats-score-badge');

            if (!atsSection) return;

            if (atsScoreBadge) {
                atsScoreBadge.textContent = `${atsReport.summary.atsScore}/100`;

                if (atsReport.summary.atsScore >= 80) {
                    atsScoreBadge.className = 'ml-2 px-2 py-1 text-xs bg-green-600 text-white rounded-full';
                } else if (atsReport.summary.atsScore >= 60) {
                    atsScoreBadge.className = 'ml-2 px-2 py-1 text-xs bg-yellow-600 text-white rounded-full';
                } else {
                    atsScoreBadge.className = 'ml-2 px-2 py-1 text-xs bg-red-600 text-white rounded-full';
                }
            }

            if (atsPlaceholder) atsPlaceholder.classList.add('hidden');
            if (atsResults) atsResults.classList.remove('hidden');

            const details = atsReport.details;

            const scoreHTML = `
                <div class="grid grid-cols-4 gap-2 mb-3">
                    <div class="text-center p-2 bg-white rounded border">
                        <div class="text-lg font-bold ${details.atsCompatibility >= 80 ? 'text-green-600' :
                    details.atsCompatibility >= 60 ? 'text-yellow-600' : 'text-red-600'}">
                            ${details.atsCompatibility}%
                        </div>
                        <div class="text-xs text-gray-600">Score ATS</div>
                    </div>
                    <div class="text-center p-2 bg-white rounded border">
                        <div class="text-lg font-bold">${details.structureScore}%</div>
                        <div class="text-xs text-gray-600">Estrutura</div>
                    </div>
                    <div class="text-center p-2 bg-white rounded border">
                        <div class="text-lg font-bold">${details.greenFlags.length}</div>
                        <div class="text-xs text-gray-600">Green Flags</div>
                    </div>
                    <div class="text-center p-2 bg-white rounded border">
                        <div class="text-lg font-bold">${details.redFlags.length}</div>
                        <div class="text-xs text-gray-600">Red Flags</div>
                    </div>
                </div>
            `;

            const greenFlagsHTML = details.greenFlags.length > 0 ? `
                <div class="p-2 bg-green-50 rounded border border-green-200">
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fas fa-check-circle text-green-600"></i>
                        <span class="font-bold text-green-700 text-sm">Green Flags (${details.greenFlags.length})</span>
                    </div>
                    <div class="text-xs text-green-800">
                        ${details.greenFlags.map(flag => `<span class="inline-block bg-green-100 px-2 py-1 rounded mr-1 mb-1">‚úÖ ${flag}</span>`).join('')}
                    </div>
                </div>
            ` : '';

            const redFlagsHTML = details.redFlags.length > 0 ? `
                <div class="p-2 bg-red-50 rounded border border-red-200">
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                        <span class="font-bold text-red-700 text-sm">Red Flags (${details.redFlags.length})</span>
                    </div>
                    <div class="text-xs text-red-800">
                        ${details.redFlags.map(flag => `<span class="inline-block bg-red-100 px-2 py-1 rounded mr-1 mb-1">‚ö†Ô∏è ${flag}</span>`).join('')}
                    </div>
                </div>
            ` : '';

            const insightsHTML = details.strategicInsights.length > 0 ? `
                <div class="p-2 bg-blue-50 rounded border border-blue-200">
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fas fa-lightbulb text-blue-600"></i>
                        <span class="font-bold text-blue-700 text-sm">Insights ATS</span>
                    </div>
                    <div class="space-y-1 text-xs text-blue-800">
                        ${details.strategicInsights.map(insight =>
                `<div class="flex items-start gap-2">
                                <i class="fas fa-chevron-right text-blue-500 mt-0.5"></i>
                                <span>${insight}</span>
                            </div>`
            ).join('')}
                    </div>
                </div>
            ` : '';

            const recommendationsHTML = details.recommendations.length > 0 ? `
                <div class="p-2 bg-purple-50 rounded border border-purple-200">
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fas fa-magic text-purple-600"></i>
                        <span class="font-bold text-purple-700 text-sm">Recomenda√ß√µes ATS</span>
                    </div>
                    <div class="space-y-1 text-xs text-purple-800">
                        ${details.recommendations.map(rec =>
                `<div class="flex items-start gap-2">
                                <i class="fas fa-star text-purple-500 mt-0.5"></i>
                                <span>${rec}</span>
                            </div>`
            ).join('')}
                    </div>
                </div>
            ` : '';

            if (atsResults) {
                atsResults.innerHTML = scoreHTML + greenFlagsHTML + redFlagsHTML + insightsHTML + recommendationsHTML;
            }

            if (atsDetails) {
                atsDetails.innerHTML = `
                    <div class="space-y-3">
                        <div>
                            <h5 class="font-bold text-sm text-gray-700 mb-1">üìä Metadados T√©cnicos</h5>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div><span class="font-medium">Se√ß√µes:</span> ${Object.keys(details.sections).length}</div>
                                <div><span class="font-medium">Bullet Points:</span> ${details.formattingAnalysis.bulletPoints}</div>
                                <div><span class="font-medium">Keywords Obrigat√≥rias:</span> ${details.keywordAnalysis.highPriority.length}</div>
                                <div><span class="font-medium">Keywords Desej√°veis:</span> ${details.keywordAnalysis.mediumPriority.length}</div>
                            </div>
                        </div>
                        
                        ${Object.keys(details.sections).length > 0 ? `
                        <div>
                            <h5 class="font-bold text-sm text-gray-700 mb-1">üìë Estrutura da Vaga</h5>
                            <div class="text-xs space-y-1">
                                ${Object.entries(details.sections).map(([section, lines]) =>
                    `<div>
                                        <span class="font-medium">${section}:</span>
                                        <span class="text-gray-600"> ${lines.length} linha(s)</span>
                                    </div>`
                ).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${details.implicitCulture.length > 0 ? `
                        <div>
                            <h5 class="font-bold text-sm text-gray-700 mb-1">üè¢ Cultura Detectada</h5>
                            <div class="text-xs text-gray-600">
                                ${details.implicitCulture.map(c => `<div class="mb-1">‚Ä¢ ${c}</div>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${details.implicitExpectations.length > 0 ? `
                        <div>
                            <h5 class="font-bold text-sm text-gray-700 mb-1">üéØ Expectativas Impl√≠citas</h5>
                            <div class="text-xs text-gray-600">
                                ${details.implicitExpectations.map(e => `<div class="mb-1">‚Ä¢ ${e}</div>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
        };

        // ============ INICIALIZA√á√ÉO ============

        document.addEventListener('DOMContentLoaded', () => {
            window.cvReWriter = new InterfaceCVReWriter();
            
            setTimeout(() => {
                integrarBackendLocal();
                console.log('üöÄ Backend local integrado!');
            }, 1000);
            
            setTimeout(() => {
                integrarATSNoSistema();
                console.log('üöÄ Sistema ATS Avan√ßado carregado e pronto!');
            }, 1500);
        });
    </script>
</body>

</html>
